import{j as s,c as E,d as B,e as I}from"./index-oK68leZs.js";import{r as i}from"./react-Czq5O75u.js";import{u as L}from"./useTenant-Dx_9z4Rz.js";import{l as _,a as D,b as C,c as G}from"./tenantService-DcVpCR3u.js";import{a as M}from"./smsTemplateService-DKAdfnfw.js";import"./supabase-D02rA7zj.js";import"./router-CZES1Sa0.js";import"./options-CllavUpK.js";function Q(){var c,m,h,g,x,j,u,p,f;const{orgId:l,loading:N,session:t}=L(),[e,v]=i.useState({}),[S,n]=i.useState(!1),[o,d]=i.useState(null);return i.useEffect(()=>{let a=!0;async function y(){var b;n(!0),d(null);try{const[r,O,P,A]=await Promise.all([E({activeOnly:!1}),B({activeOnly:!1}),I({activeOnly:!1}),(b=M)==null?void 0:b({activeOnly:!1}).catch(()=>[])]),[T,U,V,w]=await Promise.all([l?_(l,{activeOnly:!1}):Promise.resolve([]),l?D(l,{activeOnly:!1}):Promise.resolve([]),l?C(l,{activeOnly:!1}):Promise.resolve([]),l?G(l,{activeOnly:!1}):Promise.resolve([])]);if(!a)return;v({global:{vendors:r.length,products:O.length,users:P.length,sms_templates:A.length},org:{vendors:T.length,products:U.length,users:V.length,sms_templates:w.length}})}catch(r){console.error("debug-auth load error",r),a&&d((r==null?void 0:r.message)||String(r))}finally{a&&n(!1)}}return y(),()=>{a=!1}},[l]),s.jsxs("div",{className:"p-6",children:[s.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Debug: Auth / Org / Tenancy"}),s.jsxs("section",{className:"mb-4",children:[s.jsx("h2",{className:"font-semibold",children:"Session"}),s.jsxs("div",{className:"mb-2",children:[s.jsx("span",{className:"text-sm text-slate-600",children:"Session User ID: "}),s.jsx("strong",{"data-testid":"session-user-id",children:((c=t==null?void 0:t.user)==null?void 0:c.id)||"â€”"})]}),s.jsx("pre",{className:"bg-gray-100 p-2 rounded",children:JSON.stringify(t||null,null,2)})]}),s.jsxs("section",{className:"mb-4",children:[s.jsx("h2",{className:"font-semibold",children:"Tenant"}),s.jsxs("div",{children:["orgId: ",s.jsx("strong",{"data-testid":"profile-org-id",children:String(l)})]}),s.jsxs("div",{children:["loading: ",s.jsx("strong",{children:String(N)})]})]}),s.jsxs("section",{className:"mb-4",children:[s.jsx("h2",{className:"font-semibold",children:"Counts"}),S?s.jsx("div",{children:"Loading counts..."}):o?s.jsxs("div",{className:"text-red-600",children:["Error: ",o]}):s.jsxs("div",{children:[s.jsx("h3",{className:"mt-2",children:"Global"}),s.jsxs("ul",{children:[s.jsxs("li",{children:["Vendors:"," ",s.jsx("span",{"data-testid":"global-vendor-count",children:((m=e==null?void 0:e.global)==null?void 0:m.vendors)??"N/A"})]}),s.jsxs("li",{children:["Products:"," ",s.jsx("span",{"data-testid":"global-product-count",children:((h=e==null?void 0:e.global)==null?void 0:h.products)??"N/A"})]}),s.jsxs("li",{children:["Users:"," ",s.jsx("span",{"data-testid":"global-staff-count",children:((g=e==null?void 0:e.global)==null?void 0:g.users)??"N/A"})]}),s.jsxs("li",{children:["SMS Templates:"," ",s.jsx("span",{"data-testid":"global-sms-template-count",children:((x=e==null?void 0:e.global)==null?void 0:x.sms_templates)??"N/A"})]})]}),s.jsx("h3",{className:"mt-2",children:"Org-scoped"}),s.jsxs("ul",{children:[s.jsxs("li",{children:["Vendors: ",s.jsx("span",{"data-testid":"org-vendor-count",children:((j=e==null?void 0:e.org)==null?void 0:j.vendors)??"N/A"})]}),s.jsxs("li",{children:["Products:"," ",s.jsx("span",{"data-testid":"org-product-count",children:((u=e==null?void 0:e.org)==null?void 0:u.products)??"N/A"})]}),s.jsxs("li",{children:["Users: ",s.jsx("span",{"data-testid":"org-staff-count",children:((p=e==null?void 0:e.org)==null?void 0:p.users)??"N/A"})]}),s.jsxs("li",{children:["SMS Templates:"," ",s.jsx("span",{"data-testid":"org-sms-template-count",children:((f=e==null?void 0:e.org)==null?void 0:f.sms_templates)??"N/A"})]})]})]})]}),s.jsxs("section",{className:"mb-4",children:[s.jsx("h2",{className:"font-semibold",children:"Notes"}),s.jsxs("ul",{className:"list-disc ml-6",children:[s.jsxs("li",{children:["This page uses tenant-aware list functions when ",s.jsx("code",{children:"orgId"})," exists."]}),s.jsx("li",{children:"Permission / RLS errors will appear in the console and in the error box above."})]})]})]})}export{Q as default};
//# sourceMappingURL=debug-auth-CTCtQWyg.js.map
