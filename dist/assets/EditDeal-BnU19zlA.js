import{j as a}from"./index-Bn3E4zhC.js";import{r as o}from"./react-Czq5O75u.js";import N from"./DealForm-R3M4OLml.js";import{getDeal as p,mapDbDealToForm as n,updateDeal as S}from"./dealService-DTSano-w.js";import{c as y,a as D}from"./router-CZES1Sa0.js";import"./supabase-D02rA7zj.js";import"./tenantService-DKm9JmiG.js";import"./options-CllavUpK.js";import"./useTenant-CNgXXmbA.js";import"./useLogger-D5qQrM8Q.js";function B(){var u;const{id:s}=y(),r=D(),[t,m]=o.useState(null),[x,f]=o.useState(!0),[h,c]=o.useState(!1),[d,b]=o.useState(null);o.useEffect(()=>{let l=!0;return(async()=>{try{const e=await p(s);if(l){const i=n?n(e):e;m(i)}}catch(e){alert((e==null?void 0:e.message)||"Failed to load deal")}finally{l&&f(!1)}})(),()=>{l=!1}},[s]);async function g(l){c(!0);try{await S(s,l);const e=await p(s),i=n?n(e):e;m(i),b(new Date)}catch(e){alert((e==null?void 0:e.message)||"Failed to save deal")}finally{c(!1)}}if(x)return a.jsx("div",{className:"max-w-5xl mx-auto p-8",children:"Loading..."});const v=(t==null?void 0:t.job_number)||`#${s}`,j=((u=t==null?void 0:t.vehicle)==null?void 0:u.stock_number)||(t==null?void 0:t.stock_number)||"—";return a.jsxs("div",{className:"max-w-5xl mx-auto p-4 md:p-8",children:[a.jsxs("header",{className:"mb-4 flex items-center justify-between gap-3",children:[a.jsxs("h1",{className:"text-xl font-semibold",children:["Deal ",v," / Stock # ",j]}),a.jsx("button",{type:"button",onClick:()=>r("/deals"),className:"btn-mobile button-outline-enhanced",children:"← Back to Deals"})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("h1",{className:"text-2xl font-semibold",children:"Edit Deal"}),a.jsx("p",{className:"text-gray-600",children:"Update details and save."}),d?a.jsxs("p",{className:"text-sm text-gray-500 mt-1","data-testid":"last-saved-timestamp",children:["Last saved:"," ",d.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})]}):null]}),a.jsx(N,{mode:"edit",initial:t||{},onSave:g,onCancel:()=>r("/deals"),saving:h})]})}export{B as default};
//# sourceMappingURL=EditDeal-BnU19zlA.js.map
