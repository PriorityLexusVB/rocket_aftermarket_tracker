{"version":3,"file":"debug-auth-ex8diX7r.js","sources":["../../src/pages/debug-auth.jsx"],"sourcesContent":["// src/pages/debug-auth.jsx\r\nimport React, { useEffect, useState } from 'react'\r\nimport useTenant from '../hooks/useTenant'\r\nimport {\r\n  listVendorsByOrg,\r\n  listProductsByOrg,\r\n  listStaffByOrg,\r\n  listSmsTemplatesByOrg,\r\n} from '../services/tenantService'\r\nimport { listSmsTemplatesGlobal } from '../services/smsTemplateService'\r\nimport {\r\n  getVendors as getVendorsGlobal,\r\n  getProducts as getProductsGlobal,\r\n  getUserProfiles as getUsersGlobal,\r\n} from '../services/dropdownService'\r\n\r\nexport default function DebugAuthPage() {\r\n  const { orgId, loading: tenantLoading, session } = useTenant()\r\n  const [counts, setCounts] = useState({})\r\n  const [loading, setLoading] = useState(false)\r\n  const [error, setError] = useState(null)\r\n\r\n  useEffect(() => {\r\n    let mounted = true\r\n    async function load() {\r\n      setLoading(true)\r\n      setError(null)\r\n      try {\r\n        // Unfiltered/global counts\r\n        const [gVendors, gProducts, gUsers, gSms] = await Promise.all([\r\n          getVendorsGlobal({ activeOnly: false }),\r\n          getProductsGlobal({ activeOnly: false }),\r\n          getUsersGlobal({ activeOnly: false }),\r\n          listSmsTemplatesGlobal?.({ activeOnly: false }).catch(() => []),\r\n        ])\r\n\r\n        // Org-filtered counts\r\n        const [oVendors, oProducts, oUsers, oSms] = await Promise.all([\r\n          orgId ? listVendorsByOrg(orgId, { activeOnly: false }) : Promise.resolve([]),\r\n          orgId ? listProductsByOrg(orgId, { activeOnly: false }) : Promise.resolve([]),\r\n          orgId ? listStaffByOrg(orgId, { activeOnly: false }) : Promise.resolve([]),\r\n          orgId ? listSmsTemplatesByOrg(orgId, { activeOnly: false }) : Promise.resolve([]),\r\n        ])\r\n\r\n        if (!mounted) return\r\n        setCounts({\r\n          global: {\r\n            vendors: gVendors.length,\r\n            products: gProducts.length,\r\n            users: gUsers.length,\r\n            sms_templates: gSms.length,\r\n          },\r\n          org: {\r\n            vendors: oVendors.length,\r\n            products: oProducts.length,\r\n            users: oUsers.length,\r\n            sms_templates: oSms.length,\r\n          },\r\n        })\r\n      } catch (err) {\r\n        console.error('debug-auth load error', err)\r\n        if (mounted) setError(err?.message || String(err))\r\n      } finally {\r\n        if (mounted) setLoading(false)\r\n      }\r\n    }\r\n\r\n    load()\r\n    return () => {\r\n      mounted = false\r\n    }\r\n  }, [orgId])\r\n\r\n  return (\r\n    <div className=\"p-6\">\r\n      <h1 className=\"text-2xl font-bold mb-4\">Debug: Auth / Org / Tenancy</h1>\r\n\r\n      <section className=\"mb-4\">\r\n        <h2 className=\"font-semibold\">Session</h2>\r\n        <div className=\"mb-2\">\r\n          <span className=\"text-sm text-slate-600\">Session User ID: </span>\r\n          <strong data-testid=\"session-user-id\">{session?.user?.id || 'â€”'}</strong>\r\n        </div>\r\n        <pre className=\"bg-gray-100 p-2 rounded\">{JSON.stringify(session || null, null, 2)}</pre>\r\n      </section>\r\n\r\n      <section className=\"mb-4\">\r\n        <h2 className=\"font-semibold\">Tenant</h2>\r\n        <div>\r\n          orgId: <strong data-testid=\"profile-org-id\">{String(orgId)}</strong>\r\n        </div>\r\n        <div>\r\n          loading: <strong>{String(tenantLoading)}</strong>\r\n        </div>\r\n      </section>\r\n\r\n      <section className=\"mb-4\">\r\n        <h2 className=\"font-semibold\">Counts</h2>\r\n        {loading ? (\r\n          <div>Loading counts...</div>\r\n        ) : error ? (\r\n          <div className=\"text-red-600\">Error: {error}</div>\r\n        ) : (\r\n          <div>\r\n            <h3 className=\"mt-2\">Global</h3>\r\n            <ul>\r\n              <li>\r\n                Vendors:{' '}\r\n                <span data-testid=\"global-vendor-count\">{counts?.global?.vendors ?? 'N/A'}</span>\r\n              </li>\r\n              <li>\r\n                Products:{' '}\r\n                <span data-testid=\"global-product-count\">{counts?.global?.products ?? 'N/A'}</span>\r\n              </li>\r\n              <li>\r\n                Users:{' '}\r\n                <span data-testid=\"global-staff-count\">{counts?.global?.users ?? 'N/A'}</span>\r\n              </li>\r\n              <li>\r\n                SMS Templates:{' '}\r\n                <span data-testid=\"global-sms-template-count\">\r\n                  {counts?.global?.sms_templates ?? 'N/A'}\r\n                </span>\r\n              </li>\r\n            </ul>\r\n\r\n            <h3 className=\"mt-2\">Org-scoped</h3>\r\n            <ul>\r\n              <li>\r\n                Vendors: <span data-testid=\"org-vendor-count\">{counts?.org?.vendors ?? 'N/A'}</span>\r\n              </li>\r\n              <li>\r\n                Products:{' '}\r\n                <span data-testid=\"org-product-count\">{counts?.org?.products ?? 'N/A'}</span>\r\n              </li>\r\n              <li>\r\n                Users: <span data-testid=\"org-staff-count\">{counts?.org?.users ?? 'N/A'}</span>\r\n              </li>\r\n              <li>\r\n                SMS Templates:{' '}\r\n                <span data-testid=\"org-sms-template-count\">\r\n                  {counts?.org?.sms_templates ?? 'N/A'}\r\n                </span>\r\n              </li>\r\n            </ul>\r\n          </div>\r\n        )}\r\n      </section>\r\n\r\n      <section className=\"mb-4\">\r\n        <h2 className=\"font-semibold\">Notes</h2>\r\n        <ul className=\"list-disc ml-6\">\r\n          <li>\r\n            This page uses tenant-aware list functions when <code>orgId</code> exists.\r\n          </li>\r\n          <li>Permission / RLS errors will appear in the console and in the error box above.</li>\r\n        </ul>\r\n      </section>\r\n    </div>\r\n  )\r\n}\r\n"],"names":["DebugAuthPage","orgId","tenantLoading","session","useTenant","counts","setCounts","useState","loading","setLoading","error","setError","useEffect","mounted","load","gVendors","gProducts","gUsers","gSms","getVendorsGlobal","getProductsGlobal","getUsersGlobal","_a","listSmsTemplatesGlobal","oVendors","oProducts","oUsers","oSms","listVendorsByOrg","listProductsByOrg","listStaffByOrg","listSmsTemplatesByOrg","err","jsxs","jsx","_b","_c","_d","_e","_f","_g","_h","_i"],"mappings":"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"}