import{_ as Ie}from"./supabase-D02rA7zj.js";import{a as Ce,m as De,d as ge,e as fe,g as Ae,c as Pe,b as Fe,i as X,j as e}from"./index-Z7SfelWm.js";import{r as i}from"./react-Czq5O75u.js";import{a as Oe,b as qe,l as Z}from"./tenantService-lRk8xsZ3.js";import{u as Le}from"./useLogger-DdY_MAJK.js";import"./router-CZES1Sa0.js";import"./options-CllavUpK.js";function Ee({isDirty:s,isSubmitting:E}){return i.useEffect(()=>{if(!s||E)return;const F=f=>{if(f.defaultPrevented||f.button!==0||f.metaKey||f.altKey||f.ctrlKey||f.shiftKey)return;const O=f.target.closest?f.target.closest("a[href]"):null;if(!O||O.target==="_blank")return;const x=O.getAttribute("href")||"";if(!x||/^(https?:)?\/\//i.test(x))return;window.confirm("You have unsaved changes. Discard them?")||(f.preventDefault(),f.stopPropagation())},R=f=>{window.confirm("You have unsaved changes. Discard them?")||history.go(1)};return document.addEventListener("click",F,!0),window.addEventListener("popstate",R),()=>{document.removeEventListener("click",F,!0),window.removeEventListener("popstate",R)}},[s,E]),null}const ee={neutralTheme:!0,enableAdvancedFilters:!0,enableMobileOptimizations:!0,enableThemePresets:!0,forceGlobalDropdowns:!0};let te;try{te=Ie(()=>import("./dealService-BiwUi1HC.js"),__vite__mapDeps([0,1,2,3,4,5]))}catch{}const J=()=>({product_id:"",quantity_used:1,unit_price:0,promised_date:"",requires_scheduling:!0,no_schedule_reason:"",is_off_site:!1});function Ke({initial:s={},mode:E="create",onCancel:F,onSave:R}){var ce,ue,ie,me,he,_e,pe,be;const[f,O]=i.useState(!0),[x,$]=i.useState(!1),[B,Y]=i.useState(""),[ve,se]=i.useState(null),[G,K]=i.useState({}),[M,ne]=i.useState([]),[C,ae]=i.useState([]),[V,re]=i.useState([]),[T,oe]=i.useState([]),[z,de]=i.useState([]),[n,D]=i.useState({id:s.id||void 0,updated_at:s.updated_at||void 0,job_number:s.job_number||"",vehicle_id:s.vehicle_id||"",stock_number:s.stock_number||"",description:s.description||"",vendor_id:s.vendor_id||"",assigned_to:s.assigned_to||"",finance_manager_id:s.finance_manager_id||"",delivery_coordinator_id:s.delivery_coordinator_id||"",customer_mobile:s.customer_mobile||"",customer_needs_loaner:!!s.customer_needs_loaner,loanerForm:{loaner_number:((ce=s==null?void 0:s.loanerForm)==null?void 0:ce.loaner_number)||"",eta_return_date:((ue=s==null?void 0:s.loanerForm)==null?void 0:ue.eta_return_date)||"",notes:((ie=s==null?void 0:s.loanerForm)==null?void 0:ie.notes)||""},lineItems:(me=s.lineItems)!=null&&me.length?s.lineItems:[J()],promised_date:s.promised_date||"",scheduled_start_time:s.scheduled_start_time||"",scheduled_end_time:s.scheduled_end_time||"",calendar_notes:s.calendar_notes||""});i.useEffect(()=>{var a,o,c,d;s&&(s.id||s.job_number||Array.isArray(s.lineItems)&&s.lineItems.length>0)&&D({id:s.id||void 0,updated_at:s.updated_at||void 0,job_number:s.job_number||"",vehicle_id:s.vehicle_id||"",stock_number:s.stock_number||"",description:s.description||"",vendor_id:s.vendor_id||"",assigned_to:s.assigned_to||"",finance_manager_id:s.finance_manager_id||"",delivery_coordinator_id:s.delivery_coordinator_id||"",customer_mobile:s.customer_mobile||"",customer_needs_loaner:!!s.customer_needs_loaner,loanerForm:{loaner_number:((a=s==null?void 0:s.loanerForm)==null?void 0:a.loaner_number)||"",eta_return_date:((o=s==null?void 0:s.loanerForm)==null?void 0:o.eta_return_date)||"",notes:((c=s==null?void 0:s.loanerForm)==null?void 0:c.notes)||""},lineItems:(d=s.lineItems)!=null&&d.length?s.lineItems:[J()],promised_date:s.promised_date||"",scheduled_start_time:s.scheduled_start_time||"",scheduled_end_time:s.scheduled_end_time||"",calendar_notes:s.calendar_notes||""})},[s]);const{orgId:_}=Ce(),{logFormSubmission:q,logError:W}=Le(),y=(he=De)==null?void 0:he(),[le]=i.useState(()=>{var t;return JSON.stringify({id:s.id||void 0,updated_at:s.updated_at||void 0,job_number:s.job_number||"",vehicle_id:s.vehicle_id||"",stock_number:s.stock_number||"",description:s.description||"",vendor_id:s.vendor_id||"",assigned_to:s.assigned_to||"",finance_manager_id:s.finance_manager_id||"",delivery_coordinator_id:s.delivery_coordinator_id||"",customer_mobile:s.customer_mobile||"",customer_needs_loaner:!!s.customer_needs_loaner,lineItems:(t=s.lineItems)!=null&&t.length?s.lineItems:[J()],promised_date:s.promised_date||"",scheduled_start_time:s.scheduled_start_time||"",scheduled_end_time:s.scheduled_end_time||"",calendar_notes:s.calendar_notes||""})});i.useEffect(()=>{let t=!0;return(async()=>{try{const a=(ee==null?void 0:ee.forceGlobalDropdowns)===!0,o=_&&!a?Oe(_,{activeOnly:!0}):ge(),c=_&&!a?qe(_,{activeOnly:!0}):fe(),d=_&&!a?Z(_,{departments:["Sales","Sales Consultant","Sales Consultants"],roles:["staff"],activeOnly:!0}):Ae(),S=_&&!a?Z(_,{departments:["Finance","Finance Manager","Finance Managers","Managers"],roles:["staff"],activeOnly:!0}):Pe(),w=_&&!a?Z(_,{departments:["Delivery","Delivery Coordinator","Delivery Coordinators"],roles:["staff"],activeOnly:!0}):Fe();let[u,m,p,b,k]=await Promise.all([o,c,d,S,w]);if(_&&!a||((!Array.isArray(u)||u.length===0)&&(u=await ge().catch(()=>[])),(!Array.isArray(m)||m.length===0)&&(m=await fe().catch(()=>[]))),(!Array.isArray(p)||p.length===0)&&(p=await X({activeOnly:!0}).catch(()=>[])||[]),(!Array.isArray(b)||b.length===0)&&(b=await X({activeOnly:!0}).catch(()=>[])||[]),(!Array.isArray(k)||k.length===0)&&(k=await X({activeOnly:!0}).catch(()=>[])||[]),!t)return;const v=g=>Array.isArray(g)?g.filter(r=>(r==null?void 0:r.role)==="staff"||(r==null?void 0:r.role)===void 0):[];ne(u||[]),ae(m||[]);const N=v(p),I=v(b),L=v(k);re(N!=null&&N.length?N:p||[]),oe(I!=null&&I.length?I:b||[]),de(L!=null&&L.length?L:k||[])}catch(a){console.error("DealForm dropdown load error",a)}finally{t&&O(!1)}})(),()=>{t=!1}},[_]),i.useEffect(()=>{!(M!=null&&M.length)&&(n!=null&&n.vendor_id)&&ne([{id:n.vendor_id,value:n.vendor_id,label:"Selected vendor"}]),!(V!=null&&V.length)&&(n!=null&&n.assigned_to)&&re([{id:n.assigned_to,value:n.assigned_to,label:"Selected sales"}]),!(T!=null&&T.length)&&(n!=null&&n.finance_manager_id)&&oe([{id:n.finance_manager_id,value:n.finance_manager_id,label:"Selected finance"}]),!(z!=null&&z.length)&&(n!=null&&n.delivery_coordinator_id)&&de([{id:n.delivery_coordinator_id,value:n.delivery_coordinator_id,label:"Selected delivery"}]);const t=new Set(((n==null?void 0:n.lineItems)||[]).map(a=>a!=null&&a.product_id?String(a.product_id):null).filter(Boolean));if(!(C!=null&&C.length)&&t.size>0){const a=[];((n==null?void 0:n.lineItems)||[]).forEach(o=>{if(!(o!=null&&o.product_id))return;const c=String(o.product_id);t.has(c)&&(a.push({id:c,value:c,label:"Selected product",unit_price:Number((o==null?void 0:o.unit_price)??0)}),t.delete(c))}),a.length&&ae(a)}},[n]);const xe=i.useMemo(()=>{const t=new Map;return(C||[]).forEach(a=>{const o=a.id??a.value;o!=null&&t.set(String(o),a)}),t},[C]),j=(t,a)=>D(o=>({...o,[t]:a})),H=(t,a)=>D(o=>({...o,loanerForm:{...o.loanerForm||{},[t]:a}})),A=(t,a,o)=>D(c=>{const d={...c},S=Array.isArray(d.lineItems)?[...d.lineItems]:[],w={...S[t]||{}};if(w[a]=o,a==="product_id"){const u=xe.get(String(o));u&&u.unit_price!==void 0&&(w.unit_price=Number(u.unit_price||0))}return a==="no_schedule_reason"&&String(o||"").trim()&&K(u=>{var b;if(!u||!((b=u[t])!=null&&b.noScheduleReason))return u;const m={...u},p={...m[t]||{}};return delete p.noScheduleReason,Object.keys(p).length?m[t]=p:delete m[t],m}),a==="requires_scheduling"&&o&&K(u=>{var b;if(!u||!((b=u[t])!=null&&b.noScheduleReason))return u;const m={...u},p={...m[t]||{}};return delete p.noScheduleReason,Object.keys(p).length?m[t]=p:delete m[t],m}),S[t]=w,d.lineItems=S,d}),ye=()=>D(t=>({...t,lineItems:[...t.lineItems,J()]})),je=t=>D(a=>({...a,lineItems:a.lineItems.filter((o,c)=>c!==t)})),U=i.useMemo(()=>{try{return JSON.stringify(n)!==le}catch{return!0}},[n,le]);i.useEffect(()=>{const t=a=>{if(!(!U||x))return a.preventDefault(),a.returnValue="",""};return window.addEventListener("beforeunload",t),()=>window.removeEventListener("beforeunload",t)},[U,x]);const Ne=()=>{x||U&&!window.confirm("You have unsaved changes. Discard them?")||F==null||F()},Se=i.useMemo(()=>{try{return(n.lineItems||[]).reduce((t,a)=>{const o=Number((a==null?void 0:a.quantity_used)??1)||1,c=Number((a==null?void 0:a.unit_price)??0)||0;return t+o*c},0)}catch{return 0}},[n.lineItems]),we=i.useMemo(()=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),[]),ke=async t=>{var a,o,c,d,S,w,u,m,p,b,k;if((a=t==null?void 0:t.preventDefault)==null||a.call(t),!x){$(!0),Y("");try{if((n.lineItems||[]).reduce((r,l,h)=>(l!=null&&l.product_id&&r.push(h),r),[]).length===0){$(!1),Y("Please add at least one product to the deal.");try{const r=document.querySelector('[data-testid="product-select-0"]');r==null||r.scrollIntoView({behavior:"smooth",block:"center"}),(o=r==null?void 0:r.focus)==null||o.call(r)}catch{}return}const N=(n.lineItems||[]).reduce((r,l,h)=>{const P=!!(l!=null&&l.requires_scheduling),Q=String((l==null?void 0:l.no_schedule_reason)||"").trim();return!P&&!Q&&r.push(h),r},[]);if(N.length>0){const r={};N.forEach(l=>{r[l]={...r[l]||{},noScheduleReason:!0}}),K(r),$(!1);try{const l=N[0],h=document.querySelector(`[data-testid="no-schedule-reason-${l}"]`);h==null||h.scrollIntoView({behavior:"smooth",block:"center"}),(c=h==null?void 0:h.focus)==null||c.call(h)}catch{}return}else K({});const I=r=>{try{const l=String(r||"").replace(/\D+/g,"");return l.length===10?`+1${l}`:l.length===11&&l.startsWith("1")?`+${l}`:r||""}catch{return r||""}},L=(n.lineItems||[]).map(r=>({product_id:r.product_id||null,quantity_used:Number(r.quantity_used||1),unit_price:Number(r.unit_price||0),promised_date:r.promised_date||r.lineItemPromisedDate||null,requires_scheduling:!!r.requires_scheduling||!!r.requiresScheduling,no_schedule_reason:r.no_schedule_reason||r.noScheduleReason||null,is_off_site:!!r.is_off_site||!!r.isOffSite,lineItemPromisedDate:r.lineItemPromisedDate||r.promised_date||null,requiresScheduling:!!r.requiresScheduling||!!r.requires_scheduling,noScheduleReason:r.noScheduleReason||r.no_schedule_reason||null,isOffSite:!!r.isOffSite||!!r.is_off_site})),g={...n,org_id:n.org_id||_||void 0,customer_needs_loaner:!!n.customer_needs_loaner,loanerForm:n.customer_needs_loaner?{loaner_number:((S=(d=n==null?void 0:n.loanerForm)==null?void 0:d.loaner_number)==null?void 0:S.trim())||"",eta_return_date:((w=n==null?void 0:n.loanerForm)==null?void 0:w.eta_return_date)||null,notes:((u=n==null?void 0:n.loanerForm)==null?void 0:u.notes)||""}:null,customer_phone:I(n.customer_phone||n.customer_mobile||""),customerPhone:I(n.customerPhone||n.customer_mobile||n.customer_phone||""),lineItems:L};if(R){await R(g),await(q==null?void 0:q("DealForm",{orgId:_,hasLineItems:((m=g==null?void 0:g.lineItems)==null?void 0:m.length)>0},!0)),se(Date.now());try{(p=y==null?void 0:y.success)==null||p.call(y,"Saved successfully")}catch{}}else if(te){const r=await te,l=(r==null?void 0:r.default)??r;let h=null;if(E==="edit"&&g.id?h=await l.updateDeal(g.id,g):h=await l.createDeal(g),h)try{const P=l.mapDbDealToForm?l.mapDbDealToForm(h):null;P&&D(Q=>({...Q,...P,lineItems:P.lineItems||[]}))}catch(P){console.warn("Failed to map saved record to form:",P)}await(q==null?void 0:q("DealForm",{orgId:_,hasLineItems:((b=g==null?void 0:g.lineItems)==null?void 0:b.length)>0},!0)),se(Date.now());try{(k=y==null?void 0:y.success)==null||k.call(y,"Saved successfully")}catch{}}}catch(v){const N=(v==null?void 0:v.message)||String(v);console.error("Deal save failed",v),Y(N);try{await(W==null?void 0:W(v,{where:"DealForm.submit",orgId:_}))}catch{}}finally{$(!1)}}};return f?e.jsx("div",{className:"p-4",children:"Loading…"}):e.jsxs("form",{className:"space-y-6 p-4",onSubmit:ke,"data-testid":"deal-form",children:[e.jsxs("section",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Deal / Job #"}),e.jsx("input",{"data-testid":"deal-number-input",type:"text",value:n.job_number,onChange:t=>j("job_number",t.target.value),className:"mt-1 input-mobile w-full",placeholder:"Auto or manual"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Stock #"}),e.jsx("input",{"data-testid":"stock-number-display",type:"text",value:n.stock_number||"",onChange:t=>j("stock_number",t.target.value),className:"mt-1 input-mobile w-full",placeholder:"e.g. A1234"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Customer Mobile"}),e.jsx("input",{"data-testid":"customer-mobile-input",type:"tel",value:n.customer_mobile,onChange:t=>j("customer_mobile",t.target.value),className:"mt-1 input-mobile w-full",placeholder:"+1 555 555 5555"})]})]}),e.jsxs("section",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Vendor"}),e.jsxs("select",{"data-testid":"vendor-select",value:n.vendor_id||"",onChange:t=>j("vendor_id",t.target.value||null),className:"mt-1 input-mobile w-full",children:[e.jsx("option",{value:"",children:"— Select Vendor —"}),M.map(t=>e.jsx("option",{value:t.value,children:t.label},t.id))]}),M.length===0&&e.jsx("p",{className:"mt-2 text-sm text-amber-700 bg-amber-50 rounded px-2 py-1",children:"No vendors available. Check Admin → Vendors to add or attach vendors to your org."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Description"}),e.jsx("textarea",{"data-testid":"description-input",value:n.description,onChange:t=>j("description",t.target.value),className:"mt-1 input-mobile w-full",rows:3})]})]}),e.jsxs("section",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Sales Consultant"}),e.jsxs("select",{"data-testid":"sales-select",value:n.assigned_to||"",onChange:t=>j("assigned_to",t.target.value||null),className:"mt-1 input-mobile w-full",children:[e.jsx("option",{value:"",children:"— Select Sales —"}),V.map(t=>e.jsx("option",{value:t.value,children:t.label},t.id))]}),V.length===0&&e.jsx("p",{className:"mt-2 text-sm text-amber-700 bg-amber-50 rounded px-2 py-1",children:"No sales staff found. Use Admin → Staff Records to add staff and assign to your org."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Finance Manager"}),e.jsxs("select",{"data-testid":"finance-select",value:n.finance_manager_id||"",onChange:t=>j("finance_manager_id",t.target.value||null),className:"mt-1 input-mobile w-full",children:[e.jsx("option",{value:"",children:"— Select Finance —"}),T.map(t=>e.jsx("option",{value:t.value,children:t.label},t.id))]}),T.length===0&&e.jsx("p",{className:"mt-2 text-sm text-amber-700 bg-amber-50 rounded px-2 py-1",children:"No finance managers found. Add or attach staff in Admin → Staff Records."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Delivery Coordinator"}),e.jsxs("select",{"data-testid":"delivery-select",value:n.delivery_coordinator_id||"",onChange:t=>j("delivery_coordinator_id",t.target.value||null),className:"mt-1 input-mobile w-full",children:[e.jsx("option",{value:"",children:"— Select Delivery —"}),z.map(t=>e.jsx("option",{value:t.value,children:t.label},t.id))]}),z.length===0&&e.jsx("p",{className:"mt-2 text-sm text-amber-700 bg-amber-50 rounded px-2 py-1",children:"No delivery coordinators found. Add or attach staff in Admin → Staff Records."})]})]}),e.jsxs("section",{className:"flex items-center gap-3",children:[e.jsx("input",{"data-testid":"loaner-checkbox",id:"needsLoaner",type:"checkbox",checked:!!n.customer_needs_loaner,onChange:t=>j("customer_needs_loaner",t.target.checked),className:"h-5 w-5 accent-blue-600 appearance-auto"}),e.jsx("label",{htmlFor:"needsLoaner",className:"text-sm text-slate-800",children:"Customer needs loaner"})]}),n.customer_needs_loaner?e.jsxs("section",{className:"grid grid-cols-1 md:grid-cols-3 gap-4","data-testid":"loaner-section",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Loaner Number"}),e.jsx("input",{"data-testid":"loaner-number-input",type:"text",value:((_e=n==null?void 0:n.loanerForm)==null?void 0:_e.loaner_number)||"",onChange:t=>H("loaner_number",t.target.value),className:"mt-1 input-mobile w-full",placeholder:"e.g. L-1024"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"ETA Return Date"}),e.jsx("input",{"data-testid":"loaner-eta-input",type:"date",value:((pe=n==null?void 0:n.loanerForm)==null?void 0:pe.eta_return_date)||"",onChange:t=>H("eta_return_date",t.target.value||""),className:"mt-1 input-mobile w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Notes"}),e.jsx("input",{"data-testid":"loaner-notes-input",type:"text",value:((be=n==null?void 0:n.loanerForm)==null?void 0:be.notes)||"",onChange:t=>H("notes",t.target.value),className:"mt-1 input-mobile w-full",placeholder:"Optional"})]})]}):null,e.jsxs("section",{className:"space-y-4","data-testid":"line-items-section",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Line Items"}),e.jsx("button",{type:"button",onClick:ye,className:"btn-mobile btn-mobile-sm","data-testid":"add-line-item-btn",children:"+ Add Item"})]}),C.length===0&&e.jsx("div",{className:"p-3 rounded bg-amber-50 text-amber-800 text-sm",children:"No products available. Check Admin → Aftermarket Products to add/attach products."}),n.lineItems.map((t,a)=>{var c;const o=`li-${a}`;return t.is_off_site,e.jsxs("div",{className:"card-mobile space-y-3","data-testid":`line-${a}`,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-3",children:[e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Product"}),e.jsxs("select",{"data-testid":`product-select-${a}`,value:t.product_id||"",onChange:d=>A(a,"product_id",d.target.value||""),className:"mt-1 input-mobile w-full",children:[e.jsx("option",{value:"",children:"— Select Product —"}),C.map(d=>e.jsx("option",{value:d.value,children:d.label},d.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Unit Price"}),e.jsx("input",{"data-testid":`unit-price-input-${a}`,type:"number",inputMode:"decimal",step:"0.01",value:t.unit_price,onChange:d=>A(a,"unit_price",Number(d.target.value||0)),className:"mt-1 input-mobile w-full input-currency"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{type:"button",onClick:()=>je(a),className:"btn-mobile btn-mobile-sm w-full","data-testid":`remove-line-item-btn-${a}`,children:"Remove"})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("label",{className:`inline-flex items-center gap-2 cursor-pointer border rounded px-3 py-2
                    ${t.is_off_site?"border-gray-300":"ring-2 ring-blue-400 bg-blue-50 border-blue-300"}`,children:[e.jsx("input",{type:"radio",name:`serviceLocation_${o}`,checked:!t.is_off_site,onChange:()=>A(a,"is_off_site",!1),className:"h-4 w-4 accent-blue-600 appearance-auto","data-testid":`onsite-radio-${a}`}),e.jsx("span",{className:"text-sm",children:"On-Site"})]}),e.jsxs("label",{className:`inline-flex items-center gap-2 cursor-pointer border rounded px-3 py-2
                    ${t.is_off_site?"ring-2 ring-blue-400 bg-blue-50 border-blue-300":"border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:`serviceLocation_${o}`,checked:!!t.is_off_site,onChange:()=>A(a,"is_off_site",!0),className:"h-4 w-4 accent-blue-600 appearance-auto","data-testid":`offsite-radio-${a}`}),e.jsx("span",{className:"text-sm",children:"Off-Site"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Promised Date"}),e.jsx("input",{"data-testid":`promised-date-${a}`,type:"date",value:t.promised_date||"",onChange:d=>A(a,"promised_date",d.target.value||""),className:"mt-1 input-mobile w-full"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-6",children:[e.jsx("input",{id:`requiresScheduling-${a}`,"data-testid":`requires-scheduling-${a}`,type:"checkbox",checked:!!t.requires_scheduling,onChange:d=>A(a,"requires_scheduling",d.target.checked),className:"h-5 w-5 accent-blue-600 appearance-auto"}),e.jsx("label",{htmlFor:`requiresScheduling-${a}`,className:"text-sm",children:"Requires Scheduling"})]}),!t.requires_scheduling&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"No Schedule Reason"}),e.jsx("input",{"data-testid":`no-schedule-reason-${a}`,type:"text",value:t.no_schedule_reason||"",onChange:d=>A(a,"no_schedule_reason",d.target.value||""),className:"mt-1 input-mobile w-full"}),((c=G==null?void 0:G[a])==null?void 0:c.noScheduleReason)&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:"Reason is required when not scheduling."})]})]})]},o)})]}),e.jsxs("section",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Calendar Notes"}),e.jsx("textarea",{"data-testid":"calendar-notes-input",value:n.calendar_notes||"",onChange:t=>j("calendar_notes",t.target.value),className:"mt-1 input-mobile w-full",rows:3})]}),e.jsx("section",{className:"sticky bottom-20 md:bottom-0 z-40 -mx-4 px-4 py-3 bg-white/90 backdrop-blur border-t shadow-sm",style:{paddingBottom:"max(env(safe-area-inset-bottom), 0px)"},children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-baseline gap-2","data-testid":"deal-total",children:[e.jsx("span",{className:"text-sm text-slate-600",children:"Total"}),e.jsx("span",{className:"text-lg font-semibold","data-testid":"deal-total-amount",children:we.format(Se||0)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:Ne,className:"btn-mobile button-outline-enhanced",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:x,className:"btn-mobile button-enhanced","data-testid":"save-deal-btn",children:x?"Saving…":E==="edit"?"Save Changes":"Create Deal"})]})]})}),B?e.jsx("div",{className:"mt-3 p-3 rounded bg-red-50 text-red-700","data-testid":"save-error",children:B}):null,ve&&!B?e.jsx("div",{className:"mt-3 p-3 rounded bg-emerald-50 text-emerald-700","data-testid":"save-success",children:"Saved successfully."}):null,e.jsx(Ee,{isDirty:U,isSubmitting:x})]})}export{Ke as default};
//# sourceMappingURL=DealForm-DynFS31n.js.map
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/dealService-BiwUi1HC.js","assets/index-Z7SfelWm.js","assets/react-Czq5O75u.js","assets/supabase-D02rA7zj.js","assets/router-CZES1Sa0.js","assets/index-DdnN4B9y.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}