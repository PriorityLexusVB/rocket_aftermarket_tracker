import{a as V,ao as m,j as s,ap as D,d as I,e as _,i as B}from"./index-xGVZGovN.js";import{r as i}from"./react-Czq5O75u.js";import{l as R,a as G,b as M,c as J}from"./tenantService-BE5FM5-E.js";import{a as K}from"./smsTemplateService-B227VVoW.js";import"./supabase-D02rA7zj.js";import"./router-CZES1Sa0.js";import"./options-CllavUpK.js";function X(){var u,j,p,f,b,N,v,S,y;const{orgId:l,loading:O,session:o}=V(),[e,P]=i.useState({}),[T,h]=i.useState(!1),[g,x]=i.useState(null),[n,c]=i.useState({configured:!1,ok:null,last:null});return i.useEffect(()=>{let a=!0;async function d(){var r;h(!0),x(null);try{const[t,w,A,k]=await Promise.all([I({activeOnly:!1}),_({activeOnly:!1}),B({activeOnly:!1}),(r=K)==null?void 0:r({activeOnly:!1}).catch(()=>[])]),[C,E,L,U]=await Promise.all([l?R(l,{activeOnly:!1}):Promise.resolve([]),l?G(l,{activeOnly:!1}):Promise.resolve([]),l?M(l,{activeOnly:!1}):Promise.resolve([]),l?J(l,{activeOnly:!1}):Promise.resolve([])]);if(!a)return;P({global:{vendors:t.length,products:w.length,users:A.length,sms_templates:k.length},org:{vendors:C.length,products:E.length,users:L.length,sms_templates:U.length}})}catch(t){console.error("debug-auth load error",t),a&&x((t==null?void 0:t.message)||String(t))}finally{a&&h(!1)}}return d(),c(r=>{var t;return{...r,configured:!!((t=m)!=null&&t())}}),()=>{a=!1}},[l]),s.jsxs("div",{className:"p-6",children:[s.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Debug: Auth / Org / Tenancy"}),s.jsxs("section",{className:"mb-4",children:[s.jsx("h2",{className:"font-semibold",children:"Session"}),s.jsxs("div",{className:"mb-2",children:[s.jsx("span",{className:"text-sm text-slate-600",children:"Session User ID: "}),s.jsx("strong",{"data-testid":"session-user-id",children:((u=o==null?void 0:o.user)==null?void 0:u.id)||"—"})]}),s.jsx("pre",{className:"bg-gray-100 p-2 rounded",children:JSON.stringify(o||null,null,2)})]}),s.jsxs("section",{className:"mb-4",children:[s.jsx("h2",{className:"font-semibold",children:"Tenant"}),s.jsxs("div",{children:["orgId: ",s.jsx("strong",{"data-testid":"profile-org-id",children:String(l)})]}),s.jsxs("div",{children:["loading: ",s.jsx("strong",{children:String(O)})]})]}),s.jsxs("section",{className:"mb-4",children:[s.jsx("h2",{className:"font-semibold",children:"Supabase connection"}),s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("span",{children:"Configured:"}),s.jsx("strong",{"data-testid":"sb-configured",children:n.configured?"Yes":"No"}),s.jsx("button",{type:"button",className:"btn-mobile btn-mobile-sm",onClick:async()=>{var a,d,r;try{const t=await((a=D)==null?void 0:a(2));c({configured:!!((d=m)!=null&&d()),ok:t,last:new Date})}catch{c({configured:!!((r=m)!=null&&r()),ok:!1,last:new Date})}},"data-testid":"sb-test-btn",children:"Test"})]}),s.jsxs("div",{children:["Status:"," ",s.jsx("strong",{"data-testid":"sb-status",children:n.ok==null?"—":n.ok?"OK":"Error"}),n.last?s.jsxs("span",{className:"ml-2 text-slate-600 text-sm","data-testid":"sb-last",children:["(",n.last.toLocaleTimeString(),")"]}):null]}),s.jsx("p",{className:"text-slate-500 text-sm mt-1",children:"If you see “Error” but the app otherwise works, it may be an RLS-permission message. The test treats those as reachable."})]}),s.jsxs("section",{className:"mb-4",children:[s.jsx("h2",{className:"font-semibold",children:"Counts"}),T?s.jsx("div",{children:"Loading counts..."}):g?s.jsxs("div",{className:"text-red-600",children:["Error: ",g]}):s.jsxs("div",{children:[s.jsx("h3",{className:"mt-2",children:"Global"}),s.jsxs("ul",{children:[s.jsxs("li",{children:["Vendors:"," ",s.jsx("span",{"data-testid":"global-vendor-count",children:((j=e==null?void 0:e.global)==null?void 0:j.vendors)??"N/A"})]}),s.jsxs("li",{children:["Products:"," ",s.jsx("span",{"data-testid":"global-product-count",children:((p=e==null?void 0:e.global)==null?void 0:p.products)??"N/A"})]}),s.jsxs("li",{children:["Users:"," ",s.jsx("span",{"data-testid":"global-staff-count",children:((f=e==null?void 0:e.global)==null?void 0:f.users)??"N/A"})]}),s.jsxs("li",{children:["SMS Templates:"," ",s.jsx("span",{"data-testid":"global-sms-template-count",children:((b=e==null?void 0:e.global)==null?void 0:b.sms_templates)??"N/A"})]})]}),s.jsx("h3",{className:"mt-2",children:"Org-scoped"}),s.jsxs("ul",{children:[s.jsxs("li",{children:["Vendors: ",s.jsx("span",{"data-testid":"org-vendor-count",children:((N=e==null?void 0:e.org)==null?void 0:N.vendors)??"N/A"})]}),s.jsxs("li",{children:["Products:"," ",s.jsx("span",{"data-testid":"org-product-count",children:((v=e==null?void 0:e.org)==null?void 0:v.products)??"N/A"})]}),s.jsxs("li",{children:["Users: ",s.jsx("span",{"data-testid":"org-staff-count",children:((S=e==null?void 0:e.org)==null?void 0:S.users)??"N/A"})]}),s.jsxs("li",{children:["SMS Templates:"," ",s.jsx("span",{"data-testid":"org-sms-template-count",children:((y=e==null?void 0:e.org)==null?void 0:y.sms_templates)??"N/A"})]})]})]})]}),s.jsxs("section",{className:"mb-4",children:[s.jsx("h2",{className:"font-semibold",children:"Notes"}),s.jsxs("ul",{className:"list-disc ml-6",children:[s.jsxs("li",{children:["This page uses tenant-aware list functions when ",s.jsx("code",{children:"orgId"})," exists."]}),s.jsx("li",{children:"Permission / RLS errors will appear in the console and in the error box above."})]})]})]})}export{X as default};
//# sourceMappingURL=debug-auth-ByjSadGp.js.map
