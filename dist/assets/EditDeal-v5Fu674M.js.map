{"version":3,"file":"EditDeal-v5Fu674M.js","sources":["../../src/pages/deals/EditDeal.jsx"],"sourcesContent":["// src/pages/deals/EditDeal.jsx\r\nimport React, { useEffect, useState } from 'react'\r\nimport { useNavigate, useParams } from 'react-router-dom'\r\nimport DealForm from './DealForm'\r\nimport * as dealService from '../../services/dealService'\r\n\r\nexport default function EditDeal() {\r\n  const { id } = useParams()\r\n  const navigate = useNavigate()\r\n  const [initial, setInitial] = useState(null)\r\n  const [loading, setLoading] = useState(true)\r\n  const [saving, setSaving] = useState(false)\r\n\r\n  useEffect(() => {\r\n    let alive = true\r\n    ;(async () => {\r\n      try {\r\n        const d = await dealService?.getDeal(id)\r\n        if (alive) {\r\n          const mapped = dealService.mapDbDealToForm ? dealService.mapDbDealToForm(d) : d\r\n          setInitial(mapped)\r\n        }\r\n      } catch (e) {\r\n        alert(e?.message || 'Failed to load deal')\r\n      } finally {\r\n        if (alive) setLoading(false)\r\n      }\r\n    })()\r\n    return () => {\r\n      alive = false\r\n    }\r\n  }, [id])\r\n\r\n  async function onSubmit(formState) {\r\n    setSaving(true)\r\n    try {\r\n      // Update then re-fetch latest persisted values; stay on Edit\r\n      await dealService?.updateDeal(id, formState)\r\n      const fresh = await dealService?.getDeal(id)\r\n      const mapped = dealService.mapDbDealToForm ? dealService.mapDbDealToForm(fresh) : fresh\r\n      setInitial(mapped)\r\n    } catch (e) {\r\n      alert(e?.message || 'Failed to save deal')\r\n    } finally {\r\n      setSaving(false)\r\n    }\r\n  }\r\n\r\n  if (loading) {\r\n    return <div className=\"max-w-5xl mx-auto p-8\">Loading...</div>\r\n  }\r\n\r\n  const dealNumber = initial?.job_number || `#${id}`\r\n  const stockNumber = initial?.vehicle?.stock_number || initial?.stock_number || 'â€”'\r\n\r\n  return (\r\n    <div className=\"max-w-5xl mx-auto p-4 md:p-8\">\r\n      <header className=\"mb-4\">\r\n        <h1 className=\"text-xl font-semibold\">\r\n          Deal {dealNumber} / Stock # {stockNumber}\r\n        </h1>\r\n      </header>\r\n\r\n      <div className=\"mb-6\">\r\n        <h1 className=\"text-2xl font-semibold\">Edit Deal</h1>\r\n        <p className=\"text-gray-600\">Update details and save.</p>\r\n      </div>\r\n      <DealForm\r\n        mode=\"edit\"\r\n        initial={initial}\r\n        onSave={onSubmit}\r\n        onCancel={() => navigate('/deals')}\r\n        saving={saving}\r\n      />\r\n    </div>\r\n  )\r\n}\r\n"],"names":["EditDeal","id","useParams","navigate","useNavigate","initial","setInitial","useState","loading","setLoading","saving","setSaving","useEffect","alive","d","dealService?.getDeal","mapped","dealService.mapDbDealToForm","onSubmit","formState","dealService?.updateDeal","fresh","jsx","dealNumber","stockNumber","_a","jsxs","DealForm"],"mappings":"2ZAMA,SAAwBA,GAAW,OACjC,KAAM,CAAE,GAAAC,CAAA,EAAOC,EAAA,EACTC,EAAWC,EAAA,EACX,CAACC,EAASC,CAAU,EAAIC,EAAAA,SAAS,IAAI,EACrC,CAACC,EAASC,CAAU,EAAIF,EAAAA,SAAS,EAAI,EACrC,CAACG,EAAQC,CAAS,EAAIJ,EAAAA,SAAS,EAAK,EAE1CK,EAAAA,UAAU,IAAM,CACd,IAAIC,EAAQ,GACX,OAAC,SAAY,CACZ,GAAI,CACF,MAAMC,EAAI,MAAMC,EAAqBd,CAAE,EACvC,GAAIY,EAAO,CACT,MAAMG,EAASC,EAA8BA,EAA4BH,CAAC,EAAIA,EAC9ER,EAAWU,CAAM,CACnB,CACF,OAAS,EAAG,CACV,OAAM,iBAAG,UAAW,qBAAqB,CAC3C,QAAA,CACMH,GAAOJ,EAAW,EAAK,CAC7B,CACF,GAAA,EACO,IAAM,CACXI,EAAQ,EACV,CACF,EAAG,CAACZ,CAAE,CAAC,EAEP,eAAeiB,EAASC,EAAW,CACjCR,EAAU,EAAI,EACd,GAAI,CAEF,MAAMS,EAAwBnB,EAAIkB,CAAS,EAC3C,MAAME,EAAQ,MAAMN,EAAqBd,CAAE,EACrCe,EAASC,EAA8BA,EAA4BI,CAAK,EAAIA,EAClFf,EAAWU,CAAM,CACnB,OAAS,EAAG,CACV,OAAM,iBAAG,UAAW,qBAAqB,CAC3C,QAAA,CACEL,EAAU,EAAK,CACjB,CACF,CAEA,GAAIH,EACF,OAAOc,EAAAA,IAAC,MAAA,CAAI,UAAU,wBAAwB,SAAA,aAAU,EAG1D,MAAMC,GAAalB,GAAA,YAAAA,EAAS,aAAc,IAAIJ,CAAE,GAC1CuB,IAAcC,EAAApB,GAAA,YAAAA,EAAS,UAAT,YAAAoB,EAAkB,gBAAgBpB,GAAA,YAAAA,EAAS,eAAgB,IAE/E,OACEqB,EAAAA,KAAC,MAAA,CAAI,UAAU,+BACb,SAAA,CAAAJ,EAAAA,IAAC,UAAO,UAAU,OAChB,SAAAI,EAAAA,KAAC,KAAA,CAAG,UAAU,wBAAwB,SAAA,CAAA,QAC9BH,EAAW,cAAYC,CAAA,CAAA,CAC/B,CAAA,CACF,EAEAE,EAAAA,KAAC,MAAA,CAAI,UAAU,OACb,SAAA,CAAAJ,EAAAA,IAAC,KAAA,CAAG,UAAU,yBAAyB,SAAA,YAAS,EAChDA,EAAAA,IAAC,IAAA,CAAE,UAAU,gBAAgB,SAAA,0BAAA,CAAwB,CAAA,EACvD,EACAA,EAAAA,IAACK,EAAA,CACC,KAAK,OACL,QAAAtB,EACA,OAAQa,EACR,SAAU,IAAMf,EAAS,QAAQ,EACjC,OAAAO,CAAA,CAAA,CACF,EACF,CAEJ"}