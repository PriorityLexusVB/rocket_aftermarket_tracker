import{_ as ke}from"./supabase-D02rA7zj.js";import{a as Ie,m as Ce,d as De,e as Fe,g as _e,c as pe,b as ge,j as e}from"./index-CsUHg1Df.js";import{r as i}from"./react-Czq5O75u.js";import{l as Pe,a as Ae,b as A}from"./tenantService-D5wbB6s9.js";import{u as Le}from"./useLogger-CDt-ZQKL.js";import"./router-CZES1Sa0.js";import"./options-CllavUpK.js";function qe({isDirty:s,isSubmitting:L}){return i.useEffect(()=>{if(!s||L)return;const D=b=>{if(b.defaultPrevented||b.button!==0||b.metaKey||b.altKey||b.ctrlKey||b.shiftKey)return;const F=b.target.closest?b.target.closest("a[href]"):null;if(!F||F.target==="_blank")return;const v=F.getAttribute("href")||"";if(!v||/^(https?:)?\/\//i.test(v))return;window.confirm("You have unsaved changes. Discard them?")||(b.preventDefault(),b.stopPropagation())},q=b=>{window.confirm("You have unsaved changes. Discard them?")||history.go(1)};return document.addEventListener("click",D,!0),window.addEventListener("popstate",q),()=>{document.removeEventListener("click",D,!0),window.removeEventListener("popstate",q)}},[s,L]),null}let Q;try{Q=ke(()=>import("./dealService-th_4Casr.js"),__vite__mapDeps([0,1,2,3,4,5]))}catch{}const U=()=>({product_id:"",quantity_used:1,unit_price:0,promised_date:"",requires_scheduling:!0,no_schedule_reason:"",is_off_site:!1});function Be({initial:s={},mode:L="create",onCancel:D,onSave:q}){var re,oe,le,de,ce,ue,ie,me;const[b,F]=i.useState(!0),[v,E]=i.useState(!1),[T,z]=i.useState(""),[be,X]=i.useState(null),[J,B]=i.useState({}),[O,Z]=i.useState([]),[S,ee]=i.useState([]),[R,te]=i.useState([]),[$,se]=i.useState([]),[M,ne]=i.useState([]),[n,w]=i.useState({id:s.id||void 0,job_number:s.job_number||"",vehicle_id:s.vehicle_id||"",stock_number:s.stock_number||"",description:s.description||"",vendor_id:s.vendor_id||"",assigned_to:s.assigned_to||"",finance_manager_id:s.finance_manager_id||"",delivery_coordinator_id:s.delivery_coordinator_id||"",customer_mobile:s.customer_mobile||"",customer_needs_loaner:!!s.customer_needs_loaner,loanerForm:{loaner_number:((re=s==null?void 0:s.loanerForm)==null?void 0:re.loaner_number)||"",eta_return_date:((oe=s==null?void 0:s.loanerForm)==null?void 0:oe.eta_return_date)||"",notes:((le=s==null?void 0:s.loanerForm)==null?void 0:le.notes)||""},lineItems:(de=s.lineItems)!=null&&de.length?s.lineItems:[U()],promised_date:s.promised_date||"",scheduled_start_time:s.scheduled_start_time||"",scheduled_end_time:s.scheduled_end_time||"",calendar_notes:s.calendar_notes||""});i.useEffect(()=>{var a,o,c,l;s&&(s.id||s.job_number||Array.isArray(s.lineItems)&&s.lineItems.length>0)&&w({id:s.id||void 0,job_number:s.job_number||"",vehicle_id:s.vehicle_id||"",stock_number:s.stock_number||"",description:s.description||"",vendor_id:s.vendor_id||"",assigned_to:s.assigned_to||"",finance_manager_id:s.finance_manager_id||"",delivery_coordinator_id:s.delivery_coordinator_id||"",customer_mobile:s.customer_mobile||"",customer_needs_loaner:!!s.customer_needs_loaner,loanerForm:{loaner_number:((a=s==null?void 0:s.loanerForm)==null?void 0:a.loaner_number)||"",eta_return_date:((o=s==null?void 0:s.loanerForm)==null?void 0:o.eta_return_date)||"",notes:((c=s==null?void 0:s.loanerForm)==null?void 0:c.notes)||""},lineItems:(l=s.lineItems)!=null&&l.length?s.lineItems:[U()],promised_date:s.promised_date||"",scheduled_start_time:s.scheduled_start_time||"",scheduled_end_time:s.scheduled_end_time||"",calendar_notes:s.calendar_notes||""})},[s]);const{orgId:m}=Ie(),{logFormSubmission:P,logError:Y}=Le(),x=(ce=Ce)==null?void 0:ce(),[ae]=i.useState(()=>{var t;return JSON.stringify({id:s.id||void 0,job_number:s.job_number||"",vehicle_id:s.vehicle_id||"",stock_number:s.stock_number||"",description:s.description||"",vendor_id:s.vendor_id||"",assigned_to:s.assigned_to||"",finance_manager_id:s.finance_manager_id||"",delivery_coordinator_id:s.delivery_coordinator_id||"",customer_mobile:s.customer_mobile||"",customer_needs_loaner:!!s.customer_needs_loaner,lineItems:(t=s.lineItems)!=null&&t.length?s.lineItems:[U()],promised_date:s.promised_date||"",scheduled_start_time:s.scheduled_start_time||"",scheduled_end_time:s.scheduled_end_time||"",calendar_notes:s.calendar_notes||""})});i.useEffect(()=>{let t=!0;return(async()=>{try{const a=m?Pe(m,{activeOnly:!0}):De(),o=m?Ae(m,{activeOnly:!0}):Fe(),c=m?A(m,{departments:["Sales","Sales Consultant","Sales Consultants"],activeOnly:!0}):_e(),l=m?A(m,{departments:["Finance","Finance Manager","Finance Managers","Managers"],activeOnly:!0}):pe(),y=m?A(m,{departments:["Delivery","Delivery Coordinator","Delivery Coordinators"],activeOnly:!0}):ge();let[N,_,u,h,p]=await Promise.all([a,o,c,l,y]);if(m&&((!Array.isArray(u)||u.length===0)&&(u=await A(m,{activeOnly:!0}).catch(()=>[]),u!=null&&u.length||(u=await _e().catch(()=>[]))),(!Array.isArray(h)||h.length===0)&&(h=await A(m,{activeOnly:!0}).catch(()=>[]),h!=null&&h.length||(h=await pe().catch(()=>[]))),(!Array.isArray(p)||p.length===0)&&(p=await A(m,{activeOnly:!0}).catch(()=>[]),p!=null&&p.length||(p=await ge().catch(()=>[])))),!t)return;Z(N||[]),ee(_||[]),te(u||[]),se(h||[]),ne(p||[])}catch(a){console.error("DealForm dropdown load error",a)}finally{t&&F(!1)}})(),()=>{t=!1}},[m]),i.useEffect(()=>{!(O!=null&&O.length)&&(n!=null&&n.vendor_id)&&Z([{id:n.vendor_id,value:n.vendor_id,label:"Selected vendor"}]),!(R!=null&&R.length)&&(n!=null&&n.assigned_to)&&te([{id:n.assigned_to,value:n.assigned_to,label:"Selected sales"}]),!($!=null&&$.length)&&(n!=null&&n.finance_manager_id)&&se([{id:n.finance_manager_id,value:n.finance_manager_id,label:"Selected finance"}]),!(M!=null&&M.length)&&(n!=null&&n.delivery_coordinator_id)&&ne([{id:n.delivery_coordinator_id,value:n.delivery_coordinator_id,label:"Selected delivery"}]);const t=new Set(((n==null?void 0:n.lineItems)||[]).map(a=>a!=null&&a.product_id?String(a.product_id):null).filter(Boolean));if(!(S!=null&&S.length)&&t.size>0){const a=[];((n==null?void 0:n.lineItems)||[]).forEach(o=>{if(!(o!=null&&o.product_id))return;const c=String(o.product_id);t.has(c)&&(a.push({id:c,value:c,label:"Selected product",unit_price:Number((o==null?void 0:o.unit_price)??0)}),t.delete(c))}),a.length&&ee(a)}},[n]);const fe=i.useMemo(()=>{const t=new Map;return(S||[]).forEach(a=>{const o=a.id??a.value;o!=null&&t.set(String(o),a)}),t},[S]),j=(t,a)=>w(o=>({...o,[t]:a})),G=(t,a)=>w(o=>({...o,loanerForm:{...o.loanerForm||{},[t]:a}})),k=(t,a,o)=>w(c=>{const l={...c},y=Array.isArray(l.lineItems)?[...l.lineItems]:[],N={...y[t]||{}};if(N[a]=o,a==="product_id"){const _=fe.get(String(o));_&&_.unit_price!==void 0&&(N.unit_price=Number(_.unit_price||0))}return a==="no_schedule_reason"&&String(o||"").trim()&&B(_=>{var p;if(!_||!((p=_[t])!=null&&p.noScheduleReason))return _;const u={..._},h={...u[t]||{}};return delete h.noScheduleReason,Object.keys(h).length?u[t]=h:delete u[t],u}),a==="requires_scheduling"&&o&&B(_=>{var p;if(!_||!((p=_[t])!=null&&p.noScheduleReason))return _;const u={..._},h={...u[t]||{}};return delete h.noScheduleReason,Object.keys(h).length?u[t]=h:delete u[t],u}),y[t]=N,l.lineItems=y,l}),ve=()=>w(t=>({...t,lineItems:[...t.lineItems,U()]})),xe=t=>w(a=>({...a,lineItems:a.lineItems.filter((o,c)=>c!==t)})),K=i.useMemo(()=>{try{return JSON.stringify(n)!==ae}catch{return!0}},[n,ae]);i.useEffect(()=>{const t=a=>{if(!(!K||v))return a.preventDefault(),a.returnValue="",""};return window.addEventListener("beforeunload",t),()=>window.removeEventListener("beforeunload",t)},[K,v]);const je=()=>{v||K&&!window.confirm("You have unsaved changes. Discard them?")||D==null||D()},ye=i.useMemo(()=>{try{return(n.lineItems||[]).reduce((t,a)=>{const o=Number((a==null?void 0:a.quantity_used)??1)||1,c=Number((a==null?void 0:a.unit_price)??0)||0;return t+o*c},0)}catch{return 0}},[n.lineItems]),Ne=i.useMemo(()=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),[]),Se=async t=>{var a,o,c,l,y,N,_,u,h,p,he;if((a=t==null?void 0:t.preventDefault)==null||a.call(t),!v){E(!0),z("");try{if((n.lineItems||[]).reduce((r,d,g)=>(d!=null&&d.product_id&&r.push(g),r),[]).length===0){E(!1),z("Please add at least one product to the deal.");try{const r=document.querySelector('[data-testid="product-select-0"]');r==null||r.scrollIntoView({behavior:"smooth",block:"center"}),(o=r==null?void 0:r.focus)==null||o.call(r)}catch{}return}const V=(n.lineItems||[]).reduce((r,d,g)=>{const C=!!(d!=null&&d.requires_scheduling),H=String((d==null?void 0:d.no_schedule_reason)||"").trim();return!C&&!H&&r.push(g),r},[]);if(V.length>0){const r={};V.forEach(d=>{r[d]={...r[d]||{},noScheduleReason:!0}}),B(r),E(!1);try{const d=V[0],g=document.querySelector(`[data-testid="no-schedule-reason-${d}"]`);g==null||g.scrollIntoView({behavior:"smooth",block:"center"}),(c=g==null?void 0:g.focus)==null||c.call(g)}catch{}return}else B({});const W=r=>{try{const d=String(r||"").replace(/\D+/g,"");return d.length===10?`+1${d}`:d.length===11&&d.startsWith("1")?`+${d}`:r||""}catch{return r||""}},we=(n.lineItems||[]).map(r=>({product_id:r.product_id||null,quantity_used:Number(r.quantity_used||1),unit_price:Number(r.unit_price||0),promised_date:r.promised_date||r.lineItemPromisedDate||null,requires_scheduling:!!r.requires_scheduling||!!r.requiresScheduling,no_schedule_reason:r.no_schedule_reason||r.noScheduleReason||null,is_off_site:!!r.is_off_site||!!r.isOffSite,lineItemPromisedDate:r.lineItemPromisedDate||r.promised_date||null,requiresScheduling:!!r.requiresScheduling||!!r.requires_scheduling,noScheduleReason:r.noScheduleReason||r.no_schedule_reason||null,isOffSite:!!r.isOffSite||!!r.is_off_site})),f={...n,org_id:n.org_id||m||void 0,customer_needs_loaner:!!n.customer_needs_loaner,loanerForm:n.customer_needs_loaner?{loaner_number:((y=(l=n==null?void 0:n.loanerForm)==null?void 0:l.loaner_number)==null?void 0:y.trim())||"",eta_return_date:((N=n==null?void 0:n.loanerForm)==null?void 0:N.eta_return_date)||null,notes:((_=n==null?void 0:n.loanerForm)==null?void 0:_.notes)||""}:null,customer_phone:W(n.customer_phone||n.customer_mobile||""),customerPhone:W(n.customerPhone||n.customer_mobile||n.customer_phone||""),lineItems:we};if(q){await q(f),await(P==null?void 0:P("DealForm",{orgId:m,hasLineItems:((u=f==null?void 0:f.lineItems)==null?void 0:u.length)>0},!0)),X(Date.now());try{(h=x==null?void 0:x.success)==null||h.call(x,"Saved successfully")}catch{}}else if(Q){const r=await Q,d=(r==null?void 0:r.default)??r;let g=null;if(L==="edit"&&f.id?g=await d.updateDeal(f.id,f):g=await d.createDeal(f),g)try{const C=d.mapDbDealToForm?d.mapDbDealToForm(g):null;C&&w(H=>({...H,...C,lineItems:C.lineItems||[]}))}catch(C){console.warn("Failed to map saved record to form:",C)}await(P==null?void 0:P("DealForm",{orgId:m,hasLineItems:((p=f==null?void 0:f.lineItems)==null?void 0:p.length)>0},!0)),X(Date.now());try{(he=x==null?void 0:x.success)==null||he.call(x,"Saved successfully")}catch{}}}catch(I){const V=(I==null?void 0:I.message)||String(I);console.error("Deal save failed",I),z(V);try{await(Y==null?void 0:Y(I,{where:"DealForm.submit",orgId:m}))}catch{}}finally{E(!1)}}};return b?e.jsx("div",{className:"p-4",children:"Loading…"}):e.jsxs("form",{className:"space-y-6 p-4",onSubmit:Se,"data-testid":"deal-form",children:[e.jsxs("section",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Deal / Job #"}),e.jsx("input",{"data-testid":"deal-number-input",type:"text",value:n.job_number,onChange:t=>j("job_number",t.target.value),className:"mt-1 input-mobile w-full",placeholder:"Auto or manual"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Stock #"}),e.jsx("input",{"data-testid":"stock-number-display",type:"text",value:n.stock_number||"",onChange:t=>j("stock_number",t.target.value),className:"mt-1 input-mobile w-full",placeholder:"e.g. A1234"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Customer Mobile"}),e.jsx("input",{"data-testid":"customer-mobile-input",type:"tel",value:n.customer_mobile,onChange:t=>j("customer_mobile",t.target.value),className:"mt-1 input-mobile w-full",placeholder:"+1 555 555 5555"})]})]}),e.jsxs("section",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Vendor"}),e.jsxs("select",{"data-testid":"vendor-select",value:n.vendor_id||"",onChange:t=>j("vendor_id",t.target.value||null),className:"mt-1 input-mobile w-full",children:[e.jsx("option",{value:"",children:"— Select Vendor —"}),O.map(t=>e.jsx("option",{value:t.value,children:t.label},t.id))]}),O.length===0&&e.jsx("p",{className:"mt-2 text-sm text-amber-700 bg-amber-50 rounded px-2 py-1",children:"No vendors available. Check Admin → Vendors to add or attach vendors to your org."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Description"}),e.jsx("textarea",{"data-testid":"description-input",value:n.description,onChange:t=>j("description",t.target.value),className:"mt-1 input-mobile w-full",rows:3})]})]}),e.jsxs("section",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Sales Consultant"}),e.jsxs("select",{"data-testid":"sales-select",value:n.assigned_to||"",onChange:t=>j("assigned_to",t.target.value||null),className:"mt-1 input-mobile w-full",children:[e.jsx("option",{value:"",children:"— Select Sales —"}),R.map(t=>e.jsx("option",{value:t.value,children:t.label},t.id))]}),R.length===0&&e.jsx("p",{className:"mt-2 text-sm text-amber-700 bg-amber-50 rounded px-2 py-1",children:"No sales staff found. Use Admin → Staff Records to add staff and assign to your org."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Finance Manager"}),e.jsxs("select",{"data-testid":"finance-select",value:n.finance_manager_id||"",onChange:t=>j("finance_manager_id",t.target.value||null),className:"mt-1 input-mobile w-full",children:[e.jsx("option",{value:"",children:"— Select Finance —"}),$.map(t=>e.jsx("option",{value:t.value,children:t.label},t.id))]}),$.length===0&&e.jsx("p",{className:"mt-2 text-sm text-amber-700 bg-amber-50 rounded px-2 py-1",children:"No finance managers found. Add or attach staff in Admin → Staff Records."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Delivery Coordinator"}),e.jsxs("select",{"data-testid":"delivery-select",value:n.delivery_coordinator_id||"",onChange:t=>j("delivery_coordinator_id",t.target.value||null),className:"mt-1 input-mobile w-full",children:[e.jsx("option",{value:"",children:"— Select Delivery —"}),M.map(t=>e.jsx("option",{value:t.value,children:t.label},t.id))]}),M.length===0&&e.jsx("p",{className:"mt-2 text-sm text-amber-700 bg-amber-50 rounded px-2 py-1",children:"No delivery coordinators found. Add or attach staff in Admin → Staff Records."})]})]}),e.jsxs("section",{className:"flex items-center gap-3",children:[e.jsx("input",{"data-testid":"loaner-checkbox",id:"needsLoaner",type:"checkbox",checked:!!n.customer_needs_loaner,onChange:t=>j("customer_needs_loaner",t.target.checked),className:"h-5 w-5 accent-blue-600 appearance-auto"}),e.jsx("label",{htmlFor:"needsLoaner",className:"text-sm text-slate-800",children:"Customer needs loaner"})]}),n.customer_needs_loaner?e.jsxs("section",{className:"grid grid-cols-1 md:grid-cols-3 gap-4","data-testid":"loaner-section",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Loaner Number"}),e.jsx("input",{"data-testid":"loaner-number-input",type:"text",value:((ue=n==null?void 0:n.loanerForm)==null?void 0:ue.loaner_number)||"",onChange:t=>G("loaner_number",t.target.value),className:"mt-1 input-mobile w-full",placeholder:"e.g. L-1024"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"ETA Return Date"}),e.jsx("input",{"data-testid":"loaner-eta-input",type:"date",value:((ie=n==null?void 0:n.loanerForm)==null?void 0:ie.eta_return_date)||"",onChange:t=>G("eta_return_date",t.target.value||""),className:"mt-1 input-mobile w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Notes"}),e.jsx("input",{"data-testid":"loaner-notes-input",type:"text",value:((me=n==null?void 0:n.loanerForm)==null?void 0:me.notes)||"",onChange:t=>G("notes",t.target.value),className:"mt-1 input-mobile w-full",placeholder:"Optional"})]})]}):null,e.jsxs("section",{className:"space-y-4","data-testid":"line-items-section",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Line Items"}),e.jsx("button",{type:"button",onClick:ve,className:"btn-mobile btn-mobile-sm","data-testid":"add-line-item-btn",children:"+ Add Item"})]}),S.length===0&&e.jsx("div",{className:"p-3 rounded bg-amber-50 text-amber-800 text-sm",children:"No products available. Check Admin → Aftermarket Products to add/attach products."}),n.lineItems.map((t,a)=>{var c;const o=`li-${a}`;return t.is_off_site,e.jsxs("div",{className:"card-mobile space-y-3","data-testid":`line-${a}`,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-3",children:[e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Product"}),e.jsxs("select",{"data-testid":`product-select-${a}`,value:t.product_id||"",onChange:l=>k(a,"product_id",l.target.value||""),className:"mt-1 input-mobile w-full",children:[e.jsx("option",{value:"",children:"— Select Product —"}),S.map(l=>e.jsx("option",{value:l.value,children:l.label},l.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Unit Price"}),e.jsx("input",{"data-testid":`unit-price-input-${a}`,type:"number",step:"0.01",value:t.unit_price,onChange:l=>k(a,"unit_price",Number(l.target.value||0)),className:"mt-1 input-mobile w-full"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{type:"button",onClick:()=>xe(a),className:"btn-mobile btn-mobile-sm w-full","data-testid":`remove-line-item-btn-${a}`,children:"Remove"})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("label",{className:`inline-flex items-center gap-2 cursor-pointer border rounded px-3 py-2
                    ${t.is_off_site?"border-gray-300":"ring-2 ring-blue-400 bg-blue-50 border-blue-300"}`,children:[e.jsx("input",{type:"radio",name:`serviceLocation_${o}`,checked:!t.is_off_site,onChange:()=>k(a,"is_off_site",!1),className:"h-4 w-4 accent-blue-600 appearance-auto","data-testid":`onsite-radio-${a}`}),e.jsx("span",{className:"text-sm",children:"On-Site"})]}),e.jsxs("label",{className:`inline-flex items-center gap-2 cursor-pointer border rounded px-3 py-2
                    ${t.is_off_site?"ring-2 ring-blue-400 bg-blue-50 border-blue-300":"border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:`serviceLocation_${o}`,checked:!!t.is_off_site,onChange:()=>k(a,"is_off_site",!0),className:"h-4 w-4 accent-blue-600 appearance-auto","data-testid":`offsite-radio-${a}`}),e.jsx("span",{className:"text-sm",children:"Off-Site"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Promised Date"}),e.jsx("input",{"data-testid":`promised-date-${a}`,type:"date",value:t.promised_date||"",onChange:l=>k(a,"promised_date",l.target.value||""),className:"mt-1 input-mobile w-full"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-6",children:[e.jsx("input",{id:`requiresScheduling-${a}`,"data-testid":`requires-scheduling-${a}`,type:"checkbox",checked:!!t.requires_scheduling,onChange:l=>k(a,"requires_scheduling",l.target.checked),className:"h-5 w-5 accent-blue-600 appearance-auto"}),e.jsx("label",{htmlFor:`requiresScheduling-${a}`,className:"text-sm",children:"Requires Scheduling"})]}),!t.requires_scheduling&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"No Schedule Reason"}),e.jsx("input",{"data-testid":`no-schedule-reason-${a}`,type:"text",value:t.no_schedule_reason||"",onChange:l=>k(a,"no_schedule_reason",l.target.value||""),className:"mt-1 input-mobile w-full"}),((c=J==null?void 0:J[a])==null?void 0:c.noScheduleReason)&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:"Reason is required when not scheduling."})]})]})]},o)})]}),e.jsxs("section",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Calendar Notes"}),e.jsx("textarea",{"data-testid":"calendar-notes-input",value:n.calendar_notes||"",onChange:t=>j("calendar_notes",t.target.value),className:"mt-1 input-mobile w-full",rows:3})]}),e.jsx("section",{className:"sticky bottom-20 md:bottom-0 z-40 -mx-4 px-4 py-3 bg-white/90 backdrop-blur border-t shadow-sm",style:{paddingBottom:"max(env(safe-area-inset-bottom), 0px)"},children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-baseline gap-2","data-testid":"deal-total",children:[e.jsx("span",{className:"text-sm text-slate-600",children:"Total"}),e.jsx("span",{className:"text-lg font-semibold","data-testid":"deal-total-amount",children:Ne.format(ye||0)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:je,className:"btn-mobile button-outline-enhanced",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:v,className:"btn-mobile button-enhanced","data-testid":"save-deal-btn",children:v?"Saving…":L==="edit"?"Save Changes":"Create Deal"})]})]})}),T?e.jsx("div",{className:"mt-3 p-3 rounded bg-red-50 text-red-700","data-testid":"save-error",children:T}):null,be&&!T?e.jsx("div",{className:"mt-3 p-3 rounded bg-emerald-50 text-emerald-700","data-testid":"save-success",children:"Saved successfully."}):null,e.jsx(qe,{isDirty:K,isSubmitting:v})]})}export{Be as default};
//# sourceMappingURL=DealForm-Bo1_xlbw.js.map
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/dealService-th_4Casr.js","assets/index-CsUHg1Df.js","assets/react-Czq5O75u.js","assets/supabase-D02rA7zj.js","assets/router-CZES1Sa0.js","assets/index-CeywADe-.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}