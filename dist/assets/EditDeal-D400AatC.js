import{j as a}from"./index-CcC1YCBr.js";import{r as o}from"./react-Czq5O75u.js";import j from"./DealForm-DaYNisjC.js";import{getDeal as x,mapDbDealToForm as n,updateDeal as N}from"./dealService-D6CPrm_A.js";import{c as S,a as y}from"./router-CZES1Sa0.js";import"./supabase-D02rA7zj.js";import"./tenantService-DRlCX1f9.js";import"./options-CllavUpK.js";import"./useLogger-C0RGS8E3.js";function U(){var u;const{id:s}=S(),r=y(),[t,m]=o.useState(null),[p,f]=o.useState(!0),[D,c]=o.useState(!1),[d,h]=o.useState(null);o.useEffect(()=>{let l=!0;return(async()=>{try{const e=await x(s);if(l){const i=n?n(e):e;m(i)}}catch(e){alert((e==null?void 0:e.message)||"Failed to load deal")}finally{l&&f(!1)}})(),()=>{l=!1}},[s]);async function b(l){c(!0);try{await N(s,l);const e=await x(s),i=n?n(e):e;m(i),h(new Date)}catch(e){alert((e==null?void 0:e.message)||"Failed to save deal")}finally{c(!1)}}if(p)return a.jsx("div",{className:"max-w-5xl mx-auto p-8",children:"Loading..."});const g=(t==null?void 0:t.job_number)||`#${s}`,v=((u=t==null?void 0:t.vehicle)==null?void 0:u.stock_number)||(t==null?void 0:t.stock_number)||"—";return a.jsxs("div",{className:"max-w-5xl mx-auto p-4 md:p-8",children:[a.jsxs("header",{className:"mb-4 flex items-center justify-between gap-3",children:[a.jsxs("h1",{className:"text-xl font-semibold",children:["Deal ",g," / Stock # ",v]}),a.jsx("button",{type:"button",onClick:()=>r("/deals"),className:"btn-mobile button-outline-enhanced",children:"← Back to Deals"})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("h1",{className:"text-2xl font-semibold",children:"Edit Deal"}),a.jsx("p",{className:"text-gray-600",children:"Update details and save."}),d?a.jsxs("p",{className:"text-sm text-gray-500 mt-1","data-testid":"last-saved-timestamp",children:["Last saved:"," ",d.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})]}):null]}),a.jsx(j,{mode:"edit",initial:t||{},onSave:b,onCancel:()=>r("/deals")})]})}export{U as default};
//# sourceMappingURL=EditDeal-D400AatC.js.map
