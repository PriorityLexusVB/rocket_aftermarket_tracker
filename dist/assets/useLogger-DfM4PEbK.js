import{r as f}from"./react-Czq5O75u.js";import{s as A,u as M}from"./index-C_SOFbVj.js";var $={VITE_SUPABASE_URL:"https://ogjtmtndgiqqdtwatsue.supabase.co",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9nanRtdG5kZ2lxcWR0d2F0c3VlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg1NTE5OTcsImV4cCI6MjA3NDEyNzk5N30.n17KiM5c08XuKY-W9fL667VsVWABwzGmJpxVieSgcX4",VITE_ORG_SCOPED_DROPDOWNS:"true",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const o={INFO:"info",WARN:"warning",ERROR:"error",DEBUG:"debug",SUCCESS:"success"},l={USER:"user",VEHICLE:"vehicle",JOB:"job",SALE:"sale",SYSTEM:"system"},t={SALE_CREATED:"sale_created",SALE_UPDATED:"sale_updated",SERVICE_ADDED:"service_added",SERVICE_REMOVED:"service_removed",SYSTEM_ERROR:"system_error",PAGE_LOAD:"page_load"};class F{constructor(){this.isEnabled=!0;let s=!1;try{s=!!(typeof import.meta<"u"&&$&&!1)}catch{}!s&&typeof process<"u"&&(s=!1),this.consoleEnabled=s}validateEntityId(s,e){if(!s)return null;const c=/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;return c!=null&&c.test(s)?s:(typeof s=="string"&&(s==="system"||s==="error"||e==="system"||s!=null&&s.includes("-api")||s==="anonymous"||s==="bulk"),null)}async log(s,e,c,g,i,R={}){var b;if(!this.isEnabled)return;const k={level:s,action:e,entityType:c,entityId:g,description:i,timestamp:(b=new Date)==null?void 0:b.toISOString(),...R};this.consoleEnabled&&this.getConsoleMethod(s)(`[${s==null?void 0:s.toUpperCase()}] ${e} on ${c}:`,k);try{await this.logToDatabase(e,c,g,i,R)}catch(h){console.error("Failed to log to database:",h)}}async logToDatabase(s,e,c,g,i={}){var R,k,b,h,p;try{const n=this.validateEntityId(c,e);if(!n){this.consoleEnabled&&console.debug("Skipping database logging for system event:",{action:s,entityType:e,entityId:c});return}const{data:u}=await((k=(R=A)==null?void 0:R.auth)==null?void 0:k.getUser()),r={action:s,entity_type:e,entity_id:n,description:g,old_values:(i==null?void 0:i.oldValues)||null,new_values:(i==null?void 0:i.newValues)||null,performed_by:((b=u==null?void 0:u.user)==null?void 0:b.id)||null},{error:a}=await((p=(h=A)==null?void 0:h.from("activity_history"))==null?void 0:p.insert([r]));a&&console.error("Database logging error:",a)}catch(n){console.error("Database logging failed:",n)}}getConsoleMethod(s){switch(s){case(o==null?void 0:o.ERROR):return console.error;case(o==null?void 0:o.WARN):return console.warn;case(o==null?void 0:o.DEBUG):return console.debug;default:return console.log}}async info(s,e,c,g,i={}){return this.log(o==null?void 0:o.INFO,s,e,c,g,i)}async warn(s,e,c,g,i={}){return this.log(o==null?void 0:o.WARN,s,e,c,g,i)}async error(s,e,c,g,i={}){return this.log(o==null?void 0:o.ERROR,s,e,c,g,i)}async success(s,e,c,g,i={}){return this.log(o==null?void 0:o.SUCCESS,s,e,c,g,i)}async debug(s,e,c,g,i={}){return this.log(o==null?void 0:o.DEBUG,s,e,c,g,i)}async logSaleCreation(s,e,c){return this.info(t==null?void 0:t.SALE_CREATED,l==null?void 0:l.SALE,s,`New sale created for vehicle ${(e==null?void 0:e.stockNumber)||"Unknown"}`,{newValues:e,userId:c,vehicleInfo:{stockNumber:e==null?void 0:e.stockNumber,year:e==null?void 0:e.year,make:e==null?void 0:e.make,model:e==null?void 0:e.model}})}async logSaleUpdate(s,e,c,g){return this.info(t==null?void 0:t.SALE_UPDATED,l==null?void 0:l.SALE,s,`Sale updated for ${(e==null?void 0:e.stockNumber)||"Unknown vehicle"}`,{oldValues:e,newValues:c,userId:g})}async logServiceChange(s,e,c,g){const i=c==="added"?`Service "${e}" added to sale`:`Service "${e}" removed from sale`;return this.info(c==="added"?t==null?void 0:t.SERVICE_ADDED:t==null?void 0:t.SERVICE_REMOVED,l==null?void 0:l.SALE,s,i,{serviceName:e,userId:g})}async logUserAction(s,e,c={}){return this.info(s,l==null?void 0:l.USER,e,`User ${s}`,c)}async logPageLoad(s,e){return this.debug(t==null?void 0:t.PAGE_LOAD,l==null?void 0:l.SYSTEM,"system",`User loaded ${s} page`,{pageName:s,userId:e})}async logError(s,e={}){return this.error(t==null?void 0:t.SYSTEM_ERROR,l==null?void 0:l.SYSTEM,"system",`System error: ${(s==null?void 0:s.message)||"Unknown error"}`,{errorStack:s==null?void 0:s.stack,errorMessage:s==null?void 0:s.message,context:e})}async logBatch(s){const e=s==null?void 0:s.map(c=>this.log(c==null?void 0:c.level,c==null?void 0:c.action,c==null?void 0:c.entityType,c==null?void 0:c.entityId,c==null?void 0:c.description,c==null?void 0:c.additionalData));try{await Promise.allSettled(e)}catch(c){console.error("Batch logging failed:",c)}}}const U=new F,J=()=>{const{user:m}=M(),s=f.useCallback(async(n,u,r,a,d,C={})=>{const w={...C,userId:m==null?void 0:m.id,userEmail:m==null?void 0:m.email};return U==null?void 0:U.log(n,u,r,a,d,w)},[m]),e=f.useCallback(async(n,u,r={})=>s(o==null?void 0:o.INFO,u,l==null?void 0:l.SYSTEM,null,`Component action: ${n} - ${u}`,{componentName:n,...r}),[s]),c=f.useCallback(async(n,u,r={})=>s(o==null?void 0:o.INFO,u,l==null?void 0:l.USER,(m==null?void 0:m.id)||null,`User clicked ${n}`,{element:n,...r}),[s,m]),g=f.useCallback(async(n,u,r=!0)=>s(r?o==null?void 0:o.SUCCESS:o==null?void 0:o.ERROR,"form_submit",l==null?void 0:l.SYSTEM,null,`Form ${n} ${r?"submitted successfully":"submission failed"}`,{formName:n,formData:u,success:r}),[s]),i=f.useCallback(async(n,u={})=>s(o==null?void 0:o.INFO,t==null?void 0:t.PAGE_LOAD,l==null?void 0:l.SYSTEM,null,`Page viewed: ${n}`,{pageName:n,...u}),[s]),R=f.useCallback(async(n,u,r,a,d={})=>s(o==null?void 0:o.INFO,n,u,r,a,d),[s]),k=f.useCallback(async(n,u={})=>s(o==null?void 0:o.ERROR,t==null?void 0:t.SYSTEM_ERROR,l==null?void 0:l.SYSTEM,null,`Error occurred: ${(n==null?void 0:n.message)||"Unknown error"}`,{errorMessage:n==null?void 0:n.message,errorStack:n==null?void 0:n.stack,context:u}),[s]),b=f.useCallback(async(n,u,r,a={})=>s(o==null?void 0:o.INFO,n,l==null?void 0:l.SALE,u,r,a),[s]),h=f.useCallback(async(n,u,r,a={})=>s(o==null?void 0:o.INFO,n,l==null?void 0:l.VEHICLE,u,r,a),[s]),p=f.useCallback(async(n,u,r,a={})=>s(o==null?void 0:o.INFO,n,l==null?void 0:l.JOB,u,r,a),[s]);return{logComponentAction:e,logUserInteraction:c,logFormSubmission:g,logPageView:i,logBusinessAction:R,logError:k,logSalesAction:b,logVehicleAction:h,logJobAction:p,logger:U,logInfo:f.useCallback((n,u,r,a,d)=>s(o==null?void 0:o.INFO,n,u,r,a,d),[s]),logWarning:f.useCallback((n,u,r,a,d)=>s(o==null?void 0:o.WARN,n,u,r,a,d),[s]),logSuccess:f.useCallback((n,u,r,a,d)=>s(o==null?void 0:o.SUCCESS,n,u,r,a,d),[s])}};export{J as u};
//# sourceMappingURL=useLogger-DfM4PEbK.js.map
