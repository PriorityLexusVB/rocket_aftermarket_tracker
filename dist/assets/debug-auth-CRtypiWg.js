import{s as V,a as K,ao as g,j as s,ap as R,d as w,e as A,i as _}from"./index-3QYmBta8.js";import{r as d}from"./react-Czq5O75u.js";import{s as q,t as M}from"./options-CllavUpK.js";import"./supabase-D02rA7zj.js";import"./router-CZES1Sa0.js";async function m({activeOnly:a=!0}={}){let i=V.from("sms_templates").select("*").order("created_at",{ascending:!0});a&&(i=i.eq("is_active",!0));const n=await q(i,"sms_templates:listGlobal");return M(n,{labelKey:"name",valueKey:"id"})}function F(){var p,f,b,N,v,S,y,P,O;const{orgId:a,loading:i,session:n}=K(),[e,T]=d.useState({}),[k,u]=d.useState(!1),[x,j]=d.useState(null),[o,h]=d.useState({configured:!1,ok:null,last:null});return d.useEffect(()=>{let l=!0;async function c(){u(!0),j(null);try{const[t,r,C,E]=await Promise.all([w({activeOnly:!1}),A({activeOnly:!1}),_({activeOnly:!1}),m==null?void 0:m({activeOnly:!1}).catch(()=>[])]),[L,U,D,I]=await Promise.all([a?w({activeOnly:!1}):Promise.resolve([]),a?A({activeOnly:!1}):Promise.resolve([]),a?_({activeOnly:!1}):Promise.resolve([]),a?m({activeOnly:!1}).catch(()=>[]):Promise.resolve([])]);if(!l)return;T({global:{vendors:t.length,products:r.length,users:C.length,sms_templates:E.length},org:{vendors:L.length,products:U.length,users:D.length,sms_templates:I.length}})}catch(t){console.error("debug-auth load error",t),l&&j((t==null?void 0:t.message)||String(t))}finally{l&&u(!1)}}return c(),h(t=>{var r;return{...t,configured:!!((r=g)!=null&&r())}}),()=>{l=!1}},[a]),s.jsxs("div",{className:"p-6",children:[s.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Debug: Auth / Org / Tenancy"}),s.jsxs("section",{className:"mb-4",children:[s.jsx("h2",{className:"font-semibold",children:"Session"}),s.jsxs("div",{className:"mb-2",children:[s.jsx("span",{className:"text-sm text-slate-600",children:"Session User ID: "}),s.jsx("strong",{"data-testid":"session-user-id",children:((p=n==null?void 0:n.user)==null?void 0:p.id)||"—"})]}),s.jsx("pre",{className:"bg-gray-100 p-2 rounded",children:JSON.stringify(n||null,null,2)})]}),s.jsxs("section",{className:"mb-4",children:[s.jsx("h2",{className:"font-semibold",children:"Tenant"}),s.jsxs("div",{children:["orgId: ",s.jsx("strong",{"data-testid":"profile-org-id",children:String(a)})]}),s.jsxs("div",{children:["loading: ",s.jsx("strong",{children:String(i)})]})]}),s.jsxs("section",{className:"mb-4",children:[s.jsx("h2",{className:"font-semibold",children:"Supabase connection"}),s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("span",{children:"Configured:"}),s.jsx("strong",{"data-testid":"sb-configured",children:o.configured?"Yes":"No"}),s.jsx("button",{type:"button",className:"btn-mobile btn-mobile-sm",onClick:async()=>{var l,c,t;try{const r=await((l=R)==null?void 0:l(2));h({configured:!!((c=g)!=null&&c()),ok:r,last:new Date})}catch{h({configured:!!((t=g)!=null&&t()),ok:!1,last:new Date})}},"data-testid":"sb-test-btn",children:"Test"})]}),s.jsxs("div",{children:["Status:"," ",s.jsx("strong",{"data-testid":"sb-status",children:o.ok==null?"—":o.ok?"OK":"Error"}),o.last?s.jsxs("span",{className:"ml-2 text-slate-600 text-sm","data-testid":"sb-last",children:["(",o.last.toLocaleTimeString(),")"]}):null]}),s.jsx("p",{className:"text-slate-500 text-sm mt-1",children:"If you see “Error” but the app otherwise works, it may be an RLS-permission message. The test treats those as reachable."})]}),s.jsxs("section",{className:"mb-4",children:[s.jsx("h2",{className:"font-semibold",children:"Counts"}),k?s.jsx("div",{children:"Loading counts..."}):x?s.jsxs("div",{className:"text-red-600",children:["Error: ",x]}):s.jsxs("div",{children:[s.jsx("h3",{className:"mt-2",children:"Global"}),s.jsxs("ul",{children:[s.jsxs("li",{children:["Vendors:"," ",s.jsx("span",{"data-testid":"global-vendor-count",children:((f=e==null?void 0:e.global)==null?void 0:f.vendors)??"N/A"})]}),s.jsxs("li",{children:["Products:"," ",s.jsx("span",{"data-testid":"global-product-count",children:((b=e==null?void 0:e.global)==null?void 0:b.products)??"N/A"})]}),s.jsxs("li",{children:["Users:"," ",s.jsx("span",{"data-testid":"global-staff-count",children:((N=e==null?void 0:e.global)==null?void 0:N.users)??"N/A"})]}),s.jsxs("li",{children:["SMS Templates:"," ",s.jsx("span",{"data-testid":"global-sms-template-count",children:((v=e==null?void 0:e.global)==null?void 0:v.sms_templates)??"N/A"})]})]}),s.jsx("h3",{className:"mt-2",children:"Org-scoped"}),s.jsxs("ul",{children:[s.jsxs("li",{children:["Vendors: ",s.jsx("span",{"data-testid":"org-vendor-count",children:((S=e==null?void 0:e.org)==null?void 0:S.vendors)??"N/A"})]}),s.jsxs("li",{children:["Products:"," ",s.jsx("span",{"data-testid":"org-product-count",children:((y=e==null?void 0:e.org)==null?void 0:y.products)??"N/A"})]}),s.jsxs("li",{children:["Users: ",s.jsx("span",{"data-testid":"org-staff-count",children:((P=e==null?void 0:e.org)==null?void 0:P.users)??"N/A"})]}),s.jsxs("li",{children:["SMS Templates:"," ",s.jsx("span",{"data-testid":"org-sms-template-count",children:((O=e==null?void 0:e.org)==null?void 0:O.sms_templates)??"N/A"})]})]})]})]}),s.jsxs("section",{className:"mb-4",children:[s.jsx("h2",{className:"font-semibold",children:"Notes"}),s.jsxs("ul",{className:"list-disc ml-6",children:[s.jsxs("li",{children:["This page uses tenant-aware list functions when ",s.jsx("code",{children:"orgId"})," exists."]}),s.jsx("li",{children:"Permission / RLS errors will appear in the console and in the error box above."})]})]})]})}export{F as default};
//# sourceMappingURL=debug-auth-CRtypiWg.js.map
