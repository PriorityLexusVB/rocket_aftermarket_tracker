{"version":3,"file":"tenantService-BgBo9UIu.js","sources":["../../src/services/tenantService.js"],"sourcesContent":["// src/services/tenantService.js\r\nimport { supabase } from '@/lib/supabase'\r\nimport { safeSelect } from '@/lib/supabase/safeSelect'\r\nimport { toOptions } from '@/lib/options'\r\n\r\nexport async function listVendorsByOrg(orgId, { activeOnly = true } = {}) {\r\n  if (!orgId) return []\r\n  try {\r\n    let q = supabase\r\n      .from('vendors')\r\n      .select('id, name, is_active, phone, email, specialty')\r\n      .order('name', { ascending: true })\r\n    if (activeOnly) q = q.eq('is_active', true)\r\n    q = q.or(`org_id.eq.${orgId},org_id.is.null`)\r\n    const data = await safeSelect(q)\r\n    return toOptions(data, { labelKey: 'name', valueKey: 'id' })\r\n  } catch (err) {\r\n    console.error('listVendorsByOrg error:', err?.message || err)\r\n    return []\r\n  }\r\n}\r\n\r\nexport async function listProductsByOrg(orgId, { activeOnly = true } = {}) {\r\n  if (!orgId) return []\r\n  try {\r\n    let q = supabase\r\n      .from('products')\r\n      .select('id, name, brand, unit_price, is_active, op_code, cost, category')\r\n      .order('name', { ascending: true })\r\n    if (activeOnly) q = q.eq('is_active', true)\r\n    q = q.or(`org_id.eq.${orgId},org_id.is.null`)\r\n    const data = await safeSelect(q)\r\n    // Preserve unit_price on options for auto-fill in forms\r\n    return (Array.isArray(data) ? data : []).map((p) => ({\r\n      ...p,\r\n      ...toOptions([p], { labelKey: 'name', valueKey: 'id' })[0],\r\n      label: p.brand ? `${p.name} - ${p.brand}` : p.name,\r\n    }))\r\n  } catch (err) {\r\n    console.error('listProductsByOrg error:', err?.message || err)\r\n    return []\r\n  }\r\n}\r\n\r\nexport async function listStaffByOrg(\r\n  orgId,\r\n  { departments = [], roles = [], activeOnly = true } = {}\r\n) {\r\n  if (!orgId) return []\r\n  try {\r\n    let q = supabase\r\n      .from('user_profiles')\r\n      .select('id, full_name, email, department, role, is_active, vendor_id')\r\n      .order('full_name', { ascending: true })\r\n    q = q.eq('org_id', orgId)\r\n    if (activeOnly) q = q.eq('is_active', true)\r\n    if (departments.length) q = q.in('department', departments)\r\n    if (roles.length) q = q.in('role', roles)\r\n    const data = await safeSelect(q)\r\n    return (Array.isArray(data) ? data : []).map((u) => ({\r\n      ...u,\r\n      ...toOptions([u], { labelKey: 'full_name', valueKey: 'id' })[0],\r\n    }))\r\n  } catch (err) {\r\n    console.error('listStaffByOrg error:', err?.message || err)\r\n    return []\r\n  }\r\n}\r\n\r\nexport async function listSmsTemplatesByOrg(orgId, { activeOnly = true } = {}) {\r\n  if (!orgId) return []\r\n  try {\r\n    let q = supabase\r\n      .from('sms_templates')\r\n      .select('id, name, body, is_active')\r\n      .order('created_at', { ascending: true })\r\n    if (activeOnly) q = q.eq('is_active', true)\r\n    q = q.or(`org_id.eq.${orgId},org_id.is.null`)\r\n    const data = await safeSelect(q)\r\n    return toOptions(data, { labelKey: 'name', valueKey: 'id' })\r\n  } catch (err) {\r\n    console.error('listSmsTemplatesByOrg error:', err?.message || err)\r\n    return []\r\n  }\r\n}\r\n"],"names":["listVendorsByOrg","orgId","activeOnly","q","supabase","data","safeSelect","toOptions","err","listProductsByOrg","p","listStaffByOrg","departments","roles","u","listSmsTemplatesByOrg"],"mappings":"oFAKO,eAAeA,EAAiBC,EAAO,CAAE,WAAAC,EAAa,EAAI,EAAK,CAAA,EAAI,CACxE,GAAI,CAACD,EAAO,MAAO,CAAA,EACnB,GAAI,CACF,IAAIE,EAAIC,EACL,KAAK,SAAS,EACd,OAAO,8CAA8C,EACrD,MAAM,OAAQ,CAAE,UAAW,EAAI,CAAE,EAChCF,IAAYC,EAAIA,EAAE,GAAG,YAAa,EAAI,GAC1CA,EAAIA,EAAE,GAAG,aAAaF,CAAK,iBAAiB,EAC5C,MAAMI,EAAO,MAAMC,EAAWH,CAAC,EAC/B,OAAOI,EAAUF,EAAM,CAAE,SAAU,OAAQ,SAAU,KAAM,CAC7D,OAASG,EAAK,CACZ,eAAQ,MAAM,2BAA2BA,GAAA,YAAAA,EAAK,UAAWA,CAAG,EACrD,CAAA,CACT,CACF,CAEO,eAAeC,EAAkBR,EAAO,CAAE,WAAAC,EAAa,EAAI,EAAK,CAAA,EAAI,CACzE,GAAI,CAACD,EAAO,MAAO,CAAA,EACnB,GAAI,CACF,IAAIE,EAAIC,EACL,KAAK,UAAU,EACf,OAAO,iEAAiE,EACxE,MAAM,OAAQ,CAAE,UAAW,EAAI,CAAE,EAChCF,IAAYC,EAAIA,EAAE,GAAG,YAAa,EAAI,GAC1CA,EAAIA,EAAE,GAAG,aAAaF,CAAK,iBAAiB,EAC5C,MAAMI,EAAO,MAAMC,EAAWH,CAAC,EAE/B,OAAQ,MAAM,QAAQE,CAAI,EAAIA,EAAO,CAAA,GAAI,IAAKK,IAAO,CACnD,GAAGA,EACH,GAAGH,EAAU,CAACG,CAAC,EAAG,CAAE,SAAU,OAAQ,SAAU,KAAM,EAAE,CAAC,EACzD,MAAOA,EAAE,MAAQ,GAAGA,EAAE,IAAI,MAAMA,EAAE,KAAK,GAAKA,EAAE,IACpD,EAAM,CACJ,OAASF,EAAK,CACZ,eAAQ,MAAM,4BAA4BA,GAAA,YAAAA,EAAK,UAAWA,CAAG,EACtD,CAAA,CACT,CACF,CAEO,eAAeG,EACpBV,EACA,CAAE,YAAAW,EAAc,CAAA,EAAI,MAAAC,EAAQ,CAAA,EAAI,WAAAX,EAAa,EAAI,EAAK,CAAA,EACtD,CACA,GAAI,CAACD,EAAO,MAAO,CAAA,EACnB,GAAI,CACF,IAAIE,EAAIC,EACL,KAAK,eAAe,EACpB,OAAO,8DAA8D,EACrE,MAAM,YAAa,CAAE,UAAW,EAAI,CAAE,EACzCD,EAAIA,EAAE,GAAG,SAAUF,CAAK,EACpBC,IAAYC,EAAIA,EAAE,GAAG,YAAa,EAAI,GACtCS,EAAY,SAAQT,EAAIA,EAAE,GAAG,aAAcS,CAAW,GACtDC,EAAM,SAAQV,EAAIA,EAAE,GAAG,OAAQU,CAAK,GACxC,MAAMR,EAAO,MAAMC,EAAWH,CAAC,EAC/B,OAAQ,MAAM,QAAQE,CAAI,EAAIA,EAAO,CAAA,GAAI,IAAKS,IAAO,CACnD,GAAGA,EACH,GAAGP,EAAU,CAACO,CAAC,EAAG,CAAE,SAAU,YAAa,SAAU,KAAM,EAAE,CAAC,CACpE,EAAM,CACJ,OAASN,EAAK,CACZ,eAAQ,MAAM,yBAAyBA,GAAA,YAAAA,EAAK,UAAWA,CAAG,EACnD,CAAA,CACT,CACF,CAEO,eAAeO,EAAsBd,EAAO,CAAE,WAAAC,EAAa,EAAI,EAAK,CAAA,EAAI,CAC7E,GAAI,CAACD,EAAO,MAAO,CAAA,EACnB,GAAI,CACF,IAAIE,EAAIC,EACL,KAAK,eAAe,EACpB,OAAO,2BAA2B,EAClC,MAAM,aAAc,CAAE,UAAW,EAAI,CAAE,EACtCF,IAAYC,EAAIA,EAAE,GAAG,YAAa,EAAI,GAC1CA,EAAIA,EAAE,GAAG,aAAaF,CAAK,iBAAiB,EAC5C,MAAMI,EAAO,MAAMC,EAAWH,CAAC,EAC/B,OAAOI,EAAUF,EAAM,CAAE,SAAU,OAAQ,SAAU,KAAM,CAC7D,OAASG,EAAK,CACZ,eAAQ,MAAM,gCAAgCA,GAAA,YAAAA,EAAK,UAAWA,CAAG,EAC1D,CAAA,CACT,CACF"}