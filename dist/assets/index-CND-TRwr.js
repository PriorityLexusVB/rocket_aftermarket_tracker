import{j as e,af as et,a8 as or,B as J,a1 as Hr,E as Kr,a0 as Jr,ag as Yr,u as Wr,s as R,R as Zr,ah as Xr,G as Fr,ai as Ne,V as es,_ as ts,k as H,aj as Oe,ak as Qe,al as Ve}from"./index-Bn3E4zhC.js";import{r as M}from"./react-Czq5O75u.js";import{u as rs}from"./useTenant-CNgXXmbA.js";import{A as ht}from"./AppLayout-WGgYNmbk.js";import{u as ss}from"./useLogger-D5qQrM8Q.js";import"./supabase-D02rA7zj.js";import"./router-CZES1Sa0.js";import"./Navbar-DxkCtkFG.js";var je={},ns=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then},cr={},ne={};let jt;const as=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];ne.getSymbolSize=function(n){if(!n)throw new Error('"version" cannot be null or undefined');if(n<1||n>40)throw new Error('"version" should be in range from 1 to 40');return n*4+17};ne.getSymbolTotalCodewords=function(n){return as[n]};ne.getBCHDigit=function(a){let n=0;for(;a!==0;)n++,a>>>=1;return n};ne.setToSJISFunction=function(n){if(typeof n!="function")throw new Error('"toSJISFunc" is not a valid function.');jt=n};ne.isKanjiModeEnabled=function(){return typeof jt<"u"};ne.toSJIS=function(n){return jt(n)};var st={};(function(a){a.L={bit:1},a.M={bit:0},a.Q={bit:3},a.H={bit:2};function n(c){if(typeof c!="string")throw new Error("Param is not a string");switch(c.toLowerCase()){case"l":case"low":return a.L;case"m":case"medium":return a.M;case"q":case"quartile":return a.Q;case"h":case"high":return a.H;default:throw new Error("Unknown EC Level: "+c)}}a.isValid=function(s){return s&&typeof s.bit<"u"&&s.bit>=0&&s.bit<4},a.from=function(s,i){if(a.isValid(s))return s;try{return n(s)}catch{return i}}})(st);function dr(){this.buffer=[],this.length=0}dr.prototype={get:function(a){const n=Math.floor(a/8);return(this.buffer[n]>>>7-a%8&1)===1},put:function(a,n){for(let c=0;c<n;c++)this.putBit((a>>>n-c-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(a){const n=Math.floor(this.length/8);this.buffer.length<=n&&this.buffer.push(0),a&&(this.buffer[n]|=128>>>this.length%8),this.length++}};var is=dr;function Ke(a){if(!a||a<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=a,this.data=new Uint8Array(a*a),this.reservedBit=new Uint8Array(a*a)}Ke.prototype.set=function(a,n,c,s){const i=a*this.size+n;this.data[i]=c,s&&(this.reservedBit[i]=!0)};Ke.prototype.get=function(a,n){return this.data[a*this.size+n]};Ke.prototype.xor=function(a,n,c){this.data[a*this.size+n]^=c};Ke.prototype.isReserved=function(a,n){return this.reservedBit[a*this.size+n]};var ls=Ke,ur={};(function(a){const n=ne.getSymbolSize;a.getRowColCoords=function(s){if(s===1)return[];const i=Math.floor(s/7)+2,l=n(s),d=l===145?26:Math.ceil((l-13)/(2*i-2))*2,h=[l-7];for(let u=1;u<i-1;u++)h[u]=h[u-1]-d;return h.push(6),h.reverse()},a.getPositions=function(s){const i=[],l=a.getRowColCoords(s),d=l.length;for(let h=0;h<d;h++)for(let u=0;u<d;u++)h===0&&u===0||h===0&&u===d-1||h===d-1&&u===0||i.push([l[h],l[u]]);return i}})(ur);var hr={};const os=ne.getSymbolSize,ar=7;hr.getPositions=function(n){const c=os(n);return[[0,0],[c-ar,0],[0,c-ar]]};var gr={};(function(a){a.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const n={N1:3,N2:3,N3:40,N4:10};a.isValid=function(i){return i!=null&&i!==""&&!isNaN(i)&&i>=0&&i<=7},a.from=function(i){return a.isValid(i)?parseInt(i,10):void 0},a.getPenaltyN1=function(i){const l=i.size;let d=0,h=0,u=0,y=null,p=null;for(let I=0;I<l;I++){h=u=0,y=p=null;for(let N=0;N<l;N++){let w=i.get(I,N);w===y?h++:(h>=5&&(d+=n.N1+(h-5)),y=w,h=1),w=i.get(N,I),w===p?u++:(u>=5&&(d+=n.N1+(u-5)),p=w,u=1)}h>=5&&(d+=n.N1+(h-5)),u>=5&&(d+=n.N1+(u-5))}return d},a.getPenaltyN2=function(i){const l=i.size;let d=0;for(let h=0;h<l-1;h++)for(let u=0;u<l-1;u++){const y=i.get(h,u)+i.get(h,u+1)+i.get(h+1,u)+i.get(h+1,u+1);(y===4||y===0)&&d++}return d*n.N2},a.getPenaltyN3=function(i){const l=i.size;let d=0,h=0,u=0;for(let y=0;y<l;y++){h=u=0;for(let p=0;p<l;p++)h=h<<1&2047|i.get(y,p),p>=10&&(h===1488||h===93)&&d++,u=u<<1&2047|i.get(p,y),p>=10&&(u===1488||u===93)&&d++}return d*n.N3},a.getPenaltyN4=function(i){let l=0;const d=i.data.length;for(let u=0;u<d;u++)l+=i.data[u];return Math.abs(Math.ceil(l*100/d/5)-10)*n.N4};function c(s,i,l){switch(s){case a.Patterns.PATTERN000:return(i+l)%2===0;case a.Patterns.PATTERN001:return i%2===0;case a.Patterns.PATTERN010:return l%3===0;case a.Patterns.PATTERN011:return(i+l)%3===0;case a.Patterns.PATTERN100:return(Math.floor(i/2)+Math.floor(l/3))%2===0;case a.Patterns.PATTERN101:return i*l%2+i*l%3===0;case a.Patterns.PATTERN110:return(i*l%2+i*l%3)%2===0;case a.Patterns.PATTERN111:return(i*l%3+(i+l)%2)%2===0;default:throw new Error("bad maskPattern:"+s)}}a.applyMask=function(i,l){const d=l.size;for(let h=0;h<d;h++)for(let u=0;u<d;u++)l.isReserved(u,h)||l.xor(u,h,c(i,u,h))},a.getBestMask=function(i,l){const d=Object.keys(a.Patterns).length;let h=0,u=1/0;for(let y=0;y<d;y++){l(y),a.applyMask(y,i);const p=a.getPenaltyN1(i)+a.getPenaltyN2(i)+a.getPenaltyN3(i)+a.getPenaltyN4(i);a.applyMask(y,i),p<u&&(u=p,h=y)}return h}})(gr);var nt={};const fe=st,Xe=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],Fe=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];nt.getBlocksCount=function(n,c){switch(c){case fe.L:return Xe[(n-1)*4+0];case fe.M:return Xe[(n-1)*4+1];case fe.Q:return Xe[(n-1)*4+2];case fe.H:return Xe[(n-1)*4+3];default:return}};nt.getTotalCodewordsCount=function(n,c){switch(c){case fe.L:return Fe[(n-1)*4+0];case fe.M:return Fe[(n-1)*4+1];case fe.Q:return Fe[(n-1)*4+2];case fe.H:return Fe[(n-1)*4+3];default:return}};var mr={},at={};const Ge=new Uint8Array(512),tt=new Uint8Array(256);(function(){let n=1;for(let c=0;c<255;c++)Ge[c]=n,tt[n]=c,n<<=1,n&256&&(n^=285);for(let c=255;c<512;c++)Ge[c]=Ge[c-255]})();at.log=function(n){if(n<1)throw new Error("log("+n+")");return tt[n]};at.exp=function(n){return Ge[n]};at.mul=function(n,c){return n===0||c===0?0:Ge[tt[n]+tt[c]]};(function(a){const n=at;a.mul=function(s,i){const l=new Uint8Array(s.length+i.length-1);for(let d=0;d<s.length;d++)for(let h=0;h<i.length;h++)l[d+h]^=n.mul(s[d],i[h]);return l},a.mod=function(s,i){let l=new Uint8Array(s);for(;l.length-i.length>=0;){const d=l[0];for(let u=0;u<i.length;u++)l[u]^=n.mul(i[u],d);let h=0;for(;h<l.length&&l[h]===0;)h++;l=l.slice(h)}return l},a.generateECPolynomial=function(s){let i=new Uint8Array([1]);for(let l=0;l<s;l++)i=a.mul(i,new Uint8Array([1,n.exp(l)]));return i}})(mr);const xr=mr;function Ct(a){this.genPoly=void 0,this.degree=a,this.degree&&this.initialize(this.degree)}Ct.prototype.initialize=function(n){this.degree=n,this.genPoly=xr.generateECPolynomial(this.degree)};Ct.prototype.encode=function(n){if(!this.genPoly)throw new Error("Encoder not initialized");const c=new Uint8Array(n.length+this.degree);c.set(n);const s=xr.mod(c,this.genPoly),i=this.degree-s.length;if(i>0){const l=new Uint8Array(this.degree);return l.set(s,i),l}return s};var cs=Ct,fr={},pe={},vt={};vt.isValid=function(n){return!isNaN(n)&&n>=1&&n<=40};var de={};const pr="[0-9]+",ds="[A-Z $%*+\\-./:]+";let He="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";He=He.replace(/u/g,"\\u");const us="(?:(?![A-Z0-9 $%*+\\-./:]|"+He+`)(?:.|[\r
]))+`;de.KANJI=new RegExp(He,"g");de.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");de.BYTE=new RegExp(us,"g");de.NUMERIC=new RegExp(pr,"g");de.ALPHANUMERIC=new RegExp(ds,"g");const hs=new RegExp("^"+He+"$"),gs=new RegExp("^"+pr+"$"),ms=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");de.testKanji=function(n){return hs.test(n)};de.testNumeric=function(n){return gs.test(n)};de.testAlphanumeric=function(n){return ms.test(n)};(function(a){const n=vt,c=de;a.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},a.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},a.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},a.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},a.MIXED={bit:-1},a.getCharCountIndicator=function(l,d){if(!l.ccBits)throw new Error("Invalid mode: "+l);if(!n.isValid(d))throw new Error("Invalid version: "+d);return d>=1&&d<10?l.ccBits[0]:d<27?l.ccBits[1]:l.ccBits[2]},a.getBestModeForData=function(l){return c.testNumeric(l)?a.NUMERIC:c.testAlphanumeric(l)?a.ALPHANUMERIC:c.testKanji(l)?a.KANJI:a.BYTE},a.toString=function(l){if(l&&l.id)return l.id;throw new Error("Invalid mode")},a.isValid=function(l){return l&&l.bit&&l.ccBits};function s(i){if(typeof i!="string")throw new Error("Param is not a string");switch(i.toLowerCase()){case"numeric":return a.NUMERIC;case"alphanumeric":return a.ALPHANUMERIC;case"kanji":return a.KANJI;case"byte":return a.BYTE;default:throw new Error("Unknown mode: "+i)}}a.from=function(l,d){if(a.isValid(l))return l;try{return s(l)}catch{return d}}})(pe);(function(a){const n=ne,c=nt,s=st,i=pe,l=vt,d=7973,h=n.getBCHDigit(d);function u(N,w,T){for(let f=1;f<=40;f++)if(w<=a.getCapacity(f,T,N))return f}function y(N,w){return i.getCharCountIndicator(N,w)+4}function p(N,w){let T=0;return N.forEach(function(f){const G=y(f.mode,w);T+=G+f.getBitsLength()}),T}function I(N,w){for(let T=1;T<=40;T++)if(p(N,T)<=a.getCapacity(T,w,i.MIXED))return T}a.from=function(w,T){return l.isValid(w)?parseInt(w,10):T},a.getCapacity=function(w,T,f){if(!l.isValid(w))throw new Error("Invalid QR Code version");typeof f>"u"&&(f=i.BYTE);const G=n.getSymbolTotalCodewords(w),v=c.getTotalCodewordsCount(w,T),k=(G-v)*8;if(f===i.MIXED)return k;const _=k-y(f,w);switch(f){case i.NUMERIC:return Math.floor(_/10*3);case i.ALPHANUMERIC:return Math.floor(_/11*2);case i.KANJI:return Math.floor(_/13);case i.BYTE:default:return Math.floor(_/8)}},a.getBestVersionForData=function(w,T){let f;const G=s.from(T,s.M);if(Array.isArray(w)){if(w.length>1)return I(w,G);if(w.length===0)return 1;f=w[0]}else f=w;return u(f.mode,f.getLength(),G)},a.getEncodedBits=function(w){if(!l.isValid(w)||w<7)throw new Error("Invalid QR Code version");let T=w<<12;for(;n.getBCHDigit(T)-h>=0;)T^=d<<n.getBCHDigit(T)-h;return w<<12|T}})(fr);var yr={};const yt=ne,wr=1335,xs=21522,ir=yt.getBCHDigit(wr);yr.getEncodedBits=function(n,c){const s=n.bit<<3|c;let i=s<<10;for(;yt.getBCHDigit(i)-ir>=0;)i^=wr<<yt.getBCHDigit(i)-ir;return(s<<10|i)^xs};var br={};const fs=pe;function Ae(a){this.mode=fs.NUMERIC,this.data=a.toString()}Ae.getBitsLength=function(n){return 10*Math.floor(n/3)+(n%3?n%3*3+1:0)};Ae.prototype.getLength=function(){return this.data.length};Ae.prototype.getBitsLength=function(){return Ae.getBitsLength(this.data.length)};Ae.prototype.write=function(n){let c,s,i;for(c=0;c+3<=this.data.length;c+=3)s=this.data.substr(c,3),i=parseInt(s,10),n.put(i,10);const l=this.data.length-c;l>0&&(s=this.data.substr(c),i=parseInt(s,10),n.put(i,l*3+1))};var ps=Ae;const ys=pe,gt=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function Te(a){this.mode=ys.ALPHANUMERIC,this.data=a}Te.getBitsLength=function(n){return 11*Math.floor(n/2)+6*(n%2)};Te.prototype.getLength=function(){return this.data.length};Te.prototype.getBitsLength=function(){return Te.getBitsLength(this.data.length)};Te.prototype.write=function(n){let c;for(c=0;c+2<=this.data.length;c+=2){let s=gt.indexOf(this.data[c])*45;s+=gt.indexOf(this.data[c+1]),n.put(s,11)}this.data.length%2&&n.put(gt.indexOf(this.data[c]),6)};var ws=Te;const bs=pe;function ke(a){this.mode=bs.BYTE,typeof a=="string"?this.data=new TextEncoder().encode(a):this.data=new Uint8Array(a)}ke.getBitsLength=function(n){return n*8};ke.prototype.getLength=function(){return this.data.length};ke.prototype.getBitsLength=function(){return ke.getBitsLength(this.data.length)};ke.prototype.write=function(a){for(let n=0,c=this.data.length;n<c;n++)a.put(this.data[n],8)};var Ns=ke;const js=pe,Cs=ne;function Re(a){this.mode=js.KANJI,this.data=a}Re.getBitsLength=function(n){return n*13};Re.prototype.getLength=function(){return this.data.length};Re.prototype.getBitsLength=function(){return Re.getBitsLength(this.data.length)};Re.prototype.write=function(a){let n;for(n=0;n<this.data.length;n++){let c=Cs.toSJIS(this.data[n]);if(c>=33088&&c<=40956)c-=33088;else if(c>=57408&&c<=60351)c-=49472;else throw new Error("Invalid SJIS character: "+this.data[n]+`
Make sure your charset is UTF-8`);c=(c>>>8&255)*192+(c&255),a.put(c,13)}};var vs=Re,Nr={exports:{}};(function(a){var n={single_source_shortest_paths:function(c,s,i){var l={},d={};d[s]=0;var h=n.PriorityQueue.make();h.push(s,0);for(var u,y,p,I,N,w,T,f,G;!h.empty();){u=h.pop(),y=u.value,I=u.cost,N=c[y]||{};for(p in N)N.hasOwnProperty(p)&&(w=N[p],T=I+w,f=d[p],G=typeof d[p]>"u",(G||f>T)&&(d[p]=T,h.push(p,T),l[p]=y))}if(typeof i<"u"&&typeof d[i]>"u"){var v=["Could not find a path from ",s," to ",i,"."].join("");throw new Error(v)}return l},extract_shortest_path_from_predecessor_list:function(c,s){for(var i=[],l=s;l;)i.push(l),c[l],l=c[l];return i.reverse(),i},find_path:function(c,s,i){var l=n.single_source_shortest_paths(c,s,i);return n.extract_shortest_path_from_predecessor_list(l,i)},PriorityQueue:{make:function(c){var s=n.PriorityQueue,i={},l;c=c||{};for(l in s)s.hasOwnProperty(l)&&(i[l]=s[l]);return i.queue=[],i.sorter=c.sorter||s.default_sorter,i},default_sorter:function(c,s){return c.cost-s.cost},push:function(c,s){var i={value:c,cost:s};this.queue.push(i),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};a.exports=n})(Nr);var _s=Nr.exports;(function(a){const n=pe,c=ps,s=ws,i=Ns,l=vs,d=de,h=ne,u=_s;function y(v){return unescape(encodeURIComponent(v)).length}function p(v,k,_){const E=[];let D;for(;(D=v.exec(_))!==null;)E.push({data:D[0],index:D.index,mode:k,length:D[0].length});return E}function I(v){const k=p(d.NUMERIC,n.NUMERIC,v),_=p(d.ALPHANUMERIC,n.ALPHANUMERIC,v);let E,D;return h.isKanjiModeEnabled()?(E=p(d.BYTE,n.BYTE,v),D=p(d.KANJI,n.KANJI,v)):(E=p(d.BYTE_KANJI,n.BYTE,v),D=[]),k.concat(_,E,D).sort(function(P,U){return P.index-U.index}).map(function(P){return{data:P.data,mode:P.mode,length:P.length}})}function N(v,k){switch(k){case n.NUMERIC:return c.getBitsLength(v);case n.ALPHANUMERIC:return s.getBitsLength(v);case n.KANJI:return l.getBitsLength(v);case n.BYTE:return i.getBitsLength(v)}}function w(v){return v.reduce(function(k,_){const E=k.length-1>=0?k[k.length-1]:null;return E&&E.mode===_.mode?(k[k.length-1].data+=_.data,k):(k.push(_),k)},[])}function T(v){const k=[];for(let _=0;_<v.length;_++){const E=v[_];switch(E.mode){case n.NUMERIC:k.push([E,{data:E.data,mode:n.ALPHANUMERIC,length:E.length},{data:E.data,mode:n.BYTE,length:E.length}]);break;case n.ALPHANUMERIC:k.push([E,{data:E.data,mode:n.BYTE,length:E.length}]);break;case n.KANJI:k.push([E,{data:E.data,mode:n.BYTE,length:y(E.data)}]);break;case n.BYTE:k.push([{data:E.data,mode:n.BYTE,length:y(E.data)}])}}return k}function f(v,k){const _={},E={start:{}};let D=["start"];for(let C=0;C<v.length;C++){const P=v[C],U=[];for(let B=0;B<P.length;B++){const Y=P[B],ye=""+C+B;U.push(ye),_[ye]={node:Y,lastCount:0},E[ye]={};for(let we=0;we<D.length;we++){const ie=D[we];_[ie]&&_[ie].node.mode===Y.mode?(E[ie][ye]=N(_[ie].lastCount+Y.length,Y.mode)-N(_[ie].lastCount,Y.mode),_[ie].lastCount+=Y.length):(_[ie]&&(_[ie].lastCount=Y.length),E[ie][ye]=N(Y.length,Y.mode)+4+n.getCharCountIndicator(Y.mode,k))}}D=U}for(let C=0;C<D.length;C++)E[D[C]].end=0;return{map:E,table:_}}function G(v,k){let _;const E=n.getBestModeForData(v);if(_=n.from(k,E),_!==n.BYTE&&_.bit<E.bit)throw new Error('"'+v+'" cannot be encoded with mode '+n.toString(_)+`.
 Suggested mode is: `+n.toString(E));switch(_===n.KANJI&&!h.isKanjiModeEnabled()&&(_=n.BYTE),_){case n.NUMERIC:return new c(v);case n.ALPHANUMERIC:return new s(v);case n.KANJI:return new l(v);case n.BYTE:return new i(v)}}a.fromArray=function(k){return k.reduce(function(_,E){return typeof E=="string"?_.push(G(E,null)):E.data&&_.push(G(E.data,E.mode)),_},[])},a.fromString=function(k,_){const E=I(k,h.isKanjiModeEnabled()),D=T(E),C=f(D,_),P=u.find_path(C.map,"start","end"),U=[];for(let B=1;B<P.length-1;B++)U.push(C.table[P[B]].node);return a.fromArray(w(U))},a.rawSplit=function(k){return a.fromArray(I(k,h.isKanjiModeEnabled()))}})(br);const it=ne,mt=st,Ss=is,Es=ls,As=ur,Ts=hr,wt=gr,bt=nt,ks=cs,rt=fr,Rs=yr,Ms=pe,xt=br;function Ps(a,n){const c=a.size,s=Ts.getPositions(n);for(let i=0;i<s.length;i++){const l=s[i][0],d=s[i][1];for(let h=-1;h<=7;h++)if(!(l+h<=-1||c<=l+h))for(let u=-1;u<=7;u++)d+u<=-1||c<=d+u||(h>=0&&h<=6&&(u===0||u===6)||u>=0&&u<=6&&(h===0||h===6)||h>=2&&h<=4&&u>=2&&u<=4?a.set(l+h,d+u,!0,!0):a.set(l+h,d+u,!1,!0))}}function Bs(a){const n=a.size;for(let c=8;c<n-8;c++){const s=c%2===0;a.set(c,6,s,!0),a.set(6,c,s,!0)}}function Ls(a,n){const c=As.getPositions(n);for(let s=0;s<c.length;s++){const i=c[s][0],l=c[s][1];for(let d=-2;d<=2;d++)for(let h=-2;h<=2;h++)d===-2||d===2||h===-2||h===2||d===0&&h===0?a.set(i+d,l+h,!0,!0):a.set(i+d,l+h,!1,!0)}}function Ds(a,n){const c=a.size,s=rt.getEncodedBits(n);let i,l,d;for(let h=0;h<18;h++)i=Math.floor(h/3),l=h%3+c-8-3,d=(s>>h&1)===1,a.set(i,l,d,!0),a.set(l,i,d,!0)}function ft(a,n,c){const s=a.size,i=Rs.getEncodedBits(n,c);let l,d;for(l=0;l<15;l++)d=(i>>l&1)===1,l<6?a.set(l,8,d,!0):l<8?a.set(l+1,8,d,!0):a.set(s-15+l,8,d,!0),l<8?a.set(8,s-l-1,d,!0):l<9?a.set(8,15-l-1+1,d,!0):a.set(8,15-l-1,d,!0);a.set(s-8,8,1,!0)}function Us(a,n){const c=a.size;let s=-1,i=c-1,l=7,d=0;for(let h=c-1;h>0;h-=2)for(h===6&&h--;;){for(let u=0;u<2;u++)if(!a.isReserved(i,h-u)){let y=!1;d<n.length&&(y=(n[d]>>>l&1)===1),a.set(i,h-u,y),l--,l===-1&&(d++,l=7)}if(i+=s,i<0||c<=i){i-=s,s=-s;break}}}function Is(a,n,c){const s=new Ss;c.forEach(function(u){s.put(u.mode.bit,4),s.put(u.getLength(),Ms.getCharCountIndicator(u.mode,a)),u.write(s)});const i=it.getSymbolTotalCodewords(a),l=bt.getTotalCodewordsCount(a,n),d=(i-l)*8;for(s.getLengthInBits()+4<=d&&s.put(0,4);s.getLengthInBits()%8!==0;)s.putBit(0);const h=(d-s.getLengthInBits())/8;for(let u=0;u<h;u++)s.put(u%2?17:236,8);return zs(s,a,n)}function zs(a,n,c){const s=it.getSymbolTotalCodewords(n),i=bt.getTotalCodewordsCount(n,c),l=s-i,d=bt.getBlocksCount(n,c),h=s%d,u=d-h,y=Math.floor(s/d),p=Math.floor(l/d),I=p+1,N=y-p,w=new ks(N);let T=0;const f=new Array(d),G=new Array(d);let v=0;const k=new Uint8Array(a.buffer);for(let P=0;P<d;P++){const U=P<u?p:I;f[P]=k.slice(T,T+U),G[P]=w.encode(f[P]),T+=U,v=Math.max(v,U)}const _=new Uint8Array(s);let E=0,D,C;for(D=0;D<v;D++)for(C=0;C<d;C++)D<f[C].length&&(_[E++]=f[C][D]);for(D=0;D<N;D++)for(C=0;C<d;C++)_[E++]=G[C][D];return _}function $s(a,n,c,s){let i;if(Array.isArray(a))i=xt.fromArray(a);else if(typeof a=="string"){let y=n;if(!y){const p=xt.rawSplit(a);y=rt.getBestVersionForData(p,c)}i=xt.fromString(a,y||40)}else throw new Error("Invalid data");const l=rt.getBestVersionForData(i,c);if(!l)throw new Error("The amount of data is too big to be stored in a QR Code");if(!n)n=l;else if(n<l)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+l+`.
`);const d=Is(n,c,i),h=it.getSymbolSize(n),u=new Es(h);return Ps(u,n),Bs(u),Ls(u,n),ft(u,c,0),n>=7&&Ds(u,n),Us(u,d),isNaN(s)&&(s=wt.getBestMask(u,ft.bind(null,u,c))),wt.applyMask(s,u),ft(u,c,s),{modules:u,version:n,errorCorrectionLevel:c,maskPattern:s,segments:i}}cr.create=function(n,c){if(typeof n>"u"||n==="")throw new Error("No input text");let s=mt.M,i,l;return typeof c<"u"&&(s=mt.from(c.errorCorrectionLevel,mt.M),i=rt.from(c.version),l=wt.from(c.maskPattern),c.toSJISFunc&&it.setToSJISFunction(c.toSJISFunc)),$s(n,i,s,l)};var jr={},_t={};(function(a){function n(c){if(typeof c=="number"&&(c=c.toString()),typeof c!="string")throw new Error("Color should be defined as hex string");let s=c.slice().replace("#","").split("");if(s.length<3||s.length===5||s.length>8)throw new Error("Invalid hex color: "+c);(s.length===3||s.length===4)&&(s=Array.prototype.concat.apply([],s.map(function(l){return[l,l]}))),s.length===6&&s.push("F","F");const i=parseInt(s.join(""),16);return{r:i>>24&255,g:i>>16&255,b:i>>8&255,a:i&255,hex:"#"+s.slice(0,6).join("")}}a.getOptions=function(s){s||(s={}),s.color||(s.color={});const i=typeof s.margin>"u"||s.margin===null||s.margin<0?4:s.margin,l=s.width&&s.width>=21?s.width:void 0,d=s.scale||4;return{width:l,scale:l?4:d,margin:i,color:{dark:n(s.color.dark||"#000000ff"),light:n(s.color.light||"#ffffffff")},type:s.type,rendererOpts:s.rendererOpts||{}}},a.getScale=function(s,i){return i.width&&i.width>=s+i.margin*2?i.width/(s+i.margin*2):i.scale},a.getImageWidth=function(s,i){const l=a.getScale(s,i);return Math.floor((s+i.margin*2)*l)},a.qrToImageData=function(s,i,l){const d=i.modules.size,h=i.modules.data,u=a.getScale(d,l),y=Math.floor((d+l.margin*2)*u),p=l.margin*u,I=[l.color.light,l.color.dark];for(let N=0;N<y;N++)for(let w=0;w<y;w++){let T=(N*y+w)*4,f=l.color.light;if(N>=p&&w>=p&&N<y-p&&w<y-p){const G=Math.floor((N-p)/u),v=Math.floor((w-p)/u);f=I[h[G*d+v]?1:0]}s[T++]=f.r,s[T++]=f.g,s[T++]=f.b,s[T]=f.a}}})(_t);(function(a){const n=_t;function c(i,l,d){i.clearRect(0,0,l.width,l.height),l.style||(l.style={}),l.height=d,l.width=d,l.style.height=d+"px",l.style.width=d+"px"}function s(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}a.render=function(l,d,h){let u=h,y=d;typeof u>"u"&&(!d||!d.getContext)&&(u=d,d=void 0),d||(y=s()),u=n.getOptions(u);const p=n.getImageWidth(l.modules.size,u),I=y.getContext("2d"),N=I.createImageData(p,p);return n.qrToImageData(N.data,l,u),c(I,y,p),I.putImageData(N,0,0),y},a.renderToDataURL=function(l,d,h){let u=h;typeof u>"u"&&(!d||!d.getContext)&&(u=d,d=void 0),u||(u={});const y=a.render(l,d,u),p=u.type||"image/png",I=u.rendererOpts||{};return y.toDataURL(p,I.quality)}})(jr);var Cr={};const qs=_t;function lr(a,n){const c=a.a/255,s=n+'="'+a.hex+'"';return c<1?s+" "+n+'-opacity="'+c.toFixed(2).slice(1)+'"':s}function pt(a,n,c){let s=a+n;return typeof c<"u"&&(s+=" "+c),s}function Os(a,n,c){let s="",i=0,l=!1,d=0;for(let h=0;h<a.length;h++){const u=Math.floor(h%n),y=Math.floor(h/n);!u&&!l&&(l=!0),a[h]?(d++,h>0&&u>0&&a[h-1]||(s+=l?pt("M",u+c,.5+y+c):pt("m",i,0),i=0,l=!1),u+1<n&&a[h+1]||(s+=pt("h",d),d=0)):i++}return s}Cr.render=function(n,c,s){const i=qs.getOptions(c),l=n.modules.size,d=n.modules.data,h=l+i.margin*2,u=i.color.light.a?"<path "+lr(i.color.light,"fill")+' d="M0 0h'+h+"v"+h+'H0z"/>':"",y="<path "+lr(i.color.dark,"stroke")+' d="'+Os(d,l,i.margin)+'"/>',p='viewBox="0 0 '+h+" "+h+'"',N='<svg xmlns="http://www.w3.org/2000/svg" '+(i.width?'width="'+i.width+'" height="'+i.width+'" ':"")+p+' shape-rendering="crispEdges">'+u+y+`</svg>
`;return typeof s=="function"&&s(null,N),N};const Qs=ns,Nt=cr,vr=jr,Vs=Cr;function St(a,n,c,s,i){const l=[].slice.call(arguments,1),d=l.length,h=typeof l[d-1]=="function";if(!h&&!Qs())throw new Error("Callback required as last argument");if(h){if(d<2)throw new Error("Too few arguments provided");d===2?(i=c,c=n,n=s=void 0):d===3&&(n.getContext&&typeof i>"u"?(i=s,s=void 0):(i=s,s=c,c=n,n=void 0))}else{if(d<1)throw new Error("Too few arguments provided");return d===1?(c=n,n=s=void 0):d===2&&!n.getContext&&(s=c,c=n,n=void 0),new Promise(function(u,y){try{const p=Nt.create(c,s);u(a(p,n,s))}catch(p){y(p)}})}try{const u=Nt.create(c,s);i(null,a(u,n,s))}catch(u){i(u)}}je.create=Nt.create;je.toCanvas=St.bind(null,vr.render);je.toDataURL=St.bind(null,vr.renderToDataURL);je.toString=St.bind(null,function(a,n,c){return Vs.render(a,c)});const Gs=({url:a,title:n="QR Code",description:c="Scan this QR code to access the form",size:s=200,showControls:i=!0})=>{const[l,d]=M.useState(null),[h,u]=M.useState(!1),[y,p]=M.useState(null),[I,N]=M.useState(!1),[w,T]=M.useState(s),[f,G]=M.useState(a||"");M.useRef(null),M.useEffect(()=>{f!=null&&f.trim()&&v(f,w)},[f,w]);const v=async(C,P=200)=>{var U;try{if(u(!0),p(null),!(C!=null&&C.trim()))throw new Error("URL is required to generate QR code");let B=C==null?void 0:C.trim();!(B!=null&&B.startsWith("http://"))&&!(B!=null&&B.startsWith("https://"))&&(B!=null&&B.startsWith("/")?B=`${(U=window==null?void 0:window.location)==null?void 0:U.origin}${B}`:B=`https://${B}`);const Y=await(je==null?void 0:je.toDataURL(B,{width:P,height:P,margin:2,color:{dark:"#000000",light:"#FFFFFF"},errorCorrectionLevel:"M"}));d(Y)}catch(B){console.error("Error generating QR code:",B),p((B==null?void 0:B.message)||"Failed to generate QR code")}finally{u(!1)}},k=()=>{var C,P;if(l)try{const U=document==null?void 0:document.createElement("a");U.download=`${n==null?void 0:n.replace(/[^a-zA-Z0-9]/g,"_")}_QRCode.png`,U.href=l,(C=document==null?void 0:document.body)==null||C.appendChild(U),U==null||U.click(),(P=document==null?void 0:document.body)==null||P.removeChild(U)}catch(U){console.error("Error downloading QR code:",U),p("Failed to download QR code")}},_=async()=>{var C,P,U;try{if(navigator!=null&&navigator.clipboard&&l){const B=await fetch(l),Y=await(B==null?void 0:B.blob());await((C=navigator==null?void 0:navigator.clipboard)==null?void 0:C.write([new ClipboardItem({"image/png":Y})])),N(!0),setTimeout(()=>N(!1),2e3)}else await((P=navigator==null?void 0:navigator.clipboard)==null?void 0:P.writeText(f)),N(!0),setTimeout(()=>N(!1),2e3)}catch(B){console.error("Error copying to clipboard:",B);try{await((U=navigator==null?void 0:navigator.clipboard)==null?void 0:U.writeText(f)),N(!0),setTimeout(()=>N(!1),2e3)}catch{p("Failed to copy to clipboard")}}},E=async()=>{try{if(navigator!=null&&navigator.share&&l){const C=await fetch(l),P=await(C==null?void 0:C.blob()),U=new File([P],`${n}_QRCode.png`,{type:"image/png"});await(navigator==null?void 0:navigator.share({title:n,text:c,url:f,files:[U]}))}else await _()}catch(C){console.error("Error sharing QR code:",C),(C==null?void 0:C.name)!=="AbortError"&&p("Failed to share QR code")}},D=()=>{G(a||""),T(s),p(null),N(!1)};return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(et,{className:"w-5 h-5 text-blue-600 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:n})]}),c&&e.jsx("p",{className:"text-gray-600 text-sm mb-6",children:c}),y&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mb-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(or,{className:"w-4 h-4 text-red-600 mr-2"}),e.jsx("p",{className:"text-red-800 text-sm",children:y})]})}),i&&e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"URL to Generate QR Code"}),e.jsx("input",{type:"url",value:f,onChange:C=>{var P;return G((P=C==null?void 0:C.target)==null?void 0:P.value)},placeholder:"Enter URL (e.g., https://yoursite.com/guest-claims-form)",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["QR Code Size: ",w,"px"]}),e.jsx("input",{type:"range",min:"100",max:"400",step:"25",value:w,onChange:C=>{var P;return T(parseInt((P=C==null?void 0:C.target)==null?void 0:P.value))},className:"w-full"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(J,{onClick:()=>v(f,w),disabled:h||!(f!=null&&f.trim()),variant:"primary",size:"md",className:"","aria-label":"Generate QR Code",children:h?"Generating...":"Generate QR Code"}),e.jsx(J,{onClick:D,variant:"secondary",size:"md",className:"","aria-label":"Reset to default values",children:"Reset"})]})]}),e.jsxs("div",{className:"flex flex-col items-center mb-6",children:[h&&e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Generating QR Code..."})]}),l&&!h&&e.jsx("div",{className:"bg-white border-2 border-gray-200 rounded-lg p-4 shadow-sm",children:e.jsx("img",{src:l,alt:`QR Code for ${n}`,className:"block",style:{width:w,height:w}})}),!l&&!h&&(f==null?void 0:f.trim())&&e.jsx("div",{className:"flex items-center justify-center p-8 border-2 border-dashed border-gray-300 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(et,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:'Click "Generate QR Code" to create QR code'})]})}),!(f!=null&&f.trim())&&i&&e.jsx("div",{className:"flex items-center justify-center p-8 border-2 border-dashed border-gray-300 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(et,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"Enter a URL to generate QR code"})]})})]}),l&&e.jsxs("div",{className:"flex flex-wrap gap-2 justify-center",children:[e.jsxs(J,{onClick:k,variant:"primary",size:"md",className:"","aria-label":"Download QR Code as PNG",children:[e.jsx(Hr,{className:"w-4 h-4 mr-1"}),"Download PNG"]}),e.jsxs(J,{onClick:_,variant:"secondary",size:"md",className:"","aria-label":I?"QR Code copied":"Copy QR Code to clipboard",children:[I?e.jsx(Kr,{className:"w-4 h-4 mr-1"}):e.jsx(Jr,{className:"w-4 h-4 mr-1"}),I?"Copied!":"Copy"]}),(navigator==null?void 0:navigator.share)&&e.jsxs(J,{onClick:E,variant:"secondary",size:"md",className:"","aria-label":"Share QR Code",children:[e.jsx(Yr,{className:"w-4 h-4 mr-1"}),"Share"]})]}),f&&e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 border border-gray-200 rounded-md",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Target URL:"}),e.jsx("p",{className:"text-sm font-mono text-gray-800 break-all",children:f})]})]})},en=()=>{var It,zt,$t,qt,Ot;const{userProfile:a,user:n,loading:c}=Wr(),{orgId:s}=rs(),{logBusinessAction:i,logError:l}=ss(),[d,h]=M.useState(!0),[u,y]=M.useState("userAccounts"),[p,I]=M.useState(null),[N,w]=M.useState(!0),[T,f]=M.useState(""),[G,v]=M.useState(""),[k,_]=M.useState(""),[E,D]=M.useState(""),[C,P]=M.useState(""),[U,B]=M.useState(""),[Y,ye]=M.useState(""),[we,ie]=M.useState(""),[O,lt]=M.useState({authUser:null,userProfile:null,profileLoadError:null,showDebug:!1}),[te,Et]=M.useState([]),[re,At]=M.useState([]),[X,Tt]=M.useState([]),[F,kt]=M.useState([]),[Rt,Mt]=M.useState([]),[W,Pt]=M.useState([]),[he,se]=M.useState(!1),[Me,Bt]=M.useState(null),[_r,Je]=M.useState(!1),[le,Sr]=M.useState(""),[A,Lt]=M.useState(null),[b,be]=M.useState({full_name:"",email:"",password:"",role:"manager",department:"",phone:""}),[z,Pe]=M.useState({full_name:"",phone:"",email:"",department:""}),[S,ge]=M.useState({name:"",contact_person:"",phone:"",email:"",specialty:"",rating:"",org_id:null}),[x,oe]=M.useState({name:"",brand:"",category:"",cost:"",unit_price:"",part_number:"",description:"",op_code:"",org_id:null}),[Q,Ye]=M.useState({name:"",message_template:"",template_type:"job_status"}),ot=[{id:"userAccounts",label:"User Accounts",icon:Xr},{id:"staffRecords",label:"Staff Records",icon:Fr},{id:"vendors",label:"Vendors",icon:Ne},{id:"products",label:"Aftermarket Products",icon:es},{id:"smsTemplates",label:"SMS Templates",icon:ts},{id:"qrCodes",label:"QR Code Generator",icon:et}],ct=[{value:"admin",label:"Admin"},{value:"manager",label:"Manager"},{value:"staff",label:"Staff"},{value:"vendor",label:"Vendor"}],We=[{value:"Delivery Coordinator",label:"Delivery Coordinator"},{value:"Managers",label:"Managers"},{value:"Finance Manager",label:"Finance Manager"}],Ze=[{value:"Sales Consultants",label:"Sales Consultants"},{value:"Finance Manager",label:"Finance Manager"}],dt=[{value:"job_status",label:"Job Status"},{value:"overdue_alert",label:"Overdue Alert"},{value:"customer_notification",label:"Customer Notification"},{value:"vendor_assignment",label:"Vendor Assignment"},{value:"completion_notice",label:"Completion Notice"}];M.useEffect(()=>{c||(async()=>{var g,r,o;try{if(console.log("Admin panel initializing...",{authLoading:c,user:!!n,userProfile:!!a}),!R){I("Database connection unavailable. Please refresh the page."),h(!1);return}const{error:m}=await((o=(r=(g=R)==null?void 0:g.from("user_profiles"))==null?void 0:r.select("id"))==null?void 0:o.limit(1));if(m){console.error("Database connection failed:",m),I("Unable to connect to database. Please check your Supabase configuration."),h(!1);return}await Dt(),h(!1)}catch(m){console.error("Admin initialization failed:",m),I("Failed to initialize admin panel: "+(m==null?void 0:m.message)),h(!1)}})()},[c]);const Er=async()=>{var t,g,r,o,m,L,q,Z,ae,ee,ue,me,Ue,Ie,ze;console.log("=== ADMIN ACCESS DEBUG ===");try{const{data:{session:$},error:_e}=await((g=(t=R)==null?void 0:t.auth)==null?void 0:g.getSession());if(console.log("Current session:",{hasSession:!!$,sessionError:_e,userId:(r=$==null?void 0:$.user)==null?void 0:r.id,userEmail:(o=$==null?void 0:$.user)==null?void 0:o.email}),$!=null&&$.user){console.log("Auth user:",{id:(m=$==null?void 0:$.user)==null?void 0:m.id,email:(L=$==null?void 0:$.user)==null?void 0:L.email,role:(q=$==null?void 0:$.user)==null?void 0:q.role}),console.log("Attempting to fetch user profile...");const{data:Ee,error:qe}=await((me=(ue=(ae=(Z=R)==null?void 0:Z.from("user_profiles"))==null?void 0:ae.select("*"))==null?void 0:ue.eq("id",(ee=$==null?void 0:$.user)==null?void 0:ee.id))==null?void 0:me.single());console.log("Direct profile fetch result:",{profile:Ee,profileError:qe,hasProfile:!!Ee}),lt({authUser:$==null?void 0:$.user,userProfile:Ee,profileLoadError:qe,showDebug:!0})}else console.log("No authenticated user found"),lt({authUser:null,userProfile:null,profileLoadError:{message:"No authenticated user"},showDebug:!0});console.log("Testing database access...");const{data:Se,error:$e}=await((ze=(Ie=(Ue=R)==null?void 0:Ue.from("user_profiles"))==null?void 0:Ie.select("id, full_name, role"))==null?void 0:ze.limit(5));console.log("Database access test:",{canAccess:!$e,recordCount:(Se==null?void 0:Se.length)||0,error:$e})}catch($){console.error("Debug error:",$),lt(_e=>({..._e,profileLoadError:$,showDebug:!0}))}},Dt=async()=>{console.log("Loading admin data...");try{const t=await Promise.allSettled([Ce(),ve(),Be(),Le(),ut(),Ar()]);t==null||t.forEach((g,r)=>{const o=["User Accounts","Staff Records","Vendors","Products","SMS Templates"];(g==null?void 0:g.status)==="rejected"?console.error(`Failed to load ${o==null?void 0:o[r]}:`,g==null?void 0:g.reason):console.log(`Successfully loaded ${o==null?void 0:o[r]}`)})}catch(t){console.error("Error loading admin data:",t),I("Failed to load some admin data. Please try refreshing the page.")}},Ar=async()=>{var t,g,r;try{const{data:o,error:m}=await((r=(g=(t=R)==null?void 0:t.from("organizations"))==null?void 0:g.select("id, name"))==null?void 0:r.order("name"));if(m)throw m;Mt(o||[])}catch(o){console.warn("Failed to load organizations (optional):",o==null?void 0:o.message),Mt([])}},Ce=async()=>{var t,g,r;try{console.log("Loading user accounts...");let o=(r=(g=(t=R)==null?void 0:t.from("user_profiles"))==null?void 0:g.select("*",{count:"exact"}))==null?void 0:r.in("role",["admin","manager"]);N&&s&&(o=o==null?void 0:o.eq("org_id",s)),o=o==null?void 0:o.order("created_at",{ascending:!1});const{data:m,error:L,count:q}=await o;if(L)throw console.error("User accounts query error:",L),L;console.log(`User accounts query result: ${(m==null?void 0:m.length)||0} records`),Et(m||[])}catch(o){console.error("Error loading user accounts:",o)}},ve=async()=>{var t,g,r;try{console.log("Loading staff records...");let o=(r=(g=(t=R)==null?void 0:t.from("user_profiles"))==null?void 0:g.select("*",{count:"exact"}))==null?void 0:r.eq("role","staff");N&&s&&(o=o==null?void 0:o.eq("org_id",s)),o=o==null?void 0:o.order("created_at",{ascending:!1});const{data:m,error:L}=await o;if(L)throw console.error("Staff records query error:",L),L;console.log(`Staff records: ${m==null?void 0:m.length} staff members found`),At(m||[])}catch(o){console.error("Error loading staff records:",o)}},Ut=async t=>{var g,r,o;if(!s){alert("No organization detected for current user");return}try{se(!0);const{error:m}=await((o=(r=(g=R)==null?void 0:g.from("user_profiles"))==null?void 0:r.update({org_id:s,is_active:!0}))==null?void 0:o.eq("id",t));if(m)throw m;await Promise.all([Ce(),ve()]);try{await(i==null?void 0:i("attach_profile_to_org","admin",t,"Attached user profile to current org",{orgId:s}))}catch{}}catch(m){console.error("attachProfileToMyOrg error:",m),alert("Failed to attach to org: "+((m==null?void 0:m.message)||"Unknown error"));try{await(l==null?void 0:l(m,{where:"attachProfileToMyOrg",orgId:s,profileId:t}))}catch{}}finally{se(!1)}},Tr=async()=>{var t,g,r,o;if(f(""),!s){f("No organization detected for current user.");return}try{se(!0);const{error:m}=await((o=(r=(g=(t=R)==null?void 0:t.from("user_profiles"))==null?void 0:g.update({org_id:s,is_active:!0}))==null?void 0:r.is("org_id",null))==null?void 0:o.eq("role","staff"));if(m)throw m;f("Assigned org to active staff without org."),await ve();try{await(i==null?void 0:i("assign_org_staff","system",null,"Assigned org to staff without org",{orgId:s}))}catch{}}catch(m){console.error("assignOrgToActiveStaff error:",m),f((m==null?void 0:m.message)||"Failed to assign org to staff");try{await(l==null?void 0:l(m,{where:"assignOrgToActiveStaff",orgId:s}))}catch{}}finally{se(!1)}},kr=async()=>{var t,g,r,o;if(v(""),!s){v("No organization detected for current user.");return}try{se(!0);const{error:m}=await((o=(r=(g=(t=R)==null?void 0:t.from("user_profiles"))==null?void 0:g.update({org_id:s,is_active:!0}))==null?void 0:r.is("org_id",null))==null?void 0:o.in("role",["admin","manager"]));if(m)throw m;v("Assigned org to admin/manager accounts without org."),await Ce()}catch(m){console.error("assignOrgToAccounts error:",m),v((m==null?void 0:m.message)||"Failed to assign org to accounts")}finally{se(!1)}};M.useEffect(()=>{ve(),Ce(),Be(),Le()},[N,s]);const Be=async()=>{var t,g;try{console.log("Loading vendors...");let r=(g=(t=R)==null?void 0:t.from("vendors"))==null?void 0:g.select("*",{count:"exact"});N&&s&&(r=r==null?void 0:r.eq("org_id",s)),r=r==null?void 0:r.order("created_at",{ascending:!1});const{data:o,error:m,count:L}=await r;if(m)throw console.error("Vendors query error:",m),m;console.log(`Vendors query result: ${(o==null?void 0:o.length)||0} records`),Tt(o||[])}catch(r){console.error("Error loading vendors:",r)}},Le=async()=>{var t,g;try{console.log("Loading products...");let r=(g=(t=R)==null?void 0:t.from("products"))==null?void 0:g.select("*, vendors(name)",{count:"exact"});N&&s&&(r=r==null?void 0:r.eq("org_id",s)),r=r==null?void 0:r.order("created_at",{ascending:!1});const{data:o,error:m,count:L}=await r;if(m)throw console.error("Products query error:",m),m;console.log(`Products query result: ${(o==null?void 0:o.length)||0} records`),kt(o||[])}catch(r){console.error("Error loading products:",r)}},Rr=async()=>{var t,g,r;if(_(""),!s){_("No organization detected for current user.");return}try{se(!0);const{error:o}=await((r=(g=(t=R)==null?void 0:t.from("vendors"))==null?void 0:g.update({org_id:s}))==null?void 0:r.is("org_id",null));if(o)throw o;_("Assigned org to vendors without org."),await Be();try{await(i==null?void 0:i("assign_org_vendors","system",null,"Assigned org to vendors without org",{orgId:s}))}catch{}}catch(o){console.error("assignOrgToVendors error:",o),_((o==null?void 0:o.message)||"Failed to assign org to vendors");try{await(l==null?void 0:l(o,{where:"assignOrgToVendors",orgId:s}))}catch{}}finally{se(!1)}},Mr=async()=>{var t,g,r;if(D(""),!s){D("No organization detected for current user.");return}try{se(!0);const{error:o}=await((r=(g=(t=R)==null?void 0:t.from("products"))==null?void 0:g.update({org_id:s}))==null?void 0:r.is("org_id",null));if(o)throw o;D("Assigned org to products without org."),await Le();try{await(i==null?void 0:i("assign_org_products","system",null,"Assigned org to products without org",{orgId:s}))}catch{}}catch(o){console.error("assignOrgToProducts error:",o),D((o==null?void 0:o.message)||"Failed to assign org to products");try{await(l==null?void 0:l(o,{where:"assignOrgToProducts",orgId:s}))}catch{}}finally{se(!1)}},ut=async()=>{var t,g,r;try{console.log("Loading SMS templates...");const{data:o,error:m,count:L}=await((r=(g=(t=R)==null?void 0:t.from("sms_templates"))==null?void 0:g.select("*",{count:"exact"}))==null?void 0:r.order("created_at",{ascending:!1}));if(m)throw console.error("SMS templates query error:",m),m;console.log(`SMS templates query result: ${(o==null?void 0:o.length)||0} records`),Pt(o||[])}catch(o){console.error("Error loading SMS templates:",o)}},ce=(t,g=null)=>{Sr(t),Lt(g),Je(!0),t==="userAccount"?be(g||{full_name:"",email:"",password:"",role:"manager",department:"",phone:""}):t==="staff"?Pe(g||{full_name:"",phone:"",email:"",department:""}):t==="vendor"?ge(g||{name:"",contact_person:"",phone:"",email:"",specialty:"",rating:"",org_id:s||null}):t==="product"?oe(g||{name:"",brand:"",category:"",cost:"",unit_price:"",part_number:"",description:"",op_code:"",org_id:s||null}):t==="template"&&Ye(g||{name:"",message_template:"",template_type:"job_status"})},Pr=async t=>{t==null||t.preventDefault(),se(!0);try{le==="userAccount"?await Br():le==="staff"?await Lr():le==="vendor"?await Dr():le==="product"?await Ur():le==="template"&&await Ir(),Je(!1),Lt(null)}catch(g){console.error("Error submitting form:",g),alert("Error: "+(g==null?void 0:g.message))}finally{se(!1)}},Br=async()=>{var t,g,r,o,m,L,q,Z;if(A){if(s&&(A!=null&&A.org_id)&&(A==null?void 0:A.org_id)!==s){if(!window.confirm("This user belongs to another organization. Reassign to your org and continue editing?"))throw new Error("Edit cancelled. User belongs to another organization.");const{error:ue}=await((r=(g=(t=R)==null?void 0:t.from("user_profiles"))==null?void 0:g.update({org_id:s,is_active:!0}))==null?void 0:r.eq("id",A==null?void 0:A.id));if(ue)throw ue}const{error:ae}=await((L=(m=(o=R)==null?void 0:o.from("user_profiles"))==null?void 0:m.update({full_name:b==null?void 0:b.full_name,email:b==null?void 0:b.email,role:b==null?void 0:b.role,department:b==null?void 0:b.department,phone:b==null?void 0:b.phone}))==null?void 0:L.eq("id",A==null?void 0:A.id));if(ae)throw ae}else{if(!(b!=null&&b.password))throw new Error("Password is required for new users");const{data:ae,error:ee}=await((Z=(q=R)==null?void 0:q.auth)==null?void 0:Z.signUp({email:b==null?void 0:b.email,password:b==null?void 0:b.password,options:{data:{full_name:b==null?void 0:b.full_name,role:b==null?void 0:b.role,department:b==null?void 0:b.department,phone:b==null?void 0:b.phone}}}));if(ee)throw ee}await Ce(),v("User account saved."),setTimeout(()=>v(""),3e3)},Lr=async()=>{var g,r,o,m,L,q,Z,ae;const t={full_name:z==null?void 0:z.full_name,phone:(z==null?void 0:z.phone)||null,email:(z==null?void 0:z.email)||null,department:z==null?void 0:z.department,role:"staff",is_active:!0,vendor_id:null,org_id:(z==null?void 0:z.org_id)||s||null};if(A){if(s&&(A!=null&&A.org_id)&&(A==null?void 0:A.org_id)!==s){if(!window.confirm("This staff profile belongs to another organization. Reassign to your org and continue editing?"))throw new Error("Edit cancelled. Staff belongs to another organization.");const{error:me}=await((o=(r=(g=R)==null?void 0:g.from("user_profiles"))==null?void 0:r.update({org_id:s,is_active:!0}))==null?void 0:o.eq("id",A==null?void 0:A.id));if(me)throw me}const{error:ee}=await((q=(L=(m=R)==null?void 0:m.from("user_profiles"))==null?void 0:L.update(t))==null?void 0:q.eq("id",A==null?void 0:A.id));if(ee)throw ee}else{const{error:ee}=await((ae=(Z=R)==null?void 0:Z.from("user_profiles"))==null?void 0:ae.insert([t]));if(ee)throw ee}await ve(),f("Staff profile saved."),setTimeout(()=>f(""),3e3)},Dr=async()=>{var g,r,o,m,L;const t={name:S==null?void 0:S.name,contact_person:S==null?void 0:S.contact_person,phone:S==null?void 0:S.phone,email:S==null?void 0:S.email,specialty:S==null?void 0:S.specialty,rating:S!=null&&S.rating?parseFloat(S==null?void 0:S.rating):null,org_id:(S==null?void 0:S.org_id)||s||null};if(A){const{error:q}=await((o=(r=(g=R)==null?void 0:g.from("vendors"))==null?void 0:r.update(t))==null?void 0:o.eq("id",A==null?void 0:A.id));if(q)throw q}else{const{error:q}=await((L=(m=R)==null?void 0:m.from("vendors"))==null?void 0:L.insert([t]));if(q)throw q}await Be()},Ur=async()=>{var g,r,o,m,L;const t={name:x==null?void 0:x.name,brand:x==null?void 0:x.brand,category:x==null?void 0:x.category,cost:x!=null&&x.cost?parseFloat(x==null?void 0:x.cost):0,unit_price:x!=null&&x.unit_price?parseFloat(x==null?void 0:x.unit_price):0,part_number:x==null?void 0:x.part_number,description:x==null?void 0:x.description,op_code:(x==null?void 0:x.op_code)||null,org_id:(x==null?void 0:x.org_id)||s||null};if(A){const{error:q}=await((o=(r=(g=R)==null?void 0:g.from("products"))==null?void 0:r.update(t))==null?void 0:o.eq("id",A==null?void 0:A.id));if(q)throw q}else{const{error:q}=await((L=(m=R)==null?void 0:m.from("products"))==null?void 0:L.insert([t]));if(q)throw q}await Le()},Ir=async()=>{var r,o,m,L,q;let t=Q==null?void 0:Q.message_template;if(!(t!=null&&t.startsWith("Stock #"))&&!(t!=null&&t.startsWith("{{stock"))&&(t="Stock #{{stock_number}}: "+t),(t==null?void 0:t.length)>160)throw new Error("SMS template must be under 160 characters");const g={name:Q==null?void 0:Q.name,message_template:t,template_type:Q==null?void 0:Q.template_type};if(A){const{error:Z}=await((m=(o=(r=R)==null?void 0:r.from("sms_templates"))==null?void 0:o.update(g))==null?void 0:m.eq("id",A==null?void 0:A.id));if(Z)throw Z}else{const{error:Z}=await((q=(L=R)==null?void 0:L.from("sms_templates"))==null?void 0:q.insert([g]));if(Z)throw Z}await ut()},De=async(t,g,r=null)=>{var m,L,q,Z,ae,ee,ue,me,Ue,Ie,ze,$,_e,Se,$e,Ee,qe,Qt,Vt,Gt,Ht,Kt,Jt,Yt,Wt,Zt,Xt,Ft,er,tr,rr,sr,nr;if(confirm(`Are you sure you want to delete ${t==="user_profiles"?r==="userAccount"?"this user account":"this staff profile":t==="vendors"?"this vendor":t==="products"?"this product":t==="sms_templates"?"this template":"this item"}? This action cannot be undone.`)){Bt(g),se(!0);try{if(console.log(`Deleting from ${t} with id: ${g}`),t==="user_profiles"){console.log("Cleaning up foreign key dependencies...");const j=[(q=(L=(m=R)==null?void 0:m.from("jobs"))==null?void 0:L.update({assigned_to:null,created_by:null,delivery_coordinator_id:null}))==null?void 0:q.or(`assigned_to.eq.${g},created_by.eq.${g},delivery_coordinator_id.eq.${g}`)];j==null||j.push((ee=(ae=(Z=R)==null?void 0:Z.from("transactions"))==null?void 0:ae.update({processed_by:null}))==null?void 0:ee.eq("processed_by",g)),j==null||j.push((Ue=(me=(ue=R)==null?void 0:ue.from("vehicles"))==null?void 0:me.update({created_by:null}))==null?void 0:Ue.eq("created_by",g)),j==null||j.push(($=(ze=(Ie=R)==null?void 0:Ie.from("vendors"))==null?void 0:ze.update({created_by:null}))==null?void 0:$.eq("created_by",g)),j==null||j.push(($e=(Se=(_e=R)==null?void 0:_e.from("products"))==null?void 0:Se.update({created_by:null}))==null?void 0:$e.eq("created_by",g)),j==null||j.push((Qt=(qe=(Ee=R)==null?void 0:Ee.from("sms_templates"))==null?void 0:qe.update({created_by:null}))==null?void 0:Qt.eq("created_by",g)),j==null||j.push((Ht=(Gt=(Vt=R)==null?void 0:Vt.from("filter_presets"))==null?void 0:Gt.delete())==null?void 0:Ht.eq("user_id",g)),j==null||j.push((Yt=(Jt=(Kt=R)==null?void 0:Kt.from("notification_preferences"))==null?void 0:Jt.delete())==null?void 0:Yt.eq("user_id",g)),j==null||j.push((Xt=(Zt=(Wt=R)==null?void 0:Wt.from("activity_history"))==null?void 0:Zt.delete())==null?void 0:Xt.eq("performed_by",g)),j==null||j.push((tr=(er=(Ft=R)==null?void 0:Ft.from("communications"))==null?void 0:er.delete())==null?void 0:tr.eq("sent_by",g)),await Promise.allSettled(j),console.log("Foreign key cleanup completed")}const{error:xe}=await((nr=(sr=(rr=R)==null?void 0:rr.from(t))==null?void 0:sr.delete())==null?void 0:nr.eq("id",g));if(xe)throw console.error("Delete operation failed:",xe),xe;console.log("Delete operation successful"),t==="user_profiles"?(r==="userAccount"?(Et(j=>{const V=j==null?void 0:j.filter(K=>(K==null?void 0:K.id)!==g);return console.log(`User accounts updated: ${V==null?void 0:V.length} remaining`),V||[]}),v("User account deleted.")):(At(j=>{const V=j==null?void 0:j.filter(K=>(K==null?void 0:K.id)!==g);return console.log(`Staff records updated: ${V==null?void 0:V.length} remaining`),V||[]}),f("Staff profile deleted.")),setTimeout(async()=>{try{await Promise.all([Ce(),ve()]),console.log("Data reloaded successfully after deletion")}catch(j){console.error("Error refreshing data after deletion:",j)}},500)):t==="vendors"?(Tt(j=>{const V=j==null?void 0:j.filter(K=>(K==null?void 0:K.id)!==g);return console.log(`Vendors updated: ${V==null?void 0:V.length} remaining`),V||[]}),setTimeout(async()=>{try{await Be(),console.log("Vendors reloaded successfully")}catch(j){console.error("Error refreshing vendors:",j)}},500)):t==="products"?(kt(j=>{const V=j==null?void 0:j.filter(K=>(K==null?void 0:K.id)!==g);return console.log(`Products updated: ${V==null?void 0:V.length} remaining`),V||[]}),setTimeout(async()=>{try{await Le(),console.log("Products reloaded successfully")}catch(j){console.error("Error refreshing products:",j)}},500)):t==="sms_templates"&&(Pt(j=>{const V=j==null?void 0:j.filter(K=>(K==null?void 0:K.id)!==g);return console.log(`SMS templates updated: ${V==null?void 0:V.length} remaining`),V||[]}),setTimeout(async()=>{try{await ut(),console.log("SMS templates reloaded successfully")}catch(j){console.error("Error refreshing SMS templates:",j)}},500)),console.log(`Successfully deleted item from ${t}`),setTimeout(()=>{v(""),f("")},3e3)}catch(xe){console.error("Error deleting item:",xe),alert("Error deleting item: "+((xe==null?void 0:xe.message)||"Unknown error")),setTimeout(async()=>{try{await Dt(),console.log("All data reloaded after error")}catch(j){console.error("Error refreshing all data after deletion error:",j)}},1e3)}finally{se(!1),Bt(null)}}},zr=()=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["User Accounts (",te.length,")"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4 accent-blue-600 appearance-auto",checked:N,onChange:t=>w(t.target.checked)}),e.jsx("span",{className:"text-sm",children:"Only my org"})]}),e.jsxs(J,{onClick:kr,disabled:!s||he,className:"bg-emerald-600 hover:bg-emerald-700 text-white flex items-center gap-2 disabled:opacity-50",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Assign Org to Accounts"]}),e.jsxs(J,{onClick:()=>ce("userAccount"),className:"bg-blue-600 hover:bg-blue-700 text-white flex items-center gap-2",children:[e.jsx(Oe,{className:"w-4 h-4"}),"Add User Account"]})]})]}),e.jsx("div",{className:"mb-3 text-sm text-gray-600",children:"Tip: You can edit any account. If it belongs to another org, you’ll be prompted to reassign it to your org on save. Or click the building icon to attach immediately."}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-3 mb-4",children:[e.jsx("input",{type:"text",value:C,onChange:t=>P(t.target.value),placeholder:"Search by name or email",className:"px-3 py-2 border border-gray-300 rounded-md w-full md:max-w-sm"}),e.jsxs("select",{value:U,onChange:t=>B(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-md w-full md:max-w-xs",children:[e.jsx("option",{value:"",children:"All departments"}),We.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Department"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Org"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:(te||[]).filter(t=>{const g=C.trim().toLowerCase();return g?String((t==null?void 0:t.full_name)||"").toLowerCase().includes(g)||String((t==null?void 0:t.email)||"").toLowerCase().includes(g):!0}).filter(t=>U?String((t==null?void 0:t.department)||"")===U:!0).map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:t==null?void 0:t.full_name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t==null?void 0:t.email}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${(t==null?void 0:t.role)==="admin"?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"}`,children:t==null?void 0:t.role})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t==null?void 0:t.department}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:t!=null&&t.org_id?String(t==null?void 0:t.org_id).slice(0,8):"—"}),s&&(t!=null&&t.org_id)&&(t==null?void 0:t.org_id)!==s?e.jsx("span",{className:"inline-flex px-2 py-0.5 text-xs rounded-full bg-yellow-100 text-yellow-800",children:"Other org"}):null]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t!=null&&t.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t!=null&&t.is_active?"Active":"Inactive"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ce("userAccount",t),className:"text-blue-600 hover:text-blue-900",title:s&&(t!=null&&t.org_id)&&(t==null?void 0:t.org_id)!==s?"Edit user (will prompt to reassign to your org on save)":"Edit user",children:e.jsx(Qe,{className:"w-4 h-4"})}),s&&(t==null?void 0:t.org_id)&&(t==null?void 0:t.org_id)!==s&&e.jsx("button",{title:"Attach to my org",onClick:()=>Ut(t==null?void 0:t.id),className:"text-emerald-600 hover:text-emerald-800 disabled:opacity-50",disabled:he,children:e.jsx(Ne,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>De("user_profiles",t==null?void 0:t.id,"userAccount"),disabled:Me===(t==null?void 0:t.id),className:"text-red-600 hover:text-red-900 disabled:opacity-50",children:e.jsx(Ve,{className:"w-4 h-4"})})]})})]},t==null?void 0:t.id))})]})}),(te==null?void 0:te.length)===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:'No user accounts found. Click "Add User Account" to create one.'}),G?e.jsx("div",{className:"mt-3 p-3 rounded bg-blue-50 text-blue-700",children:G}):null]}),$r=()=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Staff Records (",re.length,")"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4 accent-blue-600 appearance-auto",checked:N,onChange:t=>w(t.target.checked)}),e.jsx("span",{className:"text-sm",children:"Only my org"})]}),e.jsxs(J,{onClick:Tr,disabled:!s||he,className:"bg-emerald-600 hover:bg-emerald-700 text-white flex items-center gap-2 disabled:opacity-50",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Assign Org to Staff"]}),e.jsxs(J,{onClick:()=>ce("staff"),className:"bg-blue-600 hover:bg-blue-700 text-white flex items-center gap-2",children:[e.jsx(Oe,{className:"w-4 h-4"}),"Add Staff Member"]})]})]}),e.jsx("div",{className:"mb-3 text-sm text-gray-600",children:"Tip: You can edit any staff profile. If it belongs to another org, you’ll be prompted to reassign it to your org on save. Or click the building icon to attach immediately."}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-3 mb-4",children:[e.jsx("input",{type:"text",value:Y,onChange:t=>ye(t.target.value),placeholder:"Search by name, phone or email",className:"px-3 py-2 border border-gray-300 rounded-md w-full md:max-w-sm"}),e.jsxs("select",{value:we,onChange:t=>ie(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-md w-full md:max-w-xs",children:[e.jsx("option",{value:"",children:"All departments"}),Ze.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Department"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Phone"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Org"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:(re||[]).filter(t=>{const g=Y.trim().toLowerCase();return g?String((t==null?void 0:t.full_name)||"").toLowerCase().includes(g)||String((t==null?void 0:t.phone)||"").toLowerCase().includes(g)||String((t==null?void 0:t.email)||"").toLowerCase().includes(g):!0}).filter(t=>we?String((t==null?void 0:t.department)||"")===we:!0).map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:t==null?void 0:t.full_name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${(t==null?void 0:t.department)==="Sales Consultants"?"bg-green-100 text-green-800":"bg-purple-100 text-purple-800"}`,children:t==null?void 0:t.department})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(t==null?void 0:t.phone)||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(t==null?void 0:t.email)||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:t!=null&&t.org_id?String(t==null?void 0:t.org_id).slice(0,8):"—"}),s&&(t!=null&&t.org_id)&&(t==null?void 0:t.org_id)!==s?e.jsx("span",{className:"inline-flex px-2 py-0.5 text-xs rounded-full bg-yellow-100 text-yellow-800",children:"Other org"}):null]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t!=null&&t.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t!=null&&t.is_active?"Active":"Inactive"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ce("staff",t),className:"text-blue-600 hover:text-blue-900",title:s&&(t!=null&&t.org_id)&&(t==null?void 0:t.org_id)!==s?"Edit staff (will prompt to reassign to your org on save)":"Edit staff",children:e.jsx(Qe,{className:"w-4 h-4"})}),s&&(t==null?void 0:t.org_id)&&(t==null?void 0:t.org_id)!==s&&e.jsx("button",{title:"Attach to my org",onClick:()=>Ut(t==null?void 0:t.id),className:"text-emerald-600 hover:text-emerald-800 disabled:opacity-50",disabled:he,children:e.jsx(Ne,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>De("user_profiles",t==null?void 0:t.id,"staff"),disabled:Me===(t==null?void 0:t.id),className:"text-red-600 hover:text-red-900 disabled:opacity-50",children:e.jsx(Ve,{className:"w-4 h-4"})})]})})]},t==null?void 0:t.id))})]})}),(re==null?void 0:re.length)===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:'No staff records found. Click "Add Staff Member" to create one.'}),T?e.jsx("div",{className:"mt-3 p-3 rounded bg-blue-50 text-blue-700",children:T}):null]}),qr=()=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Vendors (",X.length,")"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4 accent-blue-600 appearance-auto",checked:N,onChange:t=>w(t.target.checked)}),e.jsx("span",{className:"text-sm",children:"Only my org"})]}),e.jsxs(J,{onClick:Rr,disabled:!s||he,className:"bg-emerald-600 hover:bg-emerald-700 text-white flex items-center gap-2 disabled:opacity-50",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Assign Org to Vendors"]}),e.jsxs(J,{onClick:()=>ce("vendor"),className:"bg-blue-600 hover:bg-blue-700 text-white flex items-center gap-2",children:[e.jsx(Oe,{className:"w-4 h-4"}),"Add Vendor"]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact Person"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Phone"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Specialty"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rating"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:X==null?void 0:X.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:t==null?void 0:t.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(t==null?void 0:t.contact_person)||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(t==null?void 0:t.phone)||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(t==null?void 0:t.specialty)||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t!=null&&t.rating?`${t==null?void 0:t.rating}/5`:"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t!=null&&t.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t!=null&&t.is_active?"Active":"Inactive"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ce("vendor",t),className:"text-blue-600 hover:text-blue-900",children:e.jsx(Qe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>De("vendors",t==null?void 0:t.id),disabled:Me===(t==null?void 0:t.id),className:"text-red-600 hover:text-red-900 disabled:opacity-50",children:e.jsx(Ve,{className:"w-4 h-4"})})]})})]},t==null?void 0:t.id))})]})}),(X==null?void 0:X.length)===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:'No vendors found. Click "Add Vendor" to create one.'}),k?e.jsx("div",{className:"mt-3 p-3 rounded bg-blue-50 text-blue-700",children:k}):null]}),Or=()=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Aftermarket Products (",F.length,")"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4 accent-blue-600 appearance-auto",checked:N,onChange:t=>w(t.target.checked)}),e.jsx("span",{className:"text-sm",children:"Only my org"})]}),e.jsxs(J,{onClick:Mr,disabled:!s||he,className:"bg-emerald-600 hover:bg-emerald-700 text-white flex items-center gap-2 disabled:opacity-50",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Assign Org to Products"]}),e.jsxs(J,{onClick:()=>ce("product"),className:"bg-blue-600 hover:bg-blue-700 text-white flex items-center gap-2",children:[e.jsx(Oe,{className:"w-4 h-4"}),"Add Product"]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Brand"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Op Code"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cost"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unit Price"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:F==null?void 0:F.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:t==null?void 0:t.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(t==null?void 0:t.brand)||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(t==null?void 0:t.category)||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-mono bg-gray-100 text-gray-800 rounded",children:(t==null?void 0:t.op_code)||"N/A"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:["$",(t==null?void 0:t.cost)||"0.00"]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:["$",(t==null?void 0:t.unit_price)||"0.00"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t!=null&&t.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t!=null&&t.is_active?"Active":"Inactive"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ce("product",t),className:"text-blue-600 hover:text-blue-900",children:e.jsx(Qe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>De("products",t==null?void 0:t.id),disabled:Me===(t==null?void 0:t.id),className:"text-red-600 hover:text-red-900 disabled:opacity-50",children:e.jsx(Ve,{className:"w-4 h-4"})})]})})]},t==null?void 0:t.id))})]})}),(F==null?void 0:F.length)===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:'No products found. Click "Add Product" to create one.'}),E?e.jsx("div",{className:"mt-3 p-3 rounded bg-blue-50 text-blue-700",children:E}):null]}),Qr=()=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["SMS Templates (",(W==null?void 0:W.length)||0,")"]}),e.jsxs(J,{onClick:()=>ce("template"),className:"bg-blue-600 hover:bg-blue-700 text-white flex items-center gap-2",children:[e.jsx(Oe,{className:"w-4 h-4"}),"Add Template"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Message Preview"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:W==null?void 0:W.map(t=>{var g;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:t==null?void 0:t.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:(g=t==null?void 0:t.template_type)==null?void 0:g.replace("_"," ")})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 max-w-xs truncate",children:t==null?void 0:t.message_template}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t!=null&&t.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t!=null&&t.is_active?"Active":"Inactive"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ce("template",t),className:"text-blue-600 hover:text-blue-900",children:e.jsx(Qe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>De("sms_templates",t==null?void 0:t.id),disabled:Me===(t==null?void 0:t.id),className:"text-red-600 hover:text-red-900 disabled:opacity-50",children:e.jsx(Ve,{className:"w-4 h-4"})})]})})]},t==null?void 0:t.id)})})]})}),(W==null?void 0:W.length)===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:'No SMS templates found. Click "Add Template" to create one.'})]}),Vr=()=>{var g;const t=`${(g=window==null?void 0:window.location)==null?void 0:g.origin}/guest-claims-submission-form`;return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"QR Code Generator"}),e.jsx("p",{className:"text-gray-600",children:"Generate QR codes for easy access to your guest claims form and other important links."})]}),e.jsx("div",{children:e.jsx(Gs,{url:t,title:"Guest Claims Submission Form",description:"Generate a QR code for customers to quickly access your guest claims form. Perfect for printing on business cards, flyers, or displaying in your shop.",size:250,showControls:!0})}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-3",children:"How to Use QR Codes:"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 text-sm text-blue-800",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium mb-2",children:"📱 For Customers:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"• Open camera app on smartphone"}),e.jsx("li",{children:"• Point camera at QR code"}),e.jsx("li",{children:"• Tap notification to open claims form"}),e.jsx("li",{children:"• No app download required"})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium mb-2",children:"🖨️ For Your Business:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"• Download and print QR codes"}),e.jsx("li",{children:"• Add to business cards"}),e.jsx("li",{children:"• Display in waiting areas"}),e.jsx("li",{children:"• Include in email signatures"})]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-6",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"QR Code Benefits:"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:"95%"}),e.jsx("div",{className:"text-gray-600",children:"Smartphone QR Support"})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:"3x"}),e.jsx("div",{className:"text-gray-600",children:"Faster Than Typing URLs"})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:"100%"}),e.jsx("div",{className:"text-gray-600",children:"Contactless Access"})]})]})]})]})},Gr=()=>{var g;if(!_r)return null;const t=()=>{switch(le){case"userAccount":return A?"Edit User Account":"Add User Account";case"staff":return A?"Edit Staff Member":"Add Staff Member";case"vendor":return A?"Edit Vendor":"Add Vendor";case"product":return A?"Edit Product":"Add Product";case"template":return A?"Edit SMS Template":"Add SMS Template";default:return"Form"}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:t()}),e.jsx("button",{onClick:()=>Je(!1),className:"text-gray-400 hover:text-gray-600",children:"×"})]}),e.jsxs("form",{onSubmit:Pr,className:"space-y-4",children:[le==="userAccount"&&e.jsxs(e.Fragment,{children:[e.jsx(H,{label:"Full Name",value:b==null?void 0:b.full_name,onChange:r=>{var o;return be({...b,full_name:(o=r==null?void 0:r.target)==null?void 0:o.value})},required:!0}),e.jsx(H,{label:"Email",type:"email",value:b==null?void 0:b.email,onChange:r=>{var o;return be({...b,email:(o=r==null?void 0:r.target)==null?void 0:o.value})},required:!0}),!A&&e.jsx(H,{label:"Password",type:"password",value:b==null?void 0:b.password,onChange:r=>{var o;return be({...b,password:(o=r==null?void 0:r.target)==null?void 0:o.value})},required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role"}),e.jsx("select",{value:b==null?void 0:b.role,onChange:r=>{var o;return be({...b,role:(o=r==null?void 0:r.target)==null?void 0:o.value})},className:"w-full px-3 py-2 border border-gray-300 rounded-md",required:!0,children:ct==null?void 0:ct.map(r=>e.jsx("option",{value:r==null?void 0:r.value,children:r==null?void 0:r.label},r==null?void 0:r.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Department"}),e.jsxs("select",{value:b==null?void 0:b.department,onChange:r=>{var o;return be({...b,department:(o=r==null?void 0:r.target)==null?void 0:o.value})},className:"w-full px-3 py-2 border border-gray-300 rounded-md",required:!0,children:[e.jsx("option",{value:"",children:"Select Department"}),We==null?void 0:We.map(r=>e.jsx("option",{value:r==null?void 0:r.value,children:r==null?void 0:r.label},r==null?void 0:r.value))]})]}),e.jsx(H,{label:"Phone",value:b==null?void 0:b.phone,onChange:r=>{var o;return be({...b,phone:(o=r==null?void 0:r.target)==null?void 0:o.value})}})]}),le==="staff"&&e.jsxs(e.Fragment,{children:[e.jsx(H,{label:"Full Name",value:z==null?void 0:z.full_name,onChange:r=>{var o;return Pe({...z,full_name:(o=r==null?void 0:r.target)==null?void 0:o.value})},required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Department"}),e.jsxs("select",{value:z==null?void 0:z.department,onChange:r=>{var o;return Pe({...z,department:(o=r==null?void 0:r.target)==null?void 0:o.value})},className:"w-full px-3 py-2 border border-gray-300 rounded-md",required:!0,children:[e.jsx("option",{value:"",children:"Select Department"}),Ze==null?void 0:Ze.map(r=>e.jsx("option",{value:r==null?void 0:r.value,children:r==null?void 0:r.label},r==null?void 0:r.value))]})]}),e.jsx(H,{label:"Phone",value:z==null?void 0:z.phone,onChange:r=>{var o;return Pe({...z,phone:(o=r==null?void 0:r.target)==null?void 0:o.value})}}),e.jsx(H,{label:"Email",type:"email",value:z==null?void 0:z.email,onChange:r=>{var o;return Pe({...z,email:(o=r==null?void 0:r.target)==null?void 0:o.value})}})]}),le==="vendor"&&e.jsxs(e.Fragment,{children:[e.jsx(H,{label:"Vendor Name",value:S==null?void 0:S.name,onChange:r=>{var o;return ge({...S,name:(o=r==null?void 0:r.target)==null?void 0:o.value})},required:!0}),e.jsx(H,{label:"Contact Person",value:S==null?void 0:S.contact_person,onChange:r=>{var o;return ge({...S,contact_person:(o=r==null?void 0:r.target)==null?void 0:o.value})}}),e.jsx(H,{label:"Phone",value:S==null?void 0:S.phone,onChange:r=>{var o;return ge({...S,phone:(o=r==null?void 0:r.target)==null?void 0:o.value})}}),e.jsx(H,{label:"Email",type:"email",value:S==null?void 0:S.email,onChange:r=>{var o;return ge({...S,email:(o=r==null?void 0:r.target)==null?void 0:o.value})}}),e.jsx(H,{label:"Specialty",value:S==null?void 0:S.specialty,onChange:r=>{var o;return ge({...S,specialty:(o=r==null?void 0:r.target)==null?void 0:o.value})}}),e.jsx(H,{label:"Rating (1-5)",type:"number",min:"1",max:"5",step:"0.1",value:S==null?void 0:S.rating,onChange:r=>{var o;return ge({...S,rating:(o=r==null?void 0:r.target)==null?void 0:o.value})}}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Organization"}),e.jsxs("select",{value:(S==null?void 0:S.org_id)||"",onChange:r=>{var o;return ge({...S,org_id:((o=r==null?void 0:r.target)==null?void 0:o.value)||null})},className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"",children:"Unassigned"}),(Rt||[]).map(r=>e.jsx("option",{value:r==null?void 0:r.id,children:r==null?void 0:r.name},r==null?void 0:r.id))]})]})]}),le==="product"&&e.jsxs(e.Fragment,{children:[e.jsx(H,{label:"Product Name",value:x==null?void 0:x.name,onChange:r=>{var o;return oe({...x,name:(o=r==null?void 0:r.target)==null?void 0:o.value})},required:!0}),e.jsx(H,{label:"Brand",value:x==null?void 0:x.brand,onChange:r=>{var o;return oe({...x,brand:(o=r==null?void 0:r.target)==null?void 0:o.value})}}),e.jsx(H,{label:"Category",value:x==null?void 0:x.category,onChange:r=>{var o;return oe({...x,category:(o=r==null?void 0:r.target)==null?void 0:o.value})}}),e.jsx(H,{label:"Op Code",value:x==null?void 0:x.op_code,onChange:r=>{var o;return oe({...x,op_code:(o=r==null?void 0:r.target)==null?void 0:o.value})},placeholder:"e.g., EN3, EN5"}),e.jsx(H,{label:"Cost",type:"number",step:"0.01",value:x==null?void 0:x.cost,onChange:r=>{var o;return oe({...x,cost:(o=r==null?void 0:r.target)==null?void 0:o.value})},required:!0}),e.jsx(H,{label:"Unit Price",type:"number",step:"0.01",value:x==null?void 0:x.unit_price,onChange:r=>{var o;return oe({...x,unit_price:(o=r==null?void 0:r.target)==null?void 0:o.value})},required:!0}),e.jsx(H,{label:"Part Number",value:x==null?void 0:x.part_number,onChange:r=>{var o;return oe({...x,part_number:(o=r==null?void 0:r.target)==null?void 0:o.value})}}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:x==null?void 0:x.description,onChange:r=>{var o;return oe({...x,description:(o=r==null?void 0:r.target)==null?void 0:o.value})},className:"w-full px-3 py-2 border border-gray-300 rounded-md",rows:"3"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Organization"}),e.jsxs("select",{value:(x==null?void 0:x.org_id)||"",onChange:r=>{var o;return oe({...x,org_id:((o=r==null?void 0:r.target)==null?void 0:o.value)||null})},className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"",children:"Unassigned"}),(Rt||[]).map(r=>e.jsx("option",{value:r==null?void 0:r.id,children:r==null?void 0:r.name},r==null?void 0:r.id))]})]})]}),le==="template"&&e.jsxs(e.Fragment,{children:[e.jsx(H,{label:"Template Name",value:Q==null?void 0:Q.name,onChange:r=>{var o;return Ye({...Q,name:(o=r==null?void 0:r.target)==null?void 0:o.value})},required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Template Type"}),e.jsx("select",{value:Q==null?void 0:Q.template_type,onChange:r=>{var o;return Ye({...Q,template_type:(o=r==null?void 0:r.target)==null?void 0:o.value})},className:"w-full px-3 py-2 border border-gray-300 rounded-md",required:!0,children:dt==null?void 0:dt.map(r=>e.jsx("option",{value:r==null?void 0:r.value,children:r==null?void 0:r.label},r==null?void 0:r.value))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Message Template (",((g=Q==null?void 0:Q.message_template)==null?void 0:g.length)||0,"/160)"]}),e.jsx("textarea",{value:Q==null?void 0:Q.message_template,onChange:r=>{var o;return Ye({...Q,message_template:(o=r==null?void 0:r.target)==null?void 0:o.value})},className:"w-full px-3 py-2 border border-gray-300 rounded-md",rows:"4",maxLength:"160",placeholder:"Use {{stock_number}}, {{vehicle_info}}, {{status}} as variables",required:!0})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(J,{type:"button",onClick:()=>Je(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200",children:"Cancel"}),e.jsx(J,{type:"submit",disabled:he,className:"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",children:he?"Saving...":A?"Update":"Create"})]})]})]})})};return d?e.jsx(ht,{children:e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading admin panel..."})]})})}):p?e.jsx(ht,{children:e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"max-w-md w-full bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(or,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Admin Panel Error"}),e.jsx("p",{className:"text-gray-600 mb-6",children:p}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(J,{onClick:()=>{var t;return(t=window.location)==null?void 0:t.reload()},className:"w-full bg-blue-600 hover:bg-blue-700 text-white flex items-center justify-center gap-2",children:[e.jsx(Zr,{className:"w-4 h-4"}),"Refresh Page"]}),e.jsx(J,{onClick:Er,className:"w-full bg-gray-600 hover:bg-gray-700 text-white",children:"Debug Connection"}),e.jsx(J,{onClick:()=>window.location.href="/authentication-portal",className:"w-full bg-green-600 hover:bg-green-700 text-white",children:"Go to Login"})]}),(O==null?void 0:O.showDebug)&&e.jsxs("div",{className:"mt-6 p-4 bg-gray-100 rounded-lg text-left text-sm",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Debug Information:"}),e.jsxs("div",{className:"space-y-1 font-mono text-xs",children:[e.jsxs("div",{children:["Auth User: ",((It=O==null?void 0:O.authUser)==null?void 0:It.email)||"None"]}),e.jsxs("div",{children:["User ID: ",((zt=O==null?void 0:O.authUser)==null?void 0:zt.id)||"None"]}),e.jsxs("div",{children:["Profile Found: ",O!=null&&O.userProfile?"Yes":"No"]}),e.jsxs("div",{children:["User Role: ",(($t=O==null?void 0:O.userProfile)==null?void 0:$t.role)||"None"]}),e.jsxs("div",{children:["Department: ",((qt=O==null?void 0:O.userProfile)==null?void 0:qt.department)||"None"]}),(O==null?void 0:O.profileLoadError)&&e.jsxs("div",{className:"text-red-600 mt-2",children:["Error: ",(Ot=O==null?void 0:O.profileLoadError)==null?void 0:Ot.message]})]})]})]})})})}):e.jsx(ht,{children:e.jsxs("div",{className:"min-h-screen bg-gray-50 pt-20",children:[e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Admin Panel"}),e.jsx("p",{className:"text-gray-600",children:"Complete administrative management for Priority Automotive Tracker"}),e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-semibold text-blue-900 mb-2",children:"System Status"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Auth Status:"}),e.jsx("span",{className:`ml-1 ${n?"text-green-600":"text-orange-600"}`,children:n?"Authenticated":"Demo Mode"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"User Role:"}),e.jsx("span",{className:"ml-1 text-blue-600",children:(a==null?void 0:a.role)||"Admin"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Access Level:"}),e.jsx("span",{className:"ml-1 text-green-600",children:"Full Access"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Database:"}),e.jsx("span",{className:"ml-1 text-green-600",children:"Connected"})]})]})]})]}),e.jsxs("div",{className:"mb-8 p-4 bg-white border border-gray-200 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Current Data Status"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"User Accounts:"}),e.jsxs("span",{className:`ml-1 ${(te==null?void 0:te.length)>0?"text-green-600":"text-red-600"}`,children:[(te==null?void 0:te.length)||0," found"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Staff Records:"}),e.jsxs("span",{className:`ml-1 ${(re==null?void 0:re.length)>0?"text-green-600":"text-red-600"}`,children:[(re==null?void 0:re.length)||0," found"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Vendors:"}),e.jsxs("span",{className:`ml-1 ${(X==null?void 0:X.length)>0?"text-green-600":"text-red-600"}`,children:[(X==null?void 0:X.length)||0," found"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Products:"}),e.jsxs("span",{className:`ml-1 ${(F==null?void 0:F.length)>0?"text-green-600":"text-red-600"}`,children:[(F==null?void 0:F.length)||0," found"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"SMS Templates:"}),e.jsxs("span",{className:`ml-1 ${(W==null?void 0:W.length)>0?"text-green-600":"text-red-600"}`,children:[(W==null?void 0:W.length)||0," found"]})]})]})]}),e.jsx("div",{className:"mb-8",children:e.jsx("nav",{className:"flex space-x-8 border-b border-gray-200",children:ot==null?void 0:ot.map(t=>{const g=t==null?void 0:t.icon;let r=0;return(t==null?void 0:t.id)==="userAccounts"&&(r=(te==null?void 0:te.length)||0),(t==null?void 0:t.id)==="staffRecords"&&(r=(re==null?void 0:re.length)||0),(t==null?void 0:t.id)==="vendors"&&(r=(X==null?void 0:X.length)||0),(t==null?void 0:t.id)==="products"&&(r=(F==null?void 0:F.length)||0),(t==null?void 0:t.id)==="smsTemplates"&&(r=(W==null?void 0:W.length)||0),(t==null?void 0:t.id)==="qrCodes"&&(r=null),e.jsxs("button",{onClick:()=>y(t==null?void 0:t.id),className:`flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm ${u===(t==null?void 0:t.id)?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(g,{className:"w-5 h-5"}),t==null?void 0:t.label,r!==null&&e.jsx("span",{className:`ml-1 px-2 py-1 text-xs rounded-full ${r>0?"bg-green-100 text-green-800":"bg-gray-100 text-gray-500"}`,children:r})]},t==null?void 0:t.id)})})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[u==="userAccounts"&&zr(),u==="staffRecords"&&$r(),u==="vendors"&&qr(),u==="products"&&Or(),u==="smsTemplates"&&Qr(),u==="qrCodes"&&Vr()]})]}),Gr()]})})};export{en as default};
//# sourceMappingURL=index-CND-TRwr.js.map
