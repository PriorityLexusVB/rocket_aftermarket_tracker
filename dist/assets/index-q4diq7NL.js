import{s as I,q as z,r as B,T as ie,V as Qe,G as ue,j as e,z as Ye,C as ze,n as re,W as Ue,X as Me,Y as Pe,Z as Ve,_ as Te,o as ne,v as he,U as Oe,$ as Ge,a0 as Ee,a1 as Fe,P as Xe,a2 as ge,F as Ze,a3 as Be,a4 as De,a5 as be,N as je}from"./index-j8ibuT4f.js";import{r as V}from"./react-Czq5O75u.js";import{A as es}from"./AppLayout-BjnxLKqL.js";import{s as oe,t as Ae}from"./options-CllavUpK.js";import"./supabase-D02rA7zj.js";import"./router-CZES1Sa0.js";import"./Navbar-BMSR9LgI.js";const Q={async getJobsByDateRange(s,t,i={}){var h;try{const{data:g,error:c}=await((h=I)==null?void 0:h.rpc("get_jobs_by_date_range",{start_date:s==null?void 0:s.toISOString(),end_date:t==null?void 0:t.toISOString(),vendor_filter:(i==null?void 0:i.vendorId)||null,status_filter:(i==null?void 0:i.status)||null}));if(c)throw c;return{data:g||[],error:null}}catch(g){return console.error("[calendar] getJobsByDateRange failed:",g),{data:[],error:g}}},async checkSchedulingConflict(s,t,i,h=null){var g;try{const{data:c,error:a}=await((g=I)==null?void 0:g.rpc("check_vendor_schedule_conflict",{vendor_uuid:s,start_time:t==null?void 0:t.toISOString(),end_time:i==null?void 0:i.toISOString(),exclude_job_id:h}));if(a)throw a;return{hasConflict:c||!1,error:null}}catch(c){return console.error("[calendar] checkSchedulingConflict failed:",c),{hasConflict:!1,error:c}}},async updateJobSchedule(s,t,i=null){var h,g,c,a,y,k,T,M,F;try{const f={scheduled_start_time:(h=t==null?void 0:t.startTime)==null?void 0:h.toISOString(),scheduled_end_time:(g=t==null?void 0:t.endTime)==null?void 0:g.toISOString(),vendor_id:t==null?void 0:t.vendorId,location:t==null?void 0:t.location,color_code:t==null?void 0:t.colorCode,calendar_notes:t==null?void 0:t.notes,job_status:(t==null?void 0:t.status)??(t!=null&&t.startTime?"scheduled":void 0),updated_at:(c=new Date)==null?void 0:c.toISOString()};(a=Object.keys(f))==null||a.forEach(q=>{(f==null?void 0:f[q])===void 0&&(f==null||delete f[q])});let E=(F=(M=(T=(k=(y=I)==null?void 0:y.from("jobs"))==null?void 0:k.update(f))==null?void 0:T.eq("id",s))==null?void 0:M.select(`
          *,
          vendor:vendors(id, name, specialty),
          vehicle:vehicles(id, make, model, year, owner_name, stock_number)
        `))==null?void 0:F.single();return i&&(E=E==null?void 0:E.eq("org_id",i)),{data:await oe(E,"calendar:updateJobSchedule"),error:null}}catch(f){return console.error("[calendar] updateJobSchedule failed:",f),{data:null,error:f}}},async createScheduledJob(s,t=null){var i,h,g,c,a,y,k,T;try{const{data:M,error:F}=await((i=I)==null?void 0:i.rpc("generate_job_number"));if(F)throw F;const f={job_number:M,title:s==null?void 0:s.title,description:(s==null?void 0:s.description)||"",vehicle_id:s==null?void 0:s.vehicleId,vendor_id:s==null?void 0:s.vendorId,scheduled_start_time:(h=s==null?void 0:s.startTime)==null?void 0:h.toISOString(),scheduled_end_time:(g=s==null?void 0:s.endTime)==null?void 0:g.toISOString(),estimated_hours:(s==null?void 0:s.estimatedHours)||2,location:(s==null?void 0:s.location)||"",priority:(s==null?void 0:s.priority)||"medium",job_status:"scheduled",color_code:(s==null?void 0:s.colorCode)||"#3b82f6",calendar_notes:(s==null?void 0:s.notes)||"",created_by:s==null?void 0:s.createdBy,org_id:t??(s==null?void 0:s.org_id)??null},{data:E}=await((T=(k=(y=(a=(c=I)==null?void 0:c.from("jobs"))==null?void 0:a.insert([f]))==null?void 0:y.select(`
          *,
          vendor:vendors(id, name, specialty),
          vehicle:vehicles(id, make, model, year, owner_name, stock_number)
        `))==null?void 0:k.single())==null?void 0:T.throwOnError());return{data:E,error:null}}catch(M){return console.error("[calendar] createScheduledJob failed:",M),{data:null,error:M}}},async getOverdueJobs(){var s;try{const{data:t,error:i}=await((s=I)==null?void 0:s.rpc("get_overdue_jobs"));if(i)throw i;return{data:t||[],error:null}}catch(t){return console.error("[calendar] getOverdueJobs failed:",t),{data:[],error:t}}},async getCalendarStats(s="today",t=null){var i,h,g,c,a,y,k,T,M,F;try{const f=new Date;let E,$;switch(s){case"today":E=new Date(f.getFullYear(),f.getMonth(),f.getDate()),$=new Date(E),$==null||$.setDate(($==null?void 0:$.getDate())+1);break;case"week":E=new Date(f),E==null||E.setDate((f==null?void 0:f.getDate())-(f==null?void 0:f.getDay())),E==null||E.setHours(0,0,0,0),$=new Date(E),$==null||$.setDate(($==null?void 0:$.getDate())+7);break;case"month":E=new Date(f.getFullYear(),f.getMonth(),1),$=new Date(f.getFullYear(),f.getMonth()+1,1);break;default:E=new Date(f.getFullYear(),f.getMonth(),f.getDate()),$=new Date(E),$==null||$.setDate(($==null?void 0:$.getDate())+1)}let q=(g=(h=(i=I)==null?void 0:i.from("jobs"))==null?void 0:h.select("*",{count:"exact",head:!0}))==null?void 0:g.neq("job_status","cancelled");t&&(q=q==null?void 0:q.eq("org_id",t));const{count:Y,error:H}=await q;if(H)throw H;let o=(k=(y=(a=(c=I)==null?void 0:c.from("jobs"))==null?void 0:a.select("*",{count:"exact",head:!0}))==null?void 0:y.gte("scheduled_start_time",E==null?void 0:E.toISOString()))==null?void 0:k.lt("scheduled_start_time",$==null?void 0:$.toISOString());t&&(o=o==null?void 0:o.eq("org_id",t));const{count:n,error:l}=await o;if(l)throw l;const{data:x}=await this.getOverdueJobs();let _=(F=(M=(T=I)==null?void 0:T.from("vendors"))==null?void 0:M.select("*",{count:"exact",head:!0}))==null?void 0:F.eq("is_active",!0);t&&(_=_==null?void 0:_.eq("org_id",t));const{count:U,error:p}=await _;if(p)throw p;return{data:{totalJobs:Y||0,scheduledJobs:n||0,overdueJobs:(x==null?void 0:x.length)||0,activeVendors:U||0},error:null}}catch(f){return console.error("[calendar] getCalendarStats failed:",f),{data:{totalJobs:0,scheduledJobs:0,overdueJobs:0,activeVendors:0},error:f}}},async getVendorAvailability(s,t,i){try{const{data:h}=await this.getJobsByDateRange(t,i,{vendorId:s}),g=h,c=Array.isArray(g)?g.some(a=>{if(!(a!=null&&a.scheduled_start_time)||!(a!=null&&a.scheduled_end_time))return!1;const y=new Date(a.scheduled_start_time).getTime(),k=new Date(a.scheduled_end_time).getTime();return y<i.getTime()&&k>t.getTime()}):!1;return{available:!c,conflictingJobs:c?g:[],error:null}}catch(h){return console.error("[calendar] getVendorAvailability failed:",h),{available:!1,conflictingJobs:[],error:h}}}},xe={async getAll(s=null){try{let t=I.from("vendors").select("*").eq("is_active",!0).order("name",{ascending:!0});s&&(t=t.or(`org_id.eq.${s},org_id.is.null`));const i=await oe(t,"vendors:getAll");return Ae(i,{labelKey:"name",valueKey:"id"})}catch(t){return console.error("vendorService.getAll failed",t),[]}},async search(s,t=null){try{if(!(s!=null&&s.trim()))return this.getAll(t);let i=I.from("vendors").select("*").or(`name.ilike.%${s}%,specialty.ilike.%${s}%,contact_person.ilike.%${s}%`).eq("is_active",!0).order("name",{ascending:!0}).limit(50);t&&(i=i.or(`org_id.eq.${t},org_id.is.null`));const h=await oe(i,"vendors:search");return Ae(h,{labelKey:"name",valueKey:"id"})}catch(i){return console.error("vendorService.search failed",i),[]}},async getById(s,t=null){if(!s)return null;try{let i=I.from("vendors").select("*, vendor_hours:vendor_hours(*), products:products(count)").eq("id",s).single();return t&&(i=i.eq("org_id",t)),(await i.throwOnError()).data}catch(i){return console.error("vendorService.getById failed",i),null}}},ss=({filters:s,onFiltersChange:t,jobCounts:i})=>{const h=[{id:"today",label:"Today",icon:z,count:(i==null?void 0:i.today)||0,color:"bg-blue-50 text-blue-700 border-blue-200",activeColor:"bg-blue-600 text-white border-blue-600"},{id:"in_progress",label:"In-Progress",icon:B,count:(i==null?void 0:i.inProgress)||0,color:"bg-yellow-50 text-yellow-700 border-yellow-200",activeColor:"bg-yellow-600 text-white border-yellow-600"},{id:"overdue",label:"Overdue",icon:ie,count:(i==null?void 0:i.overdue)||0,color:"bg-red-50 text-red-700 border-red-200",activeColor:"bg-red-600 text-white border-red-600"},{id:"no_show",label:"No-Show",icon:Qe,count:(i==null?void 0:i.noShow)||0,color:"bg-gray-50 text-gray-700 border-gray-200",activeColor:"bg-gray-600 text-white border-gray-600"},{id:"completed",label:"Completed",icon:ue,count:(i==null?void 0:i.completed)||0,color:"bg-green-50 text-green-700 border-green-200",activeColor:"bg-green-600 text-white border-green-600"}],g=a=>{var y;return(y=s==null?void 0:s.statuses)==null?void 0:y.includes(a)},c=a=>{const y=(s==null?void 0:s.statuses)||[],k=y!=null&&y.includes(a)?y==null?void 0:y.filter(T=>T!==a):[...y,a];t==null||t({...s,statuses:k})};return e.jsx("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600 mr-4",children:[e.jsx(Ye,{className:"h-4 w-4 mr-2"}),"Quick Filters:"]}),h==null?void 0:h.map(a=>{const y=a==null?void 0:a.icon,k=g(a==null?void 0:a.id);return e.jsxs("button",{onClick:()=>c(a==null?void 0:a.id),className:`
                  flex items-center px-3 py-2 rounded-lg border text-sm font-medium transition-all duration-200
                  ${k?a==null?void 0:a.activeColor:a==null?void 0:a.color}
                  hover:shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500
                `,children:[e.jsx("div",{className:`
                  flex items-center justify-center w-4 h-4 mr-2 rounded border-2 transition-all duration-200
                  ${k?"bg-white border-white":"bg-transparent border-gray-400 border-opacity-60"}
                `,children:e.jsx(ze,{className:`h-3 w-3 transition-all duration-200 ${k?"text-gray-700 opacity-100":"text-transparent opacity-0"}`})}),e.jsx(y,{className:"h-4 w-4 mr-2"}),a==null?void 0:a.label,(a==null?void 0:a.count)>0&&e.jsx("span",{className:`
                    ml-2 px-2 py-0.5 rounded-full text-xs font-semibold
                    ${k?"bg-white bg-opacity-20":"bg-gray-100 text-gray-800"}
                  `,children:a==null?void 0:a.count})]},a==null?void 0:a.id)})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Show:"}),e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:(s==null?void 0:s.showUnassigned)||!1,onChange:a=>{var y;return t==null?void 0:t({...s,showUnassigned:(y=a==null?void 0:a.target)==null?void 0:y.checked})},className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 focus:ring-2 h-4 w-4"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Unassigned Jobs"})]})]})]})})},qe=s=>{if(!s)return null;if(s instanceof Date)return isNaN(s==null?void 0:s.getTime())?null:s;if(typeof s=="string"){if((s==null?void 0:s.trim())==="")return null;try{const t=new Date(s);return isNaN(t==null?void 0:t.getTime())?null:t}catch(t){return console.warn("Date parsing error:",s,t),null}}if(typeof s=="number")try{const t=new Date(s);return isNaN(t==null?void 0:t.getTime())?null:t}catch(t){return console.warn("Date creation from number error:",s,t),null}return null},G=s=>{if(!s)return"";const t=qe(s);if(!t)return console.warn("formatTime: Invalid date input:",s),"Invalid Time";try{return t==null?void 0:t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}catch(i){return console.error("formatTime error:",i),"Invalid Time"}},se=s=>{if(!s)return!1;const t=qe(s);if(!t)return!1;const i=new Date;try{return t<i}catch(h){return console.error("isOverdue comparison error:",h),!1}},Z=s=>{const t={pending:{label:"PENDING",bg:"bg-gray-100",textColor:"text-gray-800",color:"bg-gray-500"},scheduled:{label:"BOOKED",bg:"bg-blue-100",textColor:"text-blue-800",color:"bg-blue-500"},in_progress:{label:"IP",bg:"bg-yellow-100",textColor:"text-yellow-800",color:"bg-yellow-500"},quality_check:{label:"W/P",bg:"bg-purple-100",textColor:"text-purple-800",color:"bg-purple-500"},completed:{label:"DONE",bg:"bg-green-100",textColor:"text-green-800",color:"bg-green-500"},delivered:{label:"DONE",bg:"bg-teal-100",textColor:"text-teal-800",color:"bg-teal-500"},cancelled:{label:"CANCELED",bg:"bg-red-100",textColor:"text-red-800",color:"bg-red-500"},no_show:{label:"NS",bg:"bg-gray-100",textColor:"text-gray-800",color:"bg-gray-400"}};return(t==null?void 0:t[s])||(t==null?void 0:t.pending)},rs=({jobs:s,onJobClick:t,onDragStart:i,loading:h})=>{const g=c=>{var k,T,M,F;const a=se(c==null?void 0:c.promised_date),y=Z(c==null?void 0:c.job_status);return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4 mb-3 cursor-pointer hover:shadow-md transition-all duration-200 hover:border-blue-300",onClick:()=>t==null?void 0:t(c),draggable:!0,onDragStart:()=>i==null?void 0:i(c),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(re,{className:"h-4 w-4 text-gray-600 mr-2"}),e.jsx("span",{className:"font-medium text-gray-900",children:(T=(k=c==null?void 0:c.job_number)==null?void 0:k.split("-"))==null?void 0:T.pop()}),a&&e.jsx(ie,{className:"h-4 w-4 text-red-500 ml-2"})]}),e.jsx("div",{className:`
            px-2 py-1 rounded-full text-xs font-medium
            ${(y==null?void 0:y.bg)||"bg-gray-100"} 
            ${(y==null?void 0:y.textColor)||"text-gray-800"}
          `,children:(y==null?void 0:y.label)||((M=c==null?void 0:c.job_status)==null?void 0:M.toUpperCase())})]}),e.jsxs("div",{className:"text-sm font-medium text-gray-800 mb-2 flex items-center",children:[e.jsx(Ue,{className:"h-3 w-3 text-gray-500 mr-1"}),c==null?void 0:c.title]}),e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:c==null?void 0:c.vehicle_info}),e.jsxs("div",{className:"space-y-1",children:[(c==null?void 0:c.scheduled_start_time)&&e.jsxs("div",{className:"flex items-center text-xs text-gray-600",children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),G(c==null?void 0:c.scheduled_start_time),"–",G(c==null?void 0:c.scheduled_end_time)]}),e.jsxs("div",{className:`flex items-center text-xs ${a?"text-red-600":"text-gray-600"}`,children:[e.jsx(z,{className:"h-3 w-3 mr-1"}),"Promise: ",(F=new Date(c==null?void 0:c.promised_date))==null?void 0:F.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),a&&e.jsx("span",{className:"ml-2 px-1.5 py-0.5 bg-red-100 text-red-700 rounded text-xs font-medium",children:"Overdue"})]}),(c==null?void 0:c.estimated_hours)&&e.jsxs("div",{className:"flex items-center text-xs text-gray-600",children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),c==null?void 0:c.estimated_hours,"h estimated"]})]}),e.jsx("div",{className:"mt-3 pt-2 border-t border-gray-100",children:e.jsx("div",{className:"text-xs text-gray-500 text-center",children:"Drag to assign vendor or time slot"})})]},c==null?void 0:c.id)};return e.jsxs("div",{className:"w-80 bg-gray-50 border-r border-gray-200 flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 bg-white border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-medium text-gray-900",children:"Unassigned Queue"}),e.jsx("div",{className:"bg-gray-100 text-gray-700 text-xs px-2 py-1 rounded-full font-medium",children:(s==null?void 0:s.length)||0})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Drag jobs onto calendar to schedule"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:h?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-indigo-600"})}):(s==null?void 0:s.length)>0?e.jsx("div",{className:"space-y-3",children:s==null?void 0:s.map(g)}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(re,{className:"h-8 w-8 text-gray-400 mx-auto mb-3"}),e.jsx("div",{className:"text-sm text-gray-600",children:"No unassigned jobs"}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"All jobs are scheduled"})]})}),e.jsx("div",{className:"p-4 bg-white border-t border-gray-200",children:e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),"Drop on calendar for On-Site"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full mr-2"}),"Drop on vendor lane for Off-Site"]})]})})]})},ts=({job:s,isOpen:t,onClose:i,onStatusUpdate:h})=>{var Y,H;const[g,c]=V.useState("details"),[a,y]=V.useState("");if(!t||!s)return null;const k=Z(s==null?void 0:s.job_status),T=se(s==null?void 0:s.promised_date),M=[{id:"start",label:"Start",icon:Pe,color:"bg-green-600 hover:bg-green-700 text-white",action:()=>h==null?void 0:h(s==null?void 0:s.id,"in_progress")},{id:"complete",label:"Complete",icon:ue,color:"bg-blue-600 hover:bg-blue-700 text-white",action:()=>h==null?void 0:h(s==null?void 0:s.id,"completed")},{id:"no_show",label:"No-Show",icon:Ve,color:"bg-gray-600 hover:bg-gray-700 text-white",action:()=>h==null?void 0:h(s==null?void 0:s.id,"no_show")},{id:"reschedule",label:"Reschedule",icon:Te,color:"bg-orange-600 hover:bg-orange-700 text-white",action:()=>{console.log("Open reschedule modal")}}],F=[{id:"details",label:"Details",icon:Ue},{id:"customer",label:"Customer",icon:Oe},{id:"timeline",label:"Timeline/Notes",icon:Ge},{id:"photos",label:"Photos",icon:Ee}],f=()=>{var o,n,l;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Job Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Job Number"}),e.jsxs("div",{className:"mt-1 flex items-center",children:[e.jsx("span",{className:"text-sm font-mono",children:s==null?void 0:s.job_number}),e.jsx("button",{className:"ml-2 p-1 hover:bg-gray-100 rounded",children:e.jsx(Fe,{className:"h-3 w-3 text-gray-400"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Priority"}),e.jsx("div",{className:"mt-1",children:e.jsx("span",{className:`
                inline-flex px-2 py-1 text-xs font-medium rounded-full
                ${(s==null?void 0:s.priority)==="high"?"bg-red-100 text-red-800":(s==null?void 0:s.priority)==="medium"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}
              `,children:(o=s==null?void 0:s.priority)==null?void 0:o.toUpperCase()})})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Service Details"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Service Type"}),e.jsx("div",{className:"mt-1 text-sm text-gray-900",children:s==null?void 0:s.title})]}),(s==null?void 0:s.description)&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Description"}),e.jsx("div",{className:"mt-1 text-sm text-gray-900",children:s==null?void 0:s.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Estimated Hours"}),e.jsx("div",{className:"mt-1 text-sm text-gray-900",children:(s==null?void 0:s.estimated_hours)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Estimated Cost"}),e.jsxs("div",{className:"mt-1 text-sm text-gray-900",children:["$",s!=null&&s.estimated_cost?(n=Number(s==null?void 0:s.estimated_cost))==null?void 0:n.toFixed(2):"N/A"]})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Location & Scheduling"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[e.jsx("div",{className:"flex items-center",children:s!=null&&s.vendor_id?e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"h-4 w-4 text-orange-500 mr-2"}),e.jsxs("span",{className:"text-sm",children:["Off-Site @ ",s==null?void 0:s.vendor_name]})]}):e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"h-4 w-4 text-green-500 mr-2"}),e.jsx("span",{className:"text-sm",children:"On-Site"})]})}),(s==null?void 0:s.scheduled_start_time)&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(B,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsxs("span",{className:"text-sm",children:[G(s==null?void 0:s.scheduled_start_time)," - ",G(s==null?void 0:s.scheduled_end_time)]})]}),e.jsxs("div",{className:`flex items-center ${T?"text-red-600":""}`,children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),e.jsxs("span",{className:"text-sm",children:["Promise Date: ",(l=new Date(s==null?void 0:s.promised_date))==null?void 0:l.toLocaleDateString()]}),T&&e.jsx(ie,{className:"h-4 w-4 ml-2 text-red-500"})]})]})]})]})},E=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Vehicle Information"}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(re,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-sm font-medium",children:s==null?void 0:s.vehicle_info})]})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Customer Contact"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Oe,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-sm",children:"Customer Name"})]}),e.jsx("span",{className:"text-sm text-gray-600",children:"Available in vehicle record"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Xe,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-sm",children:"Phone"})]}),e.jsx("span",{className:"text-sm text-gray-600",children:"Available in vehicle record"})]})]})]})]}),$=()=>{var o,n;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Recent Updates"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"border-l-4 border-blue-400 pl-4 py-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:"Job Created"}),e.jsx("div",{className:"text-xs text-gray-500",children:(o=new Date(s==null?void 0:s.created_at))==null?void 0:o.toLocaleString()})]}),(s==null?void 0:s.updated_at)&&(s==null?void 0:s.updated_at)!==(s==null?void 0:s.created_at)&&e.jsxs("div",{className:"border-l-4 border-yellow-400 pl-4 py-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:"Last Updated"}),e.jsx("div",{className:"text-xs text-gray-500",children:(n=new Date(s==null?void 0:s.updated_at))==null?void 0:n.toLocaleString()})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Add Note"}),e.jsx("textarea",{value:a,onChange:l=>{var x;return y((x=l==null?void 0:l.target)==null?void 0:x.value)},placeholder:"Add a note about this job...",className:"w-full h-24 border border-gray-300 rounded-lg p-3 text-sm"}),e.jsx("button",{className:"mt-2 px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700",children:"Add Note"})]})]})},q=()=>e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Ee,{className:"h-8 w-8 mx-auto mb-3 text-gray-400"}),e.jsx("div",{className:"text-sm",children:"No photos uploaded yet"}),e.jsx("button",{className:"mt-3 px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700",children:"Upload Photos"})]})});return e.jsxs("div",{className:"fixed inset-0 z-50 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50",onClick:i}),e.jsx("div",{className:"absolute right-0 top-0 h-full w-full max-w-2xl bg-white shadow-xl",children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-3 h-3 rounded-full mr-3 ${s!=null&&s.vendor_id?"bg-orange-500":"bg-green-500"}`}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:s==null?void 0:s.job_number}),e.jsxs("div",{className:"text-sm text-gray-600 flex items-center mt-1",children:[s==null?void 0:s.vehicle_info,e.jsx("span",{className:`
                      ml-3 px-2 py-1 rounded-full text-xs font-medium
                      ${(k==null?void 0:k.bg)||"bg-gray-100"} 
                      ${(k==null?void 0:k.textColor)||"text-gray-800"}
                    `,children:(k==null?void 0:k.label)||((Y=s==null?void 0:s.job_status)==null?void 0:Y.toUpperCase())})]})]})]}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx(Me,{className:"h-5 w-5 text-gray-400"})})]}),e.jsx("div",{className:"flex items-center space-x-2 mt-4",children:M==null?void 0:M.map(o=>{const n=o==null?void 0:o.icon;return e.jsxs("button",{onClick:o==null?void 0:o.action,className:`
                      flex items-center px-3 py-2 rounded-lg text-sm font-medium
                      ${o==null?void 0:o.color} transition-colors duration-200
                    `,children:[e.jsx(n,{className:"h-4 w-4 mr-2"}),o==null?void 0:o.label]},o==null?void 0:o.id)})})]}),e.jsx("div",{className:"px-6 py-3 bg-gray-50 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center text-sm text-gray-600 space-x-4",children:[e.jsx("div",{className:"flex items-center",children:s!=null&&s.vendor_id?e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"h-4 w-4 mr-1"}),s==null?void 0:s.vendor_name]}):e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"h-4 w-4 mr-1"}),"On-Site"]})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(z,{className:"h-4 w-4 mr-1"}),"Promise: ",(H=new Date(s==null?void 0:s.promised_date))==null?void 0:H.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})]})]})}),e.jsx("div",{className:"px-6 py-0 bg-white border-b border-gray-200",children:e.jsx("div",{className:"flex space-x-8",children:F==null?void 0:F.map(o=>{const n=o==null?void 0:o.icon;return e.jsxs("button",{onClick:()=>c(o==null?void 0:o.id),className:`
                      flex items-center py-3 border-b-2 text-sm font-medium
                      ${g===(o==null?void 0:o.id)?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}
                    `,children:[e.jsx(n,{className:"h-4 w-4 mr-2"}),o==null?void 0:o.label]},o==null?void 0:o.id)})})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-6",children:[g==="details"&&f(),g==="customer"&&E(),g==="timeline"&&$(),g==="photos"&&q()]})]})})]})},ls=({isOpen:s,onClose:t,jobs:i,type:h,onTypeChange:g})=>{var H,o;const[c,a]=V.useState(new Set),y=n=>n==null?void 0:n.reduce((l,x)=>{var U;const _=(x==null?void 0:x.vendor_name)||"Unassigned";return l!=null&&l[_]||(l[_]=[]),(U=l==null?void 0:l[_])==null||U.push(x),l},{}),k=n=>{const l=new Date;l==null||l.setHours(0,0,0,0);const x=n==null?void 0:n.filter(_=>{const U=new Date(_==null?void 0:_.scheduled_start_time);return(U==null?void 0:U.toDateString())===(l==null?void 0:l.toDateString())});return{Today:{onSite:x==null?void 0:x.filter(_=>!(_!=null&&_.vendor_id)),vendors:y(x==null?void 0:x.filter(_=>_==null?void 0:_.vendor_id))}}},T=n=>{const l=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],x={};return l==null||l.forEach(_=>{const U=n==null?void 0:n.filter(p=>{const R=new Date(p==null?void 0:p.scheduled_start_time),w=R==null?void 0:R.getDay(),X=l==null?void 0:l.indexOf(_);return w===(X+1)%7});(U==null?void 0:U.length)>0&&(x[_]={onSite:U==null?void 0:U.filter(p=>!(p!=null&&p.vendor_id)),vendors:y(U==null?void 0:U.filter(p=>p==null?void 0:p.vendor_id))})}),x},M=n=>{const l={};return n==null||n.forEach(x=>{var R,w,X,J,D,ae,te;const _=new Date(x==null?void 0:x.scheduled_start_time),p=`Week ${Math.ceil((_==null?void 0:_.getDate())/7)}`;l!=null&&l[p]||(l[p]={onSite:[],vendors:{}}),x!=null&&x.vendor_id?((w=(R=l==null?void 0:l[p])==null?void 0:R.vendors)!=null&&w[x==null?void 0:x.vendor_name]||(l[p].vendors[x==null?void 0:x.vendor_name]=[]),(D=(J=(X=l==null?void 0:l[p])==null?void 0:X.vendors)==null?void 0:J[x==null?void 0:x.vendor_name])==null||D.push(x)):(te=(ae=l==null?void 0:l[p])==null?void 0:ae.onSite)==null||te.push(x)}),l},F=V.useMemo(()=>{if(!(i!=null&&i.length))return{};switch(h){case"daily":return k(i);case"weekly":return T(i);case"monthly":return M(i);default:return k(i)}},[i,h]),f=(n,l)=>{console.log(`${l} job ${n}`)},E=n=>{const l=new Set(c);l!=null&&l.has(n)?l==null||l.delete(n):l==null||l.add(n),a(l)},$=n=>{console.log(`Export ${n} for selected jobs:`,Array.from(c))},q=n=>{var x,_,U,p;const l=Z(n==null?void 0:n.job_status);return e.jsxs("div",{className:"flex items-center py-3 border-b border-gray-100 last:border-b-0",children:[e.jsx("input",{type:"checkbox",checked:c==null?void 0:c.has(n==null?void 0:n.id),onChange:()=>E(n==null?void 0:n.id),className:"mr-3 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsxs("div",{className:"flex-1 grid grid-cols-6 gap-4 items-center text-sm",children:[e.jsxs("div",{className:"flex items-center text-gray-900",children:[e.jsx(B,{className:"h-3 w-3 mr-1 text-gray-400"}),n!=null&&n.scheduled_start_time?`${G(n==null?void 0:n.scheduled_start_time)}–${G(n==null?void 0:n.scheduled_end_time)}`:"Unscheduled"]}),e.jsxs("div",{className:"flex items-center text-gray-900",children:[e.jsx(re,{className:"h-3 w-3 mr-1 text-gray-400"}),(_=(x=n==null?void 0:n.job_number)==null?void 0:x.split("-"))==null?void 0:_.pop()," | ",n==null?void 0:n.title]}),e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(z,{className:"h-3 w-3 mr-1 text-gray-400"}),(U=new Date(n==null?void 0:n.promised_date))==null?void 0:U.toLocaleDateString("en-US",{month:"short",day:"numeric"})]}),e.jsx("div",{className:"flex items-center text-gray-600",children:n!=null&&n.vendor_id?e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"h-3 w-3 mr-1 text-orange-500"}),n==null?void 0:n.vendor_name]}):e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"h-3 w-3 mr-1 text-green-500"}),"On-Site"]})}),e.jsx("div",{className:`
            inline-flex px-2 py-1 rounded-full text-xs font-medium
            ${(l==null?void 0:l.bg)||"bg-gray-100"} 
            ${(l==null?void 0:l.textColor)||"text-gray-800"}
          `,children:(l==null?void 0:l.label)||((p=n==null?void 0:n.job_status)==null?void 0:p.toUpperCase())}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("button",{onClick:()=>f(n==null?void 0:n.id,"start"),className:"p-1 hover:bg-green-100 rounded text-green-600",title:"Start",children:e.jsx(Pe,{className:"h-3 w-3"})}),e.jsx("button",{onClick:()=>f(n==null?void 0:n.id,"complete"),className:"p-1 hover:bg-blue-100 rounded text-blue-600",title:"Complete",children:e.jsx(ue,{className:"h-3 w-3"})}),e.jsx("button",{onClick:()=>f(n==null?void 0:n.id,"no_show"),className:"p-1 hover:bg-gray-100 rounded text-gray-600",title:"No-Show",children:e.jsx(Ve,{className:"h-3 w-3"})}),e.jsx("button",{onClick:()=>f(n==null?void 0:n.id,"reschedule"),className:"p-1 hover:bg-orange-100 rounded text-orange-600",title:"Reschedule",children:e.jsx(Te,{className:"h-3 w-3"})})]})]})]},n==null?void 0:n.id)},Y=(n,l)=>{var x,_,U,p;return e.jsxs("div",{className:"mb-8",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center",children:[e.jsx(z,{className:"h-5 w-5 mr-2 text-gray-600"}),n]}),((x=l==null?void 0:l.onSite)==null?void 0:x.length)>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full mr-2"}),e.jsx("h4",{className:"font-medium text-green-900",children:"On-Site (PLV)"}),e.jsxs("span",{className:"ml-2 text-sm text-gray-600",children:["(",(_=l==null?void 0:l.onSite)==null?void 0:_.length," jobs)"]})]}),e.jsx("div",{className:"bg-green-50 rounded-lg p-4",children:(U=l==null?void 0:l.onSite)==null?void 0:U.map(q)})]}),(p=Object.entries((l==null?void 0:l.vendors)||{}))==null?void 0:p.map(([R,w])=>e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("div",{className:"w-3 h-3 bg-orange-500 rounded-full mr-2"}),e.jsx("h4",{className:"font-medium text-orange-900",children:R}),e.jsxs("span",{className:"ml-2 text-sm text-gray-600",children:["(",w==null?void 0:w.length," jobs)"]})]}),e.jsx("div",{className:"bg-orange-50 rounded-lg p-4",children:w==null?void 0:w.map(q)})]},R))]},n)};return s?e.jsxs("div",{className:"fixed inset-0 z-50 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50",onClick:t}),e.jsx("div",{className:"absolute right-0 top-0 h-full w-full max-w-6xl bg-white shadow-xl",children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ge,{className:"h-5 w-5 text-gray-600 mr-3"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Round-Up View"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Export and manage scheduled jobs"})]})]}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx(Me,{className:"h-5 w-5 text-gray-400"})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>g==null?void 0:g("daily"),className:`px-3 py-1 rounded text-sm ${h==="daily"?"bg-white shadow-sm":""}`,children:"Daily"}),e.jsx("button",{onClick:()=>g==null?void 0:g("weekly"),className:`px-3 py-1 rounded text-sm ${h==="weekly"?"bg-white shadow-sm":""}`,children:"Weekly"}),e.jsx("button",{onClick:()=>g==null?void 0:g("monthly"),className:`px-3 py-1 rounded text-sm ${h==="monthly"?"bg-white shadow-sm":""}`,children:"Monthly"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[c==null?void 0:c.size," selected"]}),e.jsxs("button",{onClick:()=>$("copy"),className:"flex items-center px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50",children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Copy"]}),e.jsxs("button",{onClick:()=>$("csv"),className:"flex items-center px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50",children:[e.jsx(Ze,{className:"h-4 w-4 mr-2"}),"CSV"]}),e.jsxs("button",{onClick:()=>$("pdf"),className:"flex items-center px-3 py-2 bg-indigo-600 text-white text-sm rounded-lg hover:bg-indigo-700",children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"PDF"]})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-6",children:((H=Object.keys(F))==null?void 0:H.length)>0?(o=Object.entries(F))==null?void 0:o.map(([n,l])=>Y(n,l)):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(z,{className:"h-8 w-8 mx-auto mb-3 text-gray-400"}),e.jsx("div",{className:"text-lg",children:"No jobs scheduled"}),e.jsxs("div",{className:"text-sm",children:["for the selected ",h," period"]})]})})]})})]}):null},hs=()=>{var pe,we,_e,Se,ke;const[s,t]=V.useState(!0),[i,h]=V.useState([]),[g,c]=V.useState([]),[a,y]=V.useState([]),[k,T]=V.useState([]),[M,F]=V.useState([]),[f,E]=V.useState(null),[$,q]=V.useState(!1),[Y,H]=V.useState(!1),[o,n]=V.useState("daily"),[l,x]=V.useState("week"),[_,U]=V.useState(!0),[p,R]=V.useState(new Date),[w,X]=V.useState({vendors:[],statuses:[],showUnassigned:!0,searchQuery:""}),[J,D]=V.useState(null),[ae,te]=V.useState(null);V.useEffect(()=>{ce(),Ie()},[p,l]),V.useEffect(()=>{Re()},[w,i,g]);const ce=async()=>{var r,v;t(!0);try{const d=le(),C=ve(),{data:S,error:N}=await(Q==null?void 0:Q.getJobsByDateRange(d,C,{vendorId:((r=w==null?void 0:w.vendors)==null?void 0:r.length)>0?(v=w==null?void 0:w.vendors)==null?void 0:v[0]:null}));if(!N&&S){const u=S==null?void 0:S.filter(O=>O==null?void 0:O.vendor_id),A=S==null?void 0:S.filter(O=>!(O!=null&&O.vendor_id));h(u),c(A)}}catch(d){console.error("Error loading calendar data:",d)}finally{t(!1)}},Re=()=>{const r=Ne(i);y(r);const v=Ne(g);T(v)},Ne=r=>{var d,C,S;if(!r||(r==null?void 0:r.length)===0)return[];let v=[...r];if(w!=null&&w.searchQuery){const N=(d=w==null?void 0:w.searchQuery)==null?void 0:d.toLowerCase();v=v==null?void 0:v.filter(u=>{var A,O,m,L,W,K,b,j,ee,P;return((O=(A=u==null?void 0:u.job_number)==null?void 0:A.toLowerCase())==null?void 0:O.includes(N))||((L=(m=u==null?void 0:u.title)==null?void 0:m.toLowerCase())==null?void 0:L.includes(N))||((K=(W=u==null?void 0:u.vehicle_info)==null?void 0:W.toLowerCase())==null?void 0:K.includes(N))||((j=(b=u==null?void 0:u.customer_name)==null?void 0:b.toLowerCase())==null?void 0:j.includes(N))||((P=(ee=u==null?void 0:u.customer_phone)==null?void 0:ee.toLowerCase())==null?void 0:P.includes(N))})}return((C=w==null?void 0:w.statuses)==null?void 0:C.length)>0&&(v=v==null?void 0:v.filter(N=>{var A;const u={today:()=>{const O=new Date(N==null?void 0:N.scheduled_start_time),m=new Date;return(O==null?void 0:O.toDateString())===(m==null?void 0:m.toDateString())},in_progress:()=>(N==null?void 0:N.job_status)==="in_progress",overdue:()=>se(N==null?void 0:N.promised_date),no_show:()=>(N==null?void 0:N.job_status)==="no_show",completed:()=>(N==null?void 0:N.job_status)==="completed"};return(A=w==null?void 0:w.statuses)==null?void 0:A.some(O=>{var m;return(m=u==null?void 0:u[O])==null?void 0:m.call(u)})})),((S=w==null?void 0:w.vendors)==null?void 0:S.length)>0&&(v=v==null?void 0:v.filter(N=>{var u;return(u=w==null?void 0:w.vendors)==null?void 0:u.includes(N==null?void 0:N.vendor_id)})),v},Ie=async()=>{try{const{data:r}=await(xe==null?void 0:xe.getVendors({is_active:!0}));r&&F(r)}catch(r){console.error("Error loading vendors:",r)}},le=()=>{const r=new Date(p);switch(l){case"day":return r==null||r.setHours(0,0,0,0),r;case"week":const v=r==null?void 0:r.getDay();return r==null||r.setDate((r==null?void 0:r.getDate())-v+1),r==null||r.setHours(0,0,0,0),r;case"month":return r==null||r.setDate(1),r==null||r.setHours(0,0,0,0),r;default:return r==null||r.setHours(0,0,0,0),r}},ve=()=>{const r=le();switch(l){case"day":return r==null||r.setDate((r==null?void 0:r.getDate())+1),r;case"week":return r==null||r.setDate((r==null?void 0:r.getDate())+6),r;case"month":return r==null||r.setMonth((r==null?void 0:r.getMonth())+1),r==null||r.setDate(0),r;default:return r==null||r.setDate((r==null?void 0:r.getDate())+1),r}},de=r=>{E(r),q(!0)},He=async(r,v)=>{try{await(Q==null?void 0:Q.updateJobSchedule(r,{status:v})),ce()}catch(d){console.error("Error updating job status:",d)}},ye=r=>{D(r)},Je=()=>{D(null),te(null)},fe=async(r,v)=>{if(J)try{const d=new Date(v),C=new Date(d);C==null||C.setHours((d==null?void 0:d.getHours())+((J==null?void 0:J.estimated_hours)||2)),await(Q==null?void 0:Q.updateJobSchedule(J==null?void 0:J.id,{vendorId:r,startTime:d,endTime:C,location:r?"off_site":"on_site"})),ce()}catch(d){console.error("Error updating job assignment:",d)}},Le=()=>{var u;const r=le(),v=ve(),d=new Date(r),C=new Date(v);d==null||d.setDate((d==null?void 0:d.getDate())-(d==null?void 0:d.getDay())+1),C==null||C.setDate((C==null?void 0:C.getDate())+(6-(C==null?void 0:C.getDay()))+1);const S=[],N=new Date(d);for(;N<=C;){const A=[];for(let O=0;O<7;O++){const m=new Date(N);m==null||m.setDate((N==null?void 0:N.getDate())+O);const L=a==null?void 0:a.filter(W=>{const K=new Date(W==null?void 0:W.scheduled_start_time);return(K==null?void 0:K.toDateString())===(m==null?void 0:m.toDateString())});A==null||A.push({date:new Date(m),jobs:L,isCurrentMonth:(m==null?void 0:m.getMonth())===(r==null?void 0:r.getMonth()),isToday:(m==null?void 0:m.toDateString())===((u=new Date)==null?void 0:u.toDateString())})}S==null||S.push(A),N==null||N.setDate((N==null?void 0:N.getDate())+7)}return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"grid grid-cols-7 gap-2 mb-4 border-b border-gray-200 pb-2",children:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map(A=>e.jsx("div",{className:"text-center text-sm font-medium text-gray-500 py-2",children:A},A))}),e.jsx("div",{className:"flex-1 space-y-2",children:S==null?void 0:S.map((A,O)=>e.jsx("div",{className:"grid grid-cols-7 gap-2 h-32",children:A==null?void 0:A.map((m,L)=>{var W,K,b,j,ee;return e.jsxs("div",{className:`
                    border border-gray-200 rounded-lg p-2 overflow-hidden
                    ${m!=null&&m.isCurrentMonth?"bg-white":"bg-gray-50"}
                    ${m!=null&&m.isToday?"ring-2 ring-indigo-500":""}
                  `,children:[e.jsx("div",{className:`
                    text-sm font-medium mb-2
                    ${m!=null&&m.isCurrentMonth?"text-gray-900":"text-gray-400"}
                    ${m!=null&&m.isToday?"text-indigo-600":""}
                  `,children:(W=m==null?void 0:m.date)==null?void 0:W.getDate()}),e.jsxs("div",{className:"space-y-1",children:[(b=(K=m==null?void 0:m.jobs)==null?void 0:K.slice(0,2))==null?void 0:b.map(P=>{var Ce,$e;return e.jsx("div",{className:`
                          text-xs p-1 rounded cursor-pointer truncate
                          ${!(P!=null&&P.vendor_id)||(P==null?void 0:P.location)==="on_site"?"bg-green-100 text-green-800 border border-green-200":"bg-orange-100 text-orange-800 border border-orange-200"}
                        `,onClick:()=>de(P),title:`${P==null?void 0:P.job_number} - ${P==null?void 0:P.title}`,children:($e=(Ce=P==null?void 0:P.job_number)==null?void 0:Ce.split("-"))==null?void 0:$e.pop()},P==null?void 0:P.id)}),((j=m==null?void 0:m.jobs)==null?void 0:j.length)>2&&e.jsxs("div",{className:"text-xs text-gray-500 text-center",children:["+",((ee=m==null?void 0:m.jobs)==null?void 0:ee.length)-2," more"]})]})]},L)})},O))})]})},me=r=>{var N,u,A,O,m,L;const v=!(r!=null&&r.vendor_id)||(r==null?void 0:r.location)==="on_site",d=v?"bg-green-500":"bg-orange-500",C=((N=Z(r==null?void 0:r.job_status))==null?void 0:N.color)||"bg-blue-500",S=se(r==null?void 0:r.promised_date);return e.jsxs("div",{className:`
          relative rounded-lg p-3 mb-2 cursor-pointer transition-all duration-200 hover:shadow-lg
          ${d} text-white text-sm
        `,onClick:()=>de(r),draggable:!0,onDragStart:()=>ye(r),onDragEnd:Je,children:[e.jsx("div",{className:`absolute left-0 top-0 bottom-0 w-1 ${C} rounded-l-lg`}),e.jsxs("div",{className:"ml-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"font-bold truncate flex items-center gap-2",children:[e.jsx(re,{className:"h-3 w-3 mr-1"}),e.jsxs("span",{className:"truncate",children:[(A=(u=r==null?void 0:r.job_number)==null?void 0:u.split("-"))==null?void 0:A.pop()," • ",r==null?void 0:r.title]}),((r==null?void 0:r.has_active_loaner)||(r==null?void 0:r.loaner_id)||(r==null?void 0:r.customer_needs_loaner))&&e.jsx("span",{className:"px-1.5 py-0.5 rounded-full text-[10px] font-semibold bg-violet-100 text-violet-800 whitespace-nowrap",children:"Loaner"})]}),S&&e.jsxs("div",{className:"flex items-center text-red-200",children:[e.jsx(ie,{className:"h-3 w-3"}),e.jsx("span",{className:"text-xs ml-1",children:"Overdue"})]})]}),e.jsxs("div",{className:"text-xs opacity-90 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),G(r==null?void 0:r.scheduled_start_time),"–",G(r==null?void 0:r.scheduled_end_time)]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(z,{className:"h-3 w-3 mr-1"}),r!=null&&r.next_promised_short?`Promise: ${r==null?void 0:r.next_promised_short}`:`Promise: ${(O=new Date(r==null?void 0:r.promised_date))==null?void 0:O.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})}`]})]}),e.jsx("div",{className:`px-2 py-1 rounded-full text-xs ${((m=Z(r==null?void 0:r.job_status))==null?void 0:m.bg)||"bg-gray-500"} text-white`,children:((L=Z(r==null?void 0:r.job_status))==null?void 0:L.label)||(r==null?void 0:r.job_status)})]}),!v&&e.jsxs("div",{className:"text-xs opacity-90 mt-1 flex items-center",children:[e.jsx(ne,{className:"h-3 w-3 mr-1"}),r==null?void 0:r.vendor_name]})]})]},r==null?void 0:r.id)},We=()=>{const r=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],v=Array.from({length:10},(d,C)=>8+C);return e.jsxs("div",{className:"grid grid-cols-7 gap-2 h-full",children:[e.jsxs("div",{className:"col-span-1 space-y-12",children:[e.jsx("div",{className:"h-12"})," ",v==null?void 0:v.map(d=>e.jsxs("div",{className:"text-xs text-gray-500 text-right pr-2",children:[d,":00"]},d))]}),r==null?void 0:r.map((d,C)=>{const S=new Date(le());S==null||S.setDate((S==null?void 0:S.getDate())+C);const N=a==null?void 0:a.filter(u=>{const A=new Date(u==null?void 0:u.scheduled_start_time);return(A==null?void 0:A.toDateString())===(S==null?void 0:S.toDateString())});return e.jsxs("div",{className:"border-l border-gray-200 pl-2",children:[e.jsxs("div",{className:"h-12 border-b border-gray-200 pb-2",children:[e.jsx("div",{className:"font-medium text-sm",children:d}),e.jsx("div",{className:"text-xs text-gray-500",children:S==null?void 0:S.toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsx("div",{className:"space-y-12",children:v==null?void 0:v.map(u=>{var A;return e.jsx("div",{className:"h-12 border-b border-gray-100 relative",onDragOver:O=>O==null?void 0:O.preventDefault(),onDrop:()=>fe(null,new Date(S==null?void 0:S.setHours(u))),children:(A=N==null?void 0:N.filter(O=>{const m=new Date(O==null?void 0:O.scheduled_start_time);return(m==null?void 0:m.getHours())===u}))==null?void 0:A.map(me)},`${d}-${u}`)})})]},d)})]})},Ke=()=>{var r,v;return Array.from({length:10},(d,C)=>8+C),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-4 h-4 bg-green-500 rounded mr-3"}),e.jsx("h3",{className:"font-medium",children:"On-Site (PLV)"})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[(r=a==null?void 0:a.filter(d=>!(d!=null&&d.vendor_id)||(d==null?void 0:d.location)==="on_site"))==null?void 0:r.length," ","jobs"]})]}),e.jsx("div",{className:"grid grid-cols-6 gap-2",children:(v=a==null?void 0:a.filter(d=>!(d!=null&&d.vendor_id)||(d==null?void 0:d.location)==="on_site"))==null?void 0:v.map(me)})]}),M==null?void 0:M.map(d=>{const C=a==null?void 0:a.filter(u=>(u==null?void 0:u.vendor_id)===(d==null?void 0:d.id)),S=C==null?void 0:C.length;return e.jsxs("div",{className:"bg-orange-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-4 h-4 bg-orange-500 rounded mr-3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:d==null?void 0:d.name}),e.jsx("div",{className:"text-sm text-gray-600",children:d==null?void 0:d.specialty})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-medium",children:[S," / ",7]}),e.jsx("div",{className:"text-xs text-gray-600",children:"scheduled / capacity"})]})]}),e.jsx("div",{className:"grid grid-cols-6 gap-2 min-h-[60px] border-2 border-dashed border-orange-200 rounded p-2",onDragOver:u=>u==null?void 0:u.preventDefault(),onDrop:()=>fe(d==null?void 0:d.id),children:C==null?void 0:C.map(me)})]},d==null?void 0:d.id)})]})};return e.jsx(es,{children:e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Calendar Flow Management Center"}),e.jsx("p",{className:"text-gray-600",children:"Visual scheduling and workflow management"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>x("day"),className:`px-3 py-1 rounded text-sm ${l==="day"?"bg-white shadow-sm":""}`,children:"Day"}),e.jsx("button",{onClick:()=>x("week"),className:`px-3 py-1 rounded text-sm ${l==="week"?"bg-white shadow-sm":""}`,children:"Week"}),e.jsx("button",{onClick:()=>x("month"),className:`px-3 py-1 rounded text-sm ${l==="month"?"bg-white shadow-sm":""}`,children:"Month"})]}),l!=="month"&&e.jsxs("button",{onClick:()=>U(!_),className:`flex items-center px-4 py-2 rounded-lg border ${_?"bg-blue-50 border-blue-200 text-blue-700":"bg-white border-gray-200 text-gray-700"}`,children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),"Vendor Lanes"]}),e.jsxs("button",{onClick:()=>H(!0),className:"flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Round-Up"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>{const r=new Date(p);l==="month"?r==null||r.setMonth((r==null?void 0:r.getMonth())-1):l==="week"?r==null||r.setDate((r==null?void 0:r.getDate())-7):r==null||r.setDate((r==null?void 0:r.getDate())-1),R(r)},className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(De,{className:"h-5 w-5"})}),e.jsx("div",{className:"text-lg font-medium",children:l==="month"?p==null?void 0:p.toLocaleDateString("en-US",{month:"long",year:"numeric"}):l==="week"?`Week of ${p==null?void 0:p.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})}`:p==null?void 0:p.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})}),e.jsx("button",{onClick:()=>{const r=new Date(p);l==="month"?r==null||r.setMonth((r==null?void 0:r.getMonth())+1):l==="week"?r==null||r.setDate((r==null?void 0:r.getDate())+7):r==null||r.setDate((r==null?void 0:r.getDate())+1),R(r)},className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(be,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>R(new Date),className:"px-4 py-2 text-sm bg-gray-100 hover:bg-gray-200 rounded-lg",children:"Today"})]}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(je,{className:"h-4 w-4 absolute left-3 top-3 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search stock #, phone, customer...",value:w==null?void 0:w.searchQuery,onChange:r=>X(v=>{var d;return{...v,searchQuery:(d=r==null?void 0:r.target)==null?void 0:d.value}}),className:"pl-10 pr-4 py-2 border border-gray-200 rounded-lg w-80"})]})})]})]}),e.jsx(ss,{filters:w,onFiltersChange:X,jobCounts:{today:(pe=[...i,...g].filter(r=>{const v=new Date(r==null?void 0:r.scheduled_start_time),d=new Date;return(v==null?void 0:v.toDateString())===(d==null?void 0:d.toDateString())}))==null?void 0:pe.length,inProgress:(we=[...i,...g].filter(r=>(r==null?void 0:r.job_status)==="in_progress"))==null?void 0:we.length,overdue:(_e=[...i,...g].filter(r=>se(r==null?void 0:r.promised_date)))==null?void 0:_e.length,noShow:(Se=[...i,...g].filter(r=>(r==null?void 0:r.job_status)==="no_show"))==null?void 0:Se.length,completed:(ke=[...i,...g].filter(r=>(r==null?void 0:r.job_status)==="completed"))==null?void 0:ke.length}}),e.jsxs("div",{className:"flex h-screen",children:[l!=="month"&&e.jsx(rs,{jobs:k,onJobClick:de,onDragStart:ye,loading:s}),e.jsx("div",{className:`flex-1 p-6 ${l==="month"?"w-full":""}`,children:s?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 h-full overflow-auto",children:l==="month"?Le():_?Ke():We()})})]}),e.jsx(ts,{job:f,isOpen:$,onClose:()=>q(!1),onStatusUpdate:He}),e.jsx(ls,{isOpen:Y,onClose:()=>H(!1),jobs:a,type:o,onTypeChange:n})]})})};export{hs as default};
//# sourceMappingURL=index-q4diq7NL.js.map
