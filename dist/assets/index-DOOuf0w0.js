import{s as Q,q as G,r as B,T as ie,V as qe,G as ge,j as e,z as We,C as Qe,n as re,W as $e,X as Ee,Y as Ue,Z as Ae,_ as Me,o as ne,v as xe,U as ke,$ as Ye,a0 as Oe,a1 as Pe,P as ze,a2 as he,F as Ge,a3 as Xe,a4 as Ze,a5 as Ke,N as Be}from"./index-CsUHg1Df.js";import{r as V}from"./react-Czq5O75u.js";import{A as De}from"./AppLayout-DRddjUA5.js";import{s as be}from"./options-CllavUpK.js";import{v as je}from"./vendorService-BlefxV3H.js";import"./supabase-D02rA7zj.js";import"./router-CZES1Sa0.js";import"./Navbar-Drk33yWo.js";const Y={async getJobsByDateRange(r,l,d={}){var v;try{const{data:g,error:a}=await((v=Q)==null?void 0:v.rpc("get_jobs_by_date_range",{start_date:r==null?void 0:r.toISOString(),end_date:l==null?void 0:l.toISOString(),vendor_filter:(d==null?void 0:d.vendorId)||null,status_filter:(d==null?void 0:d.status)||null}));if(a)throw a;return{data:g||[],error:null}}catch(g){return console.error("[calendar] getJobsByDateRange failed:",g),{data:[],error:g}}},async checkSchedulingConflict(r,l,d,v=null){var g;try{const{data:a,error:i}=await((g=Q)==null?void 0:g.rpc("check_vendor_schedule_conflict",{vendor_uuid:r,start_time:l==null?void 0:l.toISOString(),end_time:d==null?void 0:d.toISOString(),exclude_job_id:v}));if(i)throw i;return{hasConflict:a||!1,error:null}}catch(a){return console.error("[calendar] checkSchedulingConflict failed:",a),{hasConflict:!1,error:a}}},async updateJobSchedule(r,l,d=null){var v,g,a,i,y,C,T,M,F;try{const f={scheduled_start_time:(v=l==null?void 0:l.startTime)==null?void 0:v.toISOString(),scheduled_end_time:(g=l==null?void 0:l.endTime)==null?void 0:g.toISOString(),vendor_id:l==null?void 0:l.vendorId,location:l==null?void 0:l.location,color_code:l==null?void 0:l.colorCode,calendar_notes:l==null?void 0:l.notes,job_status:(l==null?void 0:l.status)??(l!=null&&l.startTime?"scheduled":void 0),updated_at:(a=new Date)==null?void 0:a.toISOString()};(i=Object.keys(f))==null||i.forEach(I=>{(f==null?void 0:f[I])===void 0&&(f==null||delete f[I])});let E=(F=(M=(T=(C=(y=Q)==null?void 0:y.from("jobs"))==null?void 0:C.update(f))==null?void 0:T.eq("id",r))==null?void 0:M.select(`
          *,
          vendor:vendors(id, name, specialty),
          vehicle:vehicles(id, make, model, year, owner_name, stock_number)
        `))==null?void 0:F.single();return d&&(E=E==null?void 0:E.eq("org_id",d)),{data:await be(E,"calendar:updateJobSchedule"),error:null}}catch(f){return console.error("[calendar] updateJobSchedule failed:",f),{data:null,error:f}}},async createScheduledJob(r,l=null){var d,v,g,a,i,y,C,T;try{const{data:M,error:F}=await((d=Q)==null?void 0:d.rpc("generate_job_number"));if(F)throw F;const f={job_number:M,title:r==null?void 0:r.title,description:(r==null?void 0:r.description)||"",vehicle_id:r==null?void 0:r.vehicleId,vendor_id:r==null?void 0:r.vendorId,scheduled_start_time:(v=r==null?void 0:r.startTime)==null?void 0:v.toISOString(),scheduled_end_time:(g=r==null?void 0:r.endTime)==null?void 0:g.toISOString(),estimated_hours:(r==null?void 0:r.estimatedHours)||2,location:(r==null?void 0:r.location)||"",priority:(r==null?void 0:r.priority)||"medium",job_status:"scheduled",color_code:(r==null?void 0:r.colorCode)||"#3b82f6",calendar_notes:(r==null?void 0:r.notes)||"",created_by:r==null?void 0:r.createdBy,org_id:l??(r==null?void 0:r.org_id)??null},{data:E}=await((T=(C=(y=(i=(a=Q)==null?void 0:a.from("jobs"))==null?void 0:i.insert([f]))==null?void 0:y.select(`
          *,
          vendor:vendors(id, name, specialty),
          vehicle:vehicles(id, make, model, year, owner_name, stock_number)
        `))==null?void 0:C.single())==null?void 0:T.throwOnError());return{data:E,error:null}}catch(M){return console.error("[calendar] createScheduledJob failed:",M),{data:null,error:M}}},async getOverdueJobs(){var r;try{const{data:l,error:d}=await((r=Q)==null?void 0:r.rpc("get_overdue_jobs"));if(d)throw d;return{data:l||[],error:null}}catch(l){return console.error("[calendar] getOverdueJobs failed:",l),{data:[],error:l}}},async getCalendarStats(r="today",l=null){var d,v,g,a,i,y,C,T,M,F;try{const f=new Date;let E,O;switch(r){case"today":E=new Date(f.getFullYear(),f.getMonth(),f.getDate()),O=new Date(E),O==null||O.setDate((O==null?void 0:O.getDate())+1);break;case"week":E=new Date(f),E==null||E.setDate((f==null?void 0:f.getDate())-(f==null?void 0:f.getDay())),E==null||E.setHours(0,0,0,0),O=new Date(E),O==null||O.setDate((O==null?void 0:O.getDate())+7);break;case"month":E=new Date(f.getFullYear(),f.getMonth(),1),O=new Date(f.getFullYear(),f.getMonth()+1,1);break;default:E=new Date(f.getFullYear(),f.getMonth(),f.getDate()),O=new Date(E),O==null||O.setDate((O==null?void 0:O.getDate())+1)}let I=(g=(v=(d=Q)==null?void 0:d.from("jobs"))==null?void 0:v.select("*",{count:"exact",head:!0}))==null?void 0:g.neq("job_status","cancelled");l&&(I=I==null?void 0:I.eq("org_id",l));const{count:z,error:H}=await I;if(H)throw H;let o=(C=(y=(i=(a=Q)==null?void 0:a.from("jobs"))==null?void 0:i.select("*",{count:"exact",head:!0}))==null?void 0:y.gte("scheduled_start_time",E==null?void 0:E.toISOString()))==null?void 0:C.lt("scheduled_start_time",O==null?void 0:O.toISOString());l&&(o=o==null?void 0:o.eq("org_id",l));const{count:n,error:t}=await o;if(t)throw t;const{data:h}=await this.getOverdueJobs();let _=(F=(M=(T=Q)==null?void 0:T.from("vendors"))==null?void 0:M.select("*",{count:"exact",head:!0}))==null?void 0:F.eq("is_active",!0);l&&(_=_==null?void 0:_.eq("org_id",l));const{count:A,error:p}=await _;if(p)throw p;return{data:{totalJobs:z||0,scheduledJobs:n||0,overdueJobs:(h==null?void 0:h.length)||0,activeVendors:A||0},error:null}}catch(f){return console.error("[calendar] getCalendarStats failed:",f),{data:{totalJobs:0,scheduledJobs:0,overdueJobs:0,activeVendors:0},error:f}}},async getVendorAvailability(r,l,d){try{const{data:v}=await this.getJobsByDateRange(l,d,{vendorId:r}),g=v,a=Array.isArray(g)?g.some(i=>{if(!(i!=null&&i.scheduled_start_time)||!(i!=null&&i.scheduled_end_time))return!1;const y=new Date(i.scheduled_start_time).getTime(),C=new Date(i.scheduled_end_time).getTime();return y<d.getTime()&&C>l.getTime()}):!1;return{available:!a,conflictingJobs:a?g:[],error:null}}catch(v){return console.error("[calendar] getVendorAvailability failed:",v),{available:!1,conflictingJobs:[],error:v}}}},es=({filters:r,onFiltersChange:l,jobCounts:d})=>{const v=[{id:"today",label:"Today",icon:G,count:(d==null?void 0:d.today)||0,color:"bg-blue-50 text-blue-700 border-blue-200",activeColor:"bg-blue-600 text-white border-blue-600"},{id:"in_progress",label:"In-Progress",icon:B,count:(d==null?void 0:d.inProgress)||0,color:"bg-yellow-50 text-yellow-700 border-yellow-200",activeColor:"bg-yellow-600 text-white border-yellow-600"},{id:"overdue",label:"Overdue",icon:ie,count:(d==null?void 0:d.overdue)||0,color:"bg-red-50 text-red-700 border-red-200",activeColor:"bg-red-600 text-white border-red-600"},{id:"no_show",label:"No-Show",icon:qe,count:(d==null?void 0:d.noShow)||0,color:"bg-gray-50 text-gray-700 border-gray-200",activeColor:"bg-gray-600 text-white border-gray-600"},{id:"completed",label:"Completed",icon:ge,count:(d==null?void 0:d.completed)||0,color:"bg-green-50 text-green-700 border-green-200",activeColor:"bg-green-600 text-white border-green-600"}],g=i=>{var y;return(y=r==null?void 0:r.statuses)==null?void 0:y.includes(i)},a=i=>{const y=(r==null?void 0:r.statuses)||[],C=y!=null&&y.includes(i)?y==null?void 0:y.filter(T=>T!==i):[...y,i];l==null||l({...r,statuses:C})};return e.jsx("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600 mr-4",children:[e.jsx(We,{className:"h-4 w-4 mr-2"}),"Quick Filters:"]}),v==null?void 0:v.map(i=>{const y=i==null?void 0:i.icon,C=g(i==null?void 0:i.id);return e.jsxs("button",{onClick:()=>a(i==null?void 0:i.id),className:`
                  flex items-center px-3 py-2 rounded-lg border text-sm font-medium transition-all duration-200
                  ${C?i==null?void 0:i.activeColor:i==null?void 0:i.color}
                  hover:shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500
                `,children:[e.jsx("div",{className:`
                  flex items-center justify-center w-4 h-4 mr-2 rounded border-2 transition-all duration-200
                  ${C?"bg-white border-white":"bg-transparent border-gray-400 border-opacity-60"}
                `,children:e.jsx(Qe,{className:`h-3 w-3 transition-all duration-200 ${C?"text-gray-700 opacity-100":"text-transparent opacity-0"}`})}),e.jsx(y,{className:"h-4 w-4 mr-2"}),i==null?void 0:i.label,(i==null?void 0:i.count)>0&&e.jsx("span",{className:`
                    ml-2 px-2 py-0.5 rounded-full text-xs font-semibold
                    ${C?"bg-white bg-opacity-20":"bg-gray-100 text-gray-800"}
                  `,children:i==null?void 0:i.count})]},i==null?void 0:i.id)})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Show:"}),e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:(r==null?void 0:r.showUnassigned)||!1,onChange:i=>{var y;return l==null?void 0:l({...r,showUnassigned:(y=i==null?void 0:i.target)==null?void 0:y.checked})},className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 focus:ring-2 h-4 w-4"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Unassigned Jobs"})]})]})]})})},Ve=r=>{if(!r)return null;if(r instanceof Date)return isNaN(r==null?void 0:r.getTime())?null:r;if(typeof r=="string"){if((r==null?void 0:r.trim())==="")return null;try{const l=new Date(r);return isNaN(l==null?void 0:l.getTime())?null:l}catch(l){return console.warn("Date parsing error:",r,l),null}}if(typeof r=="number")try{const l=new Date(r);return isNaN(l==null?void 0:l.getTime())?null:l}catch(l){return console.warn("Date creation from number error:",r,l),null}return null},X=r=>{if(!r)return"";const l=Ve(r);if(!l)return console.warn("formatTime: Invalid date input:",r),"Invalid Time";try{return l==null?void 0:l.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}catch(d){return console.error("formatTime error:",d),"Invalid Time"}},se=r=>{if(!r)return!1;const l=Ve(r);if(!l)return!1;const d=new Date;try{return l<d}catch(v){return console.error("isOverdue comparison error:",v),!1}},K=r=>{const l={pending:{label:"PENDING",bg:"bg-gray-100",textColor:"text-gray-800",color:"bg-gray-500"},scheduled:{label:"BOOKED",bg:"bg-blue-100",textColor:"text-blue-800",color:"bg-blue-500"},in_progress:{label:"IP",bg:"bg-yellow-100",textColor:"text-yellow-800",color:"bg-yellow-500"},quality_check:{label:"W/P",bg:"bg-purple-100",textColor:"text-purple-800",color:"bg-purple-500"},completed:{label:"DONE",bg:"bg-green-100",textColor:"text-green-800",color:"bg-green-500"},delivered:{label:"DONE",bg:"bg-teal-100",textColor:"text-teal-800",color:"bg-teal-500"},cancelled:{label:"CANCELED",bg:"bg-red-100",textColor:"text-red-800",color:"bg-red-500"},no_show:{label:"NS",bg:"bg-gray-100",textColor:"text-gray-800",color:"bg-gray-400"}};return(l==null?void 0:l[r])||(l==null?void 0:l.pending)},ss=({jobs:r,onJobClick:l,onDragStart:d,loading:v})=>{const g=a=>{var C,T,M,F;const i=se(a==null?void 0:a.promised_date),y=K(a==null?void 0:a.job_status);return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4 mb-3 cursor-pointer hover:shadow-md transition-all duration-200 hover:border-blue-300",onClick:()=>l==null?void 0:l(a),draggable:!0,onDragStart:()=>d==null?void 0:d(a),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(re,{className:"h-4 w-4 text-gray-600 mr-2"}),e.jsx("span",{className:"font-medium text-gray-900",children:(T=(C=a==null?void 0:a.job_number)==null?void 0:C.split("-"))==null?void 0:T.pop()}),i&&e.jsx(ie,{className:"h-4 w-4 text-red-500 ml-2"})]}),e.jsx("div",{className:`
            px-2 py-1 rounded-full text-xs font-medium
            ${(y==null?void 0:y.bg)||"bg-gray-100"} 
            ${(y==null?void 0:y.textColor)||"text-gray-800"}
          `,children:(y==null?void 0:y.label)||((M=a==null?void 0:a.job_status)==null?void 0:M.toUpperCase())})]}),e.jsxs("div",{className:"text-sm font-medium text-gray-800 mb-2 flex items-center",children:[e.jsx($e,{className:"h-3 w-3 text-gray-500 mr-1"}),a==null?void 0:a.title]}),e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:a==null?void 0:a.vehicle_info}),e.jsxs("div",{className:"space-y-1",children:[(a==null?void 0:a.scheduled_start_time)&&e.jsxs("div",{className:"flex items-center text-xs text-gray-600",children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),X(a==null?void 0:a.scheduled_start_time),"–",X(a==null?void 0:a.scheduled_end_time)]}),e.jsxs("div",{className:`flex items-center text-xs ${i?"text-red-600":"text-gray-600"}`,children:[e.jsx(G,{className:"h-3 w-3 mr-1"}),"Promise: ",(F=new Date(a==null?void 0:a.promised_date))==null?void 0:F.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),i&&e.jsx("span",{className:"ml-2 px-1.5 py-0.5 bg-red-100 text-red-700 rounded text-xs font-medium",children:"Overdue"})]}),(a==null?void 0:a.estimated_hours)&&e.jsxs("div",{className:"flex items-center text-xs text-gray-600",children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),a==null?void 0:a.estimated_hours,"h estimated"]})]}),e.jsx("div",{className:"mt-3 pt-2 border-t border-gray-100",children:e.jsx("div",{className:"text-xs text-gray-500 text-center",children:"Drag to assign vendor or time slot"})})]},a==null?void 0:a.id)};return e.jsxs("div",{className:"w-80 bg-gray-50 border-r border-gray-200 flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 bg-white border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-medium text-gray-900",children:"Unassigned Queue"}),e.jsx("div",{className:"bg-gray-100 text-gray-700 text-xs px-2 py-1 rounded-full font-medium",children:(r==null?void 0:r.length)||0})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Drag jobs onto calendar to schedule"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:v?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-indigo-600"})}):(r==null?void 0:r.length)>0?e.jsx("div",{className:"space-y-3",children:r==null?void 0:r.map(g)}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(re,{className:"h-8 w-8 text-gray-400 mx-auto mb-3"}),e.jsx("div",{className:"text-sm text-gray-600",children:"No unassigned jobs"}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"All jobs are scheduled"})]})}),e.jsx("div",{className:"p-4 bg-white border-t border-gray-200",children:e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),"Drop on calendar for On-Site"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full mr-2"}),"Drop on vendor lane for Off-Site"]})]})})]})},rs=({job:r,isOpen:l,onClose:d,onStatusUpdate:v})=>{var z,H;const[g,a]=V.useState("details"),[i,y]=V.useState("");if(!l||!r)return null;const C=K(r==null?void 0:r.job_status),T=se(r==null?void 0:r.promised_date),M=[{id:"start",label:"Start",icon:Ue,color:"bg-green-600 hover:bg-green-700 text-white",action:()=>v==null?void 0:v(r==null?void 0:r.id,"in_progress")},{id:"complete",label:"Complete",icon:ge,color:"bg-blue-600 hover:bg-blue-700 text-white",action:()=>v==null?void 0:v(r==null?void 0:r.id,"completed")},{id:"no_show",label:"No-Show",icon:Ae,color:"bg-gray-600 hover:bg-gray-700 text-white",action:()=>v==null?void 0:v(r==null?void 0:r.id,"no_show")},{id:"reschedule",label:"Reschedule",icon:Me,color:"bg-orange-600 hover:bg-orange-700 text-white",action:()=>{console.log("Open reschedule modal")}}],F=[{id:"details",label:"Details",icon:$e},{id:"customer",label:"Customer",icon:ke},{id:"timeline",label:"Timeline/Notes",icon:Ye},{id:"photos",label:"Photos",icon:Oe}],f=()=>{var o,n,t;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Job Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Job Number"}),e.jsxs("div",{className:"mt-1 flex items-center",children:[e.jsx("span",{className:"text-sm font-mono",children:r==null?void 0:r.job_number}),e.jsx("button",{className:"ml-2 p-1 hover:bg-gray-100 rounded",children:e.jsx(Pe,{className:"h-3 w-3 text-gray-400"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Priority"}),e.jsx("div",{className:"mt-1",children:e.jsx("span",{className:`
                inline-flex px-2 py-1 text-xs font-medium rounded-full
                ${(r==null?void 0:r.priority)==="high"?"bg-red-100 text-red-800":(r==null?void 0:r.priority)==="medium"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}
              `,children:(o=r==null?void 0:r.priority)==null?void 0:o.toUpperCase()})})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Service Details"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Service Type"}),e.jsx("div",{className:"mt-1 text-sm text-gray-900",children:r==null?void 0:r.title})]}),(r==null?void 0:r.description)&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Description"}),e.jsx("div",{className:"mt-1 text-sm text-gray-900",children:r==null?void 0:r.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Estimated Hours"}),e.jsx("div",{className:"mt-1 text-sm text-gray-900",children:(r==null?void 0:r.estimated_hours)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Estimated Cost"}),e.jsxs("div",{className:"mt-1 text-sm text-gray-900",children:["$",r!=null&&r.estimated_cost?(n=Number(r==null?void 0:r.estimated_cost))==null?void 0:n.toFixed(2):"N/A"]})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Location & Scheduling"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[e.jsx("div",{className:"flex items-center",children:r!=null&&r.vendor_id?e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"h-4 w-4 text-orange-500 mr-2"}),e.jsxs("span",{className:"text-sm",children:["Off-Site @ ",r==null?void 0:r.vendor_name]})]}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"h-4 w-4 text-green-500 mr-2"}),e.jsx("span",{className:"text-sm",children:"On-Site"})]})}),(r==null?void 0:r.scheduled_start_time)&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(B,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsxs("span",{className:"text-sm",children:[X(r==null?void 0:r.scheduled_start_time)," - ",X(r==null?void 0:r.scheduled_end_time)]})]}),e.jsxs("div",{className:`flex items-center ${T?"text-red-600":""}`,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),e.jsxs("span",{className:"text-sm",children:["Promise Date: ",(t=new Date(r==null?void 0:r.promised_date))==null?void 0:t.toLocaleDateString()]}),T&&e.jsx(ie,{className:"h-4 w-4 ml-2 text-red-500"})]})]})]})]})},E=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Vehicle Information"}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(re,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-sm font-medium",children:r==null?void 0:r.vehicle_info})]})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Customer Contact"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ke,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-sm",children:"Customer Name"})]}),e.jsx("span",{className:"text-sm text-gray-600",children:"Available in vehicle record"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ze,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-sm",children:"Phone"})]}),e.jsx("span",{className:"text-sm text-gray-600",children:"Available in vehicle record"})]})]})]})]}),O=()=>{var o,n;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Recent Updates"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"border-l-4 border-blue-400 pl-4 py-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:"Job Created"}),e.jsx("div",{className:"text-xs text-gray-500",children:(o=new Date(r==null?void 0:r.created_at))==null?void 0:o.toLocaleString()})]}),(r==null?void 0:r.updated_at)&&(r==null?void 0:r.updated_at)!==(r==null?void 0:r.created_at)&&e.jsxs("div",{className:"border-l-4 border-yellow-400 pl-4 py-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:"Last Updated"}),e.jsx("div",{className:"text-xs text-gray-500",children:(n=new Date(r==null?void 0:r.updated_at))==null?void 0:n.toLocaleString()})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Add Note"}),e.jsx("textarea",{value:i,onChange:t=>{var h;return y((h=t==null?void 0:t.target)==null?void 0:h.value)},placeholder:"Add a note about this job...",className:"w-full h-24 border border-gray-300 rounded-lg p-3 text-sm"}),e.jsx("button",{className:"mt-2 px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700",children:"Add Note"})]})]})},I=()=>e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Oe,{className:"h-8 w-8 mx-auto mb-3 text-gray-400"}),e.jsx("div",{className:"text-sm",children:"No photos uploaded yet"}),e.jsx("button",{className:"mt-3 px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700",children:"Upload Photos"})]})});return e.jsxs("div",{className:"fixed inset-0 z-50 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50",onClick:d}),e.jsx("div",{className:"absolute right-0 top-0 h-full w-full max-w-2xl bg-white shadow-xl",children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-3 h-3 rounded-full mr-3 ${r!=null&&r.vendor_id?"bg-orange-500":"bg-green-500"}`}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:r==null?void 0:r.job_number}),e.jsxs("div",{className:"text-sm text-gray-600 flex items-center mt-1",children:[r==null?void 0:r.vehicle_info,e.jsx("span",{className:`
                      ml-3 px-2 py-1 rounded-full text-xs font-medium
                      ${(C==null?void 0:C.bg)||"bg-gray-100"} 
                      ${(C==null?void 0:C.textColor)||"text-gray-800"}
                    `,children:(C==null?void 0:C.label)||((z=r==null?void 0:r.job_status)==null?void 0:z.toUpperCase())})]})]})]}),e.jsx("button",{onClick:d,className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx(Ee,{className:"h-5 w-5 text-gray-400"})})]}),e.jsx("div",{className:"flex items-center space-x-2 mt-4",children:M==null?void 0:M.map(o=>{const n=o==null?void 0:o.icon;return e.jsxs("button",{onClick:o==null?void 0:o.action,className:`
                      flex items-center px-3 py-2 rounded-lg text-sm font-medium
                      ${o==null?void 0:o.color} transition-colors duration-200
                    `,children:[e.jsx(n,{className:"h-4 w-4 mr-2"}),o==null?void 0:o.label]},o==null?void 0:o.id)})})]}),e.jsx("div",{className:"px-6 py-3 bg-gray-50 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center text-sm text-gray-600 space-x-4",children:[e.jsx("div",{className:"flex items-center",children:r!=null&&r.vendor_id?e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"h-4 w-4 mr-1"}),r==null?void 0:r.vendor_name]}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"h-4 w-4 mr-1"}),"On-Site"]})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(G,{className:"h-4 w-4 mr-1"}),"Promise: ",(H=new Date(r==null?void 0:r.promised_date))==null?void 0:H.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})]})]})}),e.jsx("div",{className:"px-6 py-0 bg-white border-b border-gray-200",children:e.jsx("div",{className:"flex space-x-8",children:F==null?void 0:F.map(o=>{const n=o==null?void 0:o.icon;return e.jsxs("button",{onClick:()=>a(o==null?void 0:o.id),className:`
                      flex items-center py-3 border-b-2 text-sm font-medium
                      ${g===(o==null?void 0:o.id)?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}
                    `,children:[e.jsx(n,{className:"h-4 w-4 mr-2"}),o==null?void 0:o.label]},o==null?void 0:o.id)})})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-6",children:[g==="details"&&f(),g==="customer"&&E(),g==="timeline"&&O(),g==="photos"&&I()]})]})})]})},ts=({isOpen:r,onClose:l,jobs:d,type:v,onTypeChange:g})=>{var H,o;const[a,i]=V.useState(new Set),y=n=>n==null?void 0:n.reduce((t,h)=>{var A;const _=(h==null?void 0:h.vendor_name)||"Unassigned";return t!=null&&t[_]||(t[_]=[]),(A=t==null?void 0:t[_])==null||A.push(h),t},{}),C=n=>{const t=new Date;t==null||t.setHours(0,0,0,0);const h=n==null?void 0:n.filter(_=>{const A=new Date(_==null?void 0:_.scheduled_start_time);return(A==null?void 0:A.toDateString())===(t==null?void 0:t.toDateString())});return{Today:{onSite:h==null?void 0:h.filter(_=>!(_!=null&&_.vendor_id)),vendors:y(h==null?void 0:h.filter(_=>_==null?void 0:_.vendor_id))}}},T=n=>{const t=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],h={};return t==null||t.forEach(_=>{const A=n==null?void 0:n.filter(p=>{const R=new Date(p==null?void 0:p.scheduled_start_time),w=R==null?void 0:R.getDay(),Z=t==null?void 0:t.indexOf(_);return w===(Z+1)%7});(A==null?void 0:A.length)>0&&(h[_]={onSite:A==null?void 0:A.filter(p=>!(p!=null&&p.vendor_id)),vendors:y(A==null?void 0:A.filter(p=>p==null?void 0:p.vendor_id))})}),h},M=n=>{const t={};return n==null||n.forEach(h=>{var R,w,Z,J,D,ae,te;const _=new Date(h==null?void 0:h.scheduled_start_time),p=`Week ${Math.ceil((_==null?void 0:_.getDate())/7)}`;t!=null&&t[p]||(t[p]={onSite:[],vendors:{}}),h!=null&&h.vendor_id?((w=(R=t==null?void 0:t[p])==null?void 0:R.vendors)!=null&&w[h==null?void 0:h.vendor_name]||(t[p].vendors[h==null?void 0:h.vendor_name]=[]),(D=(J=(Z=t==null?void 0:t[p])==null?void 0:Z.vendors)==null?void 0:J[h==null?void 0:h.vendor_name])==null||D.push(h)):(te=(ae=t==null?void 0:t[p])==null?void 0:ae.onSite)==null||te.push(h)}),t},F=V.useMemo(()=>{if(!(d!=null&&d.length))return{};switch(v){case"daily":return C(d);case"weekly":return T(d);case"monthly":return M(d);default:return C(d)}},[d,v]),f=(n,t)=>{console.log(`${t} job ${n}`)},E=n=>{const t=new Set(a);t!=null&&t.has(n)?t==null||t.delete(n):t==null||t.add(n),i(t)},O=n=>{console.log(`Export ${n} for selected jobs:`,Array.from(a))},I=n=>{var h,_,A,p;const t=K(n==null?void 0:n.job_status);return e.jsxs("div",{className:"flex items-center py-3 border-b border-gray-100 last:border-b-0",children:[e.jsx("input",{type:"checkbox",checked:a==null?void 0:a.has(n==null?void 0:n.id),onChange:()=>E(n==null?void 0:n.id),className:"mr-3 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsxs("div",{className:"flex-1 grid grid-cols-6 gap-4 items-center text-sm",children:[e.jsxs("div",{className:"flex items-center text-gray-900",children:[e.jsx(B,{className:"h-3 w-3 mr-1 text-gray-400"}),n!=null&&n.scheduled_start_time?`${X(n==null?void 0:n.scheduled_start_time)}–${X(n==null?void 0:n.scheduled_end_time)}`:"Unscheduled"]}),e.jsxs("div",{className:"flex items-center text-gray-900",children:[e.jsx(re,{className:"h-3 w-3 mr-1 text-gray-400"}),(_=(h=n==null?void 0:n.job_number)==null?void 0:h.split("-"))==null?void 0:_.pop()," | ",n==null?void 0:n.title]}),e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(G,{className:"h-3 w-3 mr-1 text-gray-400"}),(A=new Date(n==null?void 0:n.promised_date))==null?void 0:A.toLocaleDateString("en-US",{month:"short",day:"numeric"})]}),e.jsx("div",{className:"flex items-center text-gray-600",children:n!=null&&n.vendor_id?e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"h-3 w-3 mr-1 text-orange-500"}),n==null?void 0:n.vendor_name]}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"h-3 w-3 mr-1 text-green-500"}),"On-Site"]})}),e.jsx("div",{className:`
            inline-flex px-2 py-1 rounded-full text-xs font-medium
            ${(t==null?void 0:t.bg)||"bg-gray-100"} 
            ${(t==null?void 0:t.textColor)||"text-gray-800"}
          `,children:(t==null?void 0:t.label)||((p=n==null?void 0:n.job_status)==null?void 0:p.toUpperCase())}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("button",{onClick:()=>f(n==null?void 0:n.id,"start"),className:"p-1 hover:bg-green-100 rounded text-green-600",title:"Start",children:e.jsx(Ue,{className:"h-3 w-3"})}),e.jsx("button",{onClick:()=>f(n==null?void 0:n.id,"complete"),className:"p-1 hover:bg-blue-100 rounded text-blue-600",title:"Complete",children:e.jsx(ge,{className:"h-3 w-3"})}),e.jsx("button",{onClick:()=>f(n==null?void 0:n.id,"no_show"),className:"p-1 hover:bg-gray-100 rounded text-gray-600",title:"No-Show",children:e.jsx(Ae,{className:"h-3 w-3"})}),e.jsx("button",{onClick:()=>f(n==null?void 0:n.id,"reschedule"),className:"p-1 hover:bg-orange-100 rounded text-orange-600",title:"Reschedule",children:e.jsx(Me,{className:"h-3 w-3"})})]})]})]},n==null?void 0:n.id)},z=(n,t)=>{var h,_,A,p;return e.jsxs("div",{className:"mb-8",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center",children:[e.jsx(G,{className:"h-5 w-5 mr-2 text-gray-600"}),n]}),((h=t==null?void 0:t.onSite)==null?void 0:h.length)>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full mr-2"}),e.jsx("h4",{className:"font-medium text-green-900",children:"On-Site (PLV)"}),e.jsxs("span",{className:"ml-2 text-sm text-gray-600",children:["(",(_=t==null?void 0:t.onSite)==null?void 0:_.length," jobs)"]})]}),e.jsx("div",{className:"bg-green-50 rounded-lg p-4",children:(A=t==null?void 0:t.onSite)==null?void 0:A.map(I)})]}),(p=Object.entries((t==null?void 0:t.vendors)||{}))==null?void 0:p.map(([R,w])=>e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("div",{className:"w-3 h-3 bg-orange-500 rounded-full mr-2"}),e.jsx("h4",{className:"font-medium text-orange-900",children:R}),e.jsxs("span",{className:"ml-2 text-sm text-gray-600",children:["(",w==null?void 0:w.length," jobs)"]})]}),e.jsx("div",{className:"bg-orange-50 rounded-lg p-4",children:w==null?void 0:w.map(I)})]},R))]},n)};return r?e.jsxs("div",{className:"fixed inset-0 z-50 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50",onClick:l}),e.jsx("div",{className:"absolute right-0 top-0 h-full w-full max-w-6xl bg-white shadow-xl",children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(he,{className:"h-5 w-5 text-gray-600 mr-3"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Round-Up View"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Export and manage scheduled jobs"})]})]}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx(Ee,{className:"h-5 w-5 text-gray-400"})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>g==null?void 0:g("daily"),className:`px-3 py-1 rounded text-sm ${v==="daily"?"bg-white shadow-sm":""}`,children:"Daily"}),e.jsx("button",{onClick:()=>g==null?void 0:g("weekly"),className:`px-3 py-1 rounded text-sm ${v==="weekly"?"bg-white shadow-sm":""}`,children:"Weekly"}),e.jsx("button",{onClick:()=>g==null?void 0:g("monthly"),className:`px-3 py-1 rounded text-sm ${v==="monthly"?"bg-white shadow-sm":""}`,children:"Monthly"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[a==null?void 0:a.size," selected"]}),e.jsxs("button",{onClick:()=>O("copy"),className:"flex items-center px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50",children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Copy"]}),e.jsxs("button",{onClick:()=>O("csv"),className:"flex items-center px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50",children:[e.jsx(Ge,{className:"h-4 w-4 mr-2"}),"CSV"]}),e.jsxs("button",{onClick:()=>O("pdf"),className:"flex items-center px-3 py-2 bg-indigo-600 text-white text-sm rounded-lg hover:bg-indigo-700",children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"PDF"]})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-6",children:((H=Object.keys(F))==null?void 0:H.length)>0?(o=Object.entries(F))==null?void 0:o.map(([n,t])=>z(n,t)):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(G,{className:"h-8 w-8 mx-auto mb-3 text-gray-400"}),e.jsx("div",{className:"text-lg",children:"No jobs scheduled"}),e.jsxs("div",{className:"text-sm",children:["for the selected ",v," period"]})]})})]})})]}):null},hs=()=>{var ye,fe,pe,we,_e;const[r,l]=V.useState(!0),[d,v]=V.useState([]),[g,a]=V.useState([]),[i,y]=V.useState([]),[C,T]=V.useState([]),[M,F]=V.useState([]),[f,E]=V.useState(null),[O,I]=V.useState(!1),[z,H]=V.useState(!1),[o,n]=V.useState("daily"),[t,h]=V.useState("week"),[_,A]=V.useState(!0),[p,R]=V.useState(new Date),[w,Z]=V.useState({vendors:[],statuses:[],showUnassigned:!0,searchQuery:""}),[J,D]=V.useState(null),[ae,te]=V.useState(null);V.useEffect(()=>{ce(),Fe()},[p,t]),V.useEffect(()=>{Te()},[w,d,g]);const ce=async()=>{var s,x;l(!0);try{const c=le(),k=ue(),{data:S,error:N}=await(Y==null?void 0:Y.getJobsByDateRange(c,k,{vendorId:((s=w==null?void 0:w.vendors)==null?void 0:s.length)>0?(x=w==null?void 0:w.vendors)==null?void 0:x[0]:null}));if(!N&&S){const u=S==null?void 0:S.filter($=>$==null?void 0:$.vendor_id),U=S==null?void 0:S.filter($=>!($!=null&&$.vendor_id));v(u),a(U)}}catch(c){console.error("Error loading calendar data:",c)}finally{l(!1)}},Te=()=>{const s=oe(d);y(s);const x=oe(g);T(x)},oe=s=>{var c,k,S;if(!s||(s==null?void 0:s.length)===0)return[];let x=[...s];if(w!=null&&w.searchQuery){const N=(c=w==null?void 0:w.searchQuery)==null?void 0:c.toLowerCase();x=x==null?void 0:x.filter(u=>{var U,$,m,L,q,W,b,j,ee,P;return(($=(U=u==null?void 0:u.job_number)==null?void 0:U.toLowerCase())==null?void 0:$.includes(N))||((L=(m=u==null?void 0:u.title)==null?void 0:m.toLowerCase())==null?void 0:L.includes(N))||((W=(q=u==null?void 0:u.vehicle_info)==null?void 0:q.toLowerCase())==null?void 0:W.includes(N))||((j=(b=u==null?void 0:u.customer_name)==null?void 0:b.toLowerCase())==null?void 0:j.includes(N))||((P=(ee=u==null?void 0:u.customer_phone)==null?void 0:ee.toLowerCase())==null?void 0:P.includes(N))})}return((k=w==null?void 0:w.statuses)==null?void 0:k.length)>0&&(x=x==null?void 0:x.filter(N=>{var U;const u={today:()=>{const $=new Date(N==null?void 0:N.scheduled_start_time),m=new Date;return($==null?void 0:$.toDateString())===(m==null?void 0:m.toDateString())},in_progress:()=>(N==null?void 0:N.job_status)==="in_progress",overdue:()=>se(N==null?void 0:N.promised_date),no_show:()=>(N==null?void 0:N.job_status)==="no_show",completed:()=>(N==null?void 0:N.job_status)==="completed"};return(U=w==null?void 0:w.statuses)==null?void 0:U.some($=>{var m;return(m=u==null?void 0:u[$])==null?void 0:m.call(u)})})),((S=w==null?void 0:w.vendors)==null?void 0:S.length)>0&&(x=x==null?void 0:x.filter(N=>{var u;return(u=w==null?void 0:w.vendors)==null?void 0:u.includes(N==null?void 0:N.vendor_id)})),x},Fe=async()=>{var s;try{const{data:x}=await((s=je)==null?void 0:s.getVendors({is_active:!0}));x&&F(x)}catch(x){console.error("Error loading vendors:",x)}},le=()=>{const s=new Date(p);switch(t){case"day":return s==null||s.setHours(0,0,0,0),s;case"week":const x=s==null?void 0:s.getDay();return s==null||s.setDate((s==null?void 0:s.getDate())-x+1),s==null||s.setHours(0,0,0,0),s;case"month":return s==null||s.setDate(1),s==null||s.setHours(0,0,0,0),s;default:return s==null||s.setHours(0,0,0,0),s}},ue=()=>{const s=le();switch(t){case"day":return s==null||s.setDate((s==null?void 0:s.getDate())+1),s;case"week":return s==null||s.setDate((s==null?void 0:s.getDate())+6),s;case"month":return s==null||s.setMonth((s==null?void 0:s.getMonth())+1),s==null||s.setDate(0),s;default:return s==null||s.setDate((s==null?void 0:s.getDate())+1),s}},de=s=>{E(s),I(!0)},Ie=async(s,x)=>{try{await(Y==null?void 0:Y.updateJobSchedule(s,{status:x})),ce()}catch(c){console.error("Error updating job status:",c)}},Ne=s=>{D(s)},Re=()=>{D(null),te(null)},ve=async(s,x)=>{if(J)try{const c=new Date(x),k=new Date(c);k==null||k.setHours((c==null?void 0:c.getHours())+((J==null?void 0:J.estimated_hours)||2)),await(Y==null?void 0:Y.updateJobSchedule(J==null?void 0:J.id,{vendorId:s,startTime:c,endTime:k,location:s?"off_site":"on_site"})),ce()}catch(c){console.error("Error updating job assignment:",c)}},He=()=>{var u;const s=le(),x=ue(),c=new Date(s),k=new Date(x);c==null||c.setDate((c==null?void 0:c.getDate())-(c==null?void 0:c.getDay())+1),k==null||k.setDate((k==null?void 0:k.getDate())+(6-(k==null?void 0:k.getDay()))+1);const S=[],N=new Date(c);for(;N<=k;){const U=[];for(let $=0;$<7;$++){const m=new Date(N);m==null||m.setDate((N==null?void 0:N.getDate())+$);const L=i==null?void 0:i.filter(q=>{const W=new Date(q==null?void 0:q.scheduled_start_time);return(W==null?void 0:W.toDateString())===(m==null?void 0:m.toDateString())});U==null||U.push({date:new Date(m),jobs:L,isCurrentMonth:(m==null?void 0:m.getMonth())===(s==null?void 0:s.getMonth()),isToday:(m==null?void 0:m.toDateString())===((u=new Date)==null?void 0:u.toDateString())})}S==null||S.push(U),N==null||N.setDate((N==null?void 0:N.getDate())+7)}return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"grid grid-cols-7 gap-2 mb-4 border-b border-gray-200 pb-2",children:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map(U=>e.jsx("div",{className:"text-center text-sm font-medium text-gray-500 py-2",children:U},U))}),e.jsx("div",{className:"flex-1 space-y-2",children:S==null?void 0:S.map((U,$)=>e.jsx("div",{className:"grid grid-cols-7 gap-2 h-32",children:U==null?void 0:U.map((m,L)=>{var q,W,b,j,ee;return e.jsxs("div",{className:`
                    border border-gray-200 rounded-lg p-2 overflow-hidden
                    ${m!=null&&m.isCurrentMonth?"bg-white":"bg-gray-50"}
                    ${m!=null&&m.isToday?"ring-2 ring-indigo-500":""}
                  `,children:[e.jsx("div",{className:`
                    text-sm font-medium mb-2
                    ${m!=null&&m.isCurrentMonth?"text-gray-900":"text-gray-400"}
                    ${m!=null&&m.isToday?"text-indigo-600":""}
                  `,children:(q=m==null?void 0:m.date)==null?void 0:q.getDate()}),e.jsxs("div",{className:"space-y-1",children:[(b=(W=m==null?void 0:m.jobs)==null?void 0:W.slice(0,2))==null?void 0:b.map(P=>{var Se,Ce;return e.jsx("div",{className:`
                          text-xs p-1 rounded cursor-pointer truncate
                          ${!(P!=null&&P.vendor_id)||(P==null?void 0:P.location)==="on_site"?"bg-green-100 text-green-800 border border-green-200":"bg-orange-100 text-orange-800 border border-orange-200"}
                        `,onClick:()=>de(P),title:`${P==null?void 0:P.job_number} - ${P==null?void 0:P.title}`,children:(Ce=(Se=P==null?void 0:P.job_number)==null?void 0:Se.split("-"))==null?void 0:Ce.pop()},P==null?void 0:P.id)}),((j=m==null?void 0:m.jobs)==null?void 0:j.length)>2&&e.jsxs("div",{className:"text-xs text-gray-500 text-center",children:["+",((ee=m==null?void 0:m.jobs)==null?void 0:ee.length)-2," more"]})]})]},L)})},$))})]})},me=s=>{var N,u,U,$,m,L;const x=!(s!=null&&s.vendor_id)||(s==null?void 0:s.location)==="on_site",c=x?"bg-green-500":"bg-orange-500",k=((N=K(s==null?void 0:s.job_status))==null?void 0:N.color)||"bg-blue-500",S=se(s==null?void 0:s.promised_date);return e.jsxs("div",{className:`
          relative rounded-lg p-3 mb-2 cursor-pointer transition-all duration-200 hover:shadow-lg
          ${c} text-white text-sm
        `,onClick:()=>de(s),draggable:!0,onDragStart:()=>Ne(s),onDragEnd:Re,children:[e.jsx("div",{className:`absolute left-0 top-0 bottom-0 w-1 ${k} rounded-l-lg`}),e.jsxs("div",{className:"ml-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"font-bold truncate flex items-center gap-2",children:[e.jsx(re,{className:"h-3 w-3 mr-1"}),e.jsxs("span",{className:"truncate",children:[(U=(u=s==null?void 0:s.job_number)==null?void 0:u.split("-"))==null?void 0:U.pop()," • ",s==null?void 0:s.title]}),((s==null?void 0:s.has_active_loaner)||(s==null?void 0:s.loaner_id)||(s==null?void 0:s.customer_needs_loaner))&&e.jsx("span",{className:"px-1.5 py-0.5 rounded-full text-[10px] font-semibold bg-violet-100 text-violet-800 whitespace-nowrap",children:"Loaner"})]}),S&&e.jsxs("div",{className:"flex items-center text-red-200",children:[e.jsx(ie,{className:"h-3 w-3"}),e.jsx("span",{className:"text-xs ml-1",children:"Overdue"})]})]}),e.jsxs("div",{className:"text-xs opacity-90 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),X(s==null?void 0:s.scheduled_start_time),"–",X(s==null?void 0:s.scheduled_end_time)]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(G,{className:"h-3 w-3 mr-1"}),s!=null&&s.next_promised_short?`Promise: ${s==null?void 0:s.next_promised_short}`:`Promise: ${($=new Date(s==null?void 0:s.promised_date))==null?void 0:$.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})}`]})]}),e.jsx("div",{className:`px-2 py-1 rounded-full text-xs ${((m=K(s==null?void 0:s.job_status))==null?void 0:m.bg)||"bg-gray-500"} text-white`,children:((L=K(s==null?void 0:s.job_status))==null?void 0:L.label)||(s==null?void 0:s.job_status)})]}),!x&&e.jsxs("div",{className:"text-xs opacity-90 mt-1 flex items-center",children:[e.jsx(ne,{className:"h-3 w-3 mr-1"}),s==null?void 0:s.vendor_name]})]})]},s==null?void 0:s.id)},Je=()=>{const s=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],x=Array.from({length:10},(c,k)=>8+k);return e.jsxs("div",{className:"grid grid-cols-7 gap-2 h-full",children:[e.jsxs("div",{className:"col-span-1 space-y-12",children:[e.jsx("div",{className:"h-12"})," ",x==null?void 0:x.map(c=>e.jsxs("div",{className:"text-xs text-gray-500 text-right pr-2",children:[c,":00"]},c))]}),s==null?void 0:s.map((c,k)=>{const S=new Date(le());S==null||S.setDate((S==null?void 0:S.getDate())+k);const N=i==null?void 0:i.filter(u=>{const U=new Date(u==null?void 0:u.scheduled_start_time);return(U==null?void 0:U.toDateString())===(S==null?void 0:S.toDateString())});return e.jsxs("div",{className:"border-l border-gray-200 pl-2",children:[e.jsxs("div",{className:"h-12 border-b border-gray-200 pb-2",children:[e.jsx("div",{className:"font-medium text-sm",children:c}),e.jsx("div",{className:"text-xs text-gray-500",children:S==null?void 0:S.toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsx("div",{className:"space-y-12",children:x==null?void 0:x.map(u=>{var U;return e.jsx("div",{className:"h-12 border-b border-gray-100 relative",onDragOver:$=>$==null?void 0:$.preventDefault(),onDrop:()=>ve(null,new Date(S==null?void 0:S.setHours(u))),children:(U=N==null?void 0:N.filter($=>{const m=new Date($==null?void 0:$.scheduled_start_time);return(m==null?void 0:m.getHours())===u}))==null?void 0:U.map(me)},`${c}-${u}`)})})]},c)})]})},Le=()=>{var s,x;return Array.from({length:10},(c,k)=>8+k),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-4 h-4 bg-green-500 rounded mr-3"}),e.jsx("h3",{className:"font-medium",children:"On-Site (PLV)"})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[(s=i==null?void 0:i.filter(c=>!(c!=null&&c.vendor_id)||(c==null?void 0:c.location)==="on_site"))==null?void 0:s.length," ","jobs"]})]}),e.jsx("div",{className:"grid grid-cols-6 gap-2",children:(x=i==null?void 0:i.filter(c=>!(c!=null&&c.vendor_id)||(c==null?void 0:c.location)==="on_site"))==null?void 0:x.map(me)})]}),M==null?void 0:M.map(c=>{const k=i==null?void 0:i.filter(u=>(u==null?void 0:u.vendor_id)===(c==null?void 0:c.id)),S=k==null?void 0:k.length;return e.jsxs("div",{className:"bg-orange-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-4 h-4 bg-orange-500 rounded mr-3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:c==null?void 0:c.name}),e.jsx("div",{className:"text-sm text-gray-600",children:c==null?void 0:c.specialty})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-medium",children:[S," / ",7]}),e.jsx("div",{className:"text-xs text-gray-600",children:"scheduled / capacity"})]})]}),e.jsx("div",{className:"grid grid-cols-6 gap-2 min-h-[60px] border-2 border-dashed border-orange-200 rounded p-2",onDragOver:u=>u==null?void 0:u.preventDefault(),onDrop:()=>ve(c==null?void 0:c.id),children:k==null?void 0:k.map(me)})]},c==null?void 0:c.id)})]})};return e.jsx(De,{children:e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Calendar Flow Management Center"}),e.jsx("p",{className:"text-gray-600",children:"Visual scheduling and workflow management"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>h("day"),className:`px-3 py-1 rounded text-sm ${t==="day"?"bg-white shadow-sm":""}`,children:"Day"}),e.jsx("button",{onClick:()=>h("week"),className:`px-3 py-1 rounded text-sm ${t==="week"?"bg-white shadow-sm":""}`,children:"Week"}),e.jsx("button",{onClick:()=>h("month"),className:`px-3 py-1 rounded text-sm ${t==="month"?"bg-white shadow-sm":""}`,children:"Month"})]}),t!=="month"&&e.jsxs("button",{onClick:()=>A(!_),className:`flex items-center px-4 py-2 rounded-lg border ${_?"bg-blue-50 border-blue-200 text-blue-700":"bg-white border-gray-200 text-gray-700"}`,children:[e.jsx(Xe,{className:"h-4 w-4 mr-2"}),"Vendor Lanes"]}),e.jsxs("button",{onClick:()=>H(!0),className:"flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Round-Up"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>{const s=new Date(p);t==="month"?s==null||s.setMonth((s==null?void 0:s.getMonth())-1):t==="week"?s==null||s.setDate((s==null?void 0:s.getDate())-7):s==null||s.setDate((s==null?void 0:s.getDate())-1),R(s)},className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(Ze,{className:"h-5 w-5"})}),e.jsx("div",{className:"text-lg font-medium",children:t==="month"?p==null?void 0:p.toLocaleDateString("en-US",{month:"long",year:"numeric"}):t==="week"?`Week of ${p==null?void 0:p.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})}`:p==null?void 0:p.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})}),e.jsx("button",{onClick:()=>{const s=new Date(p);t==="month"?s==null||s.setMonth((s==null?void 0:s.getMonth())+1):t==="week"?s==null||s.setDate((s==null?void 0:s.getDate())+7):s==null||s.setDate((s==null?void 0:s.getDate())+1),R(s)},className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(Ke,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>R(new Date),className:"px-4 py-2 text-sm bg-gray-100 hover:bg-gray-200 rounded-lg",children:"Today"})]}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(Be,{className:"h-4 w-4 absolute left-3 top-3 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search stock #, phone, customer...",value:w==null?void 0:w.searchQuery,onChange:s=>Z(x=>{var c;return{...x,searchQuery:(c=s==null?void 0:s.target)==null?void 0:c.value}}),className:"pl-10 pr-4 py-2 border border-gray-200 rounded-lg w-80"})]})})]})]}),e.jsx(es,{filters:w,onFiltersChange:Z,jobCounts:{today:(ye=[...d,...g].filter(s=>{const x=new Date(s==null?void 0:s.scheduled_start_time),c=new Date;return(x==null?void 0:x.toDateString())===(c==null?void 0:c.toDateString())}))==null?void 0:ye.length,inProgress:(fe=[...d,...g].filter(s=>(s==null?void 0:s.job_status)==="in_progress"))==null?void 0:fe.length,overdue:(pe=[...d,...g].filter(s=>se(s==null?void 0:s.promised_date)))==null?void 0:pe.length,noShow:(we=[...d,...g].filter(s=>(s==null?void 0:s.job_status)==="no_show"))==null?void 0:we.length,completed:(_e=[...d,...g].filter(s=>(s==null?void 0:s.job_status)==="completed"))==null?void 0:_e.length}}),e.jsxs("div",{className:"flex h-screen",children:[t!=="month"&&e.jsx(ss,{jobs:C,onJobClick:de,onDragStart:Ne,loading:r}),e.jsx("div",{className:`flex-1 p-6 ${t==="month"?"w-full":""}`,children:r?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 h-full overflow-auto",children:t==="month"?He():_?Le():Je()})})]}),e.jsx(rs,{job:f,isOpen:O,onClose:()=>I(!1),onStatusUpdate:Ie}),e.jsx(ts,{isOpen:z,onClose:()=>H(!1),jobs:i,type:o,onTypeChange:n})]})})};export{hs as default};
//# sourceMappingURL=index-DOOuf0w0.js.map
