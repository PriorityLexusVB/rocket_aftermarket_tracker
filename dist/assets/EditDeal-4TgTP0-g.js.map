{"version":3,"file":"EditDeal-4TgTP0-g.js","sources":["../../src/pages/deals/EditDeal.jsx"],"sourcesContent":["// src/pages/deals/EditDeal.jsx\r\nimport React, { useEffect, useState } from 'react'\r\nimport { useNavigate, useParams } from 'react-router-dom'\r\nimport DealForm from './DealForm'\r\nimport * as dealService from '../../services/dealService'\r\n\r\nexport default function EditDeal() {\r\n  const { id } = useParams()\r\n  const navigate = useNavigate()\r\n  const [initial, setInitial] = useState(null)\r\n  const [loading, setLoading] = useState(true)\r\n  const [saving, setSaving] = useState(false)\r\n  const [lastSavedAt, setLastSavedAt] = useState(null)\r\n\r\n  useEffect(() => {\r\n    let alive = true\r\n    ;(async () => {\r\n      try {\r\n        const d = await dealService?.getDeal(id)\r\n        if (alive) {\r\n          const mapped = dealService.mapDbDealToForm ? dealService.mapDbDealToForm(d) : d\r\n          setInitial(mapped)\r\n        }\r\n      } catch (e) {\r\n        alert(e?.message || 'Failed to load deal')\r\n      } finally {\r\n        if (alive) setLoading(false)\r\n      }\r\n    })()\r\n    return () => {\r\n      alive = false\r\n    }\r\n  }, [id])\r\n\r\n  async function onSubmit(formState) {\r\n    setSaving(true)\r\n    try {\r\n      // Update then re-fetch latest persisted values; stay on Edit\r\n      await dealService?.updateDeal(id, formState)\r\n      const fresh = await dealService?.getDeal(id)\r\n      const mapped = dealService.mapDbDealToForm ? dealService.mapDbDealToForm(fresh) : fresh\r\n      setInitial(mapped)\r\n      setLastSavedAt(new Date())\r\n    } catch (e) {\r\n      alert(e?.message || 'Failed to save deal')\r\n    } finally {\r\n      setSaving(false)\r\n    }\r\n  }\r\n\r\n  if (loading) {\r\n    return <div className=\"max-w-5xl mx-auto p-8\">Loading...</div>\r\n  }\r\n\r\n  const dealNumber = initial?.job_number || `#${id}`\r\n  const stockNumber = initial?.vehicle?.stock_number || initial?.stock_number || '—'\r\n\r\n  return (\r\n    <div className=\"max-w-5xl mx-auto p-4 md:p-8\">\r\n      <header className=\"mb-4 flex items-center justify-between gap-3\">\r\n        <h1 className=\"text-xl font-semibold\">\r\n          Deal {dealNumber} / Stock # {stockNumber}\r\n        </h1>\r\n        <button\r\n          type=\"button\"\r\n          onClick={() => navigate('/deals')}\r\n          className=\"btn-mobile button-outline-enhanced\"\r\n        >\r\n          ← Back to Deals\r\n        </button>\r\n      </header>\r\n\r\n      <div className=\"mb-6\">\r\n        <h1 className=\"text-2xl font-semibold\">Edit Deal</h1>\r\n        <p className=\"text-gray-600\">Update details and save.</p>\r\n        {lastSavedAt ? (\r\n          <p className=\"text-sm text-gray-500 mt-1\" data-testid=\"last-saved-timestamp\">\r\n            Last saved:{' '}\r\n            {lastSavedAt.toLocaleTimeString('en-US', {\r\n              hour12: false,\r\n              hour: '2-digit',\r\n              minute: '2-digit',\r\n              second: '2-digit',\r\n            })}\r\n          </p>\r\n        ) : null}\r\n      </div>\r\n      <DealForm\r\n        mode=\"edit\"\r\n        initial={initial || {}}\r\n        onSave={onSubmit}\r\n        onCancel={() => navigate('/deals')}\r\n      />\r\n    </div>\r\n  )\r\n}\r\n"],"names":["EditDeal","id","useParams","navigate","useNavigate","initial","setInitial","useState","loading","setLoading","saving","setSaving","lastSavedAt","setLastSavedAt","useEffect","alive","d","dealService?.getDeal","mapped","dealService.mapDbDealToForm","onSubmit","formState","dealService?.updateDeal","fresh","jsx","dealNumber","stockNumber","_a","jsxs","DealForm"],"mappings":"gYAMA,SAAwBA,GAAW,OACjC,KAAM,CAAE,GAAAC,CAAA,EAAOC,EAAA,EACTC,EAAWC,EAAA,EACX,CAACC,EAASC,CAAU,EAAIC,EAAAA,SAAS,IAAI,EACrC,CAACC,EAASC,CAAU,EAAIF,EAAAA,SAAS,EAAI,EACrC,CAACG,EAAQC,CAAS,EAAIJ,EAAAA,SAAS,EAAK,EACpC,CAACK,EAAaC,CAAc,EAAIN,EAAAA,SAAS,IAAI,EAEnDO,EAAAA,UAAU,IAAM,CACd,IAAIC,EAAQ,GACX,OAAC,SAAY,CACZ,GAAI,CACF,MAAMC,EAAI,MAAMC,EAAqBhB,CAAE,EACvC,GAAIc,EAAO,CACT,MAAMG,EAASC,EAA8BA,EAA4BH,CAAC,EAAIA,EAC9EV,EAAWY,CAAM,CACnB,CACF,OAAS,EAAG,CACV,OAAM,iBAAG,UAAW,qBAAqB,CAC3C,QAAA,CACMH,GAAON,EAAW,EAAK,CAC7B,CACF,GAAA,EACO,IAAM,CACXM,EAAQ,EACV,CACF,EAAG,CAACd,CAAE,CAAC,EAEP,eAAemB,EAASC,EAAW,CACjCV,EAAU,EAAI,EACd,GAAI,CAEF,MAAMW,EAAwBrB,EAAIoB,CAAS,EAC3C,MAAME,EAAQ,MAAMN,EAAqBhB,CAAE,EACrCiB,EAASC,EAA8BA,EAA4BI,CAAK,EAAIA,EAClFjB,EAAWY,CAAM,EACjBL,EAAe,IAAI,IAAM,CAC3B,OAAS,EAAG,CACV,OAAM,iBAAG,UAAW,qBAAqB,CAC3C,QAAA,CACEF,EAAU,EAAK,CACjB,CACF,CAEA,GAAIH,EACF,OAAOgB,EAAAA,IAAC,MAAA,CAAI,UAAU,wBAAwB,SAAA,aAAU,EAG1D,MAAMC,GAAapB,GAAA,YAAAA,EAAS,aAAc,IAAIJ,CAAE,GAC1CyB,IAAcC,EAAAtB,GAAA,YAAAA,EAAS,UAAT,YAAAsB,EAAkB,gBAAgBtB,GAAA,YAAAA,EAAS,eAAgB,IAE/E,OACEuB,EAAAA,KAAC,MAAA,CAAI,UAAU,+BACb,SAAA,CAAAA,EAAAA,KAAC,SAAA,CAAO,UAAU,+CAChB,SAAA,CAAAA,EAAAA,KAAC,KAAA,CAAG,UAAU,wBAAwB,SAAA,CAAA,QAC9BH,EAAW,cAAYC,CAAA,EAC/B,EACAF,EAAAA,IAAC,SAAA,CACC,KAAK,SACL,QAAS,IAAMrB,EAAS,QAAQ,EAChC,UAAU,qCACX,SAAA,iBAAA,CAAA,CAED,EACF,EAEAyB,EAAAA,KAAC,MAAA,CAAI,UAAU,OACb,SAAA,CAAAJ,EAAAA,IAAC,KAAA,CAAG,UAAU,yBAAyB,SAAA,YAAS,EAChDA,EAAAA,IAAC,IAAA,CAAE,UAAU,gBAAgB,SAAA,2BAAwB,EACpDZ,EACCgB,EAAAA,KAAC,IAAA,CAAE,UAAU,6BAA6B,cAAY,uBAAuB,SAAA,CAAA,cAC/D,IACXhB,EAAY,mBAAmB,QAAS,CACvC,OAAQ,GACR,KAAM,UACN,OAAQ,UACR,OAAQ,SAAA,CACT,CAAA,CAAA,CACH,EACE,IAAA,EACN,EACAY,EAAAA,IAACK,EAAA,CACC,KAAK,OACL,QAASxB,GAAW,CAAA,EACpB,OAAQe,EACR,SAAU,IAAMjB,EAAS,QAAQ,CAAA,CAAA,CACnC,EACF,CAEJ"}