import{r as o}from"./react-Czq5O75u.js";import{u as w,s as S}from"./index-Ba5jGmMi.js";function E(){const{user:e}=w()||{},[c,a]=o.useState(null),[g,r]=o.useState(!!e&&c===null),s=o.useRef(!0),p=e?{user:e}:null;return o.useEffect(()=>(s.current=!0,()=>{s.current=!1}),[]),o.useEffect(()=>{let f=!1;return(async()=>{if(!(e!=null&&e.id)){s.current&&(a(null),r(!1));return}s.current&&r(!0);const m=["org_id","organization_id","tenant_id"];let i=null,d=!1;for(const u of m)try{const{data:t,error:n}=await S.from("user_profiles").select(u).eq("id",e.id).single();if(!n&&t&&Object.prototype.hasOwnProperty.call(t,u)){i=t[u]??null;break}if(n){const l=String((n==null?void 0:n.message)||"").toLowerCase();if(l.includes("does not exist")||l.includes("column"))continue;if(l.includes("permission")||l.includes("rls")){d=!0;break}console.warn("useTenant: profile select warning:",(n==null?void 0:n.message)||n)}}catch(t){console.warn("useTenant: profile select attempt failed:",(t==null?void 0:t.message)||t)}s.current&&!f&&(i!==null?a(i):(d&&console.warn("useTenant: treating RLS/permission as no-org"),a(null)),r(!1))})(),()=>{f=!0}},[e==null?void 0:e.id]),{orgId:c,loading:g,session:p}}export{E as u};
//# sourceMappingURL=useTenant-B_qtCcSP.js.map
